"use strict";!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Frontend=t():(e.Frontend=e.Frontend||{},e.Frontend["pages/ide"]=t())}(self,(()=>(self.webpackChunkFrontend=self.webpackChunkFrontend||[]).push([[1320],{309:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14041);function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const[n,s]=(0,r.useState)(e);return(0,r.useEffect)((()=>{const n=window.setTimeout((()=>{s(e)}),t);return()=>{window.clearTimeout(n)}}),[e,t]),n}},2567:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(56447),s=n(90214),i=n(14041),o=n(31085);const a=(0,i.lazy)((()=>n.e(6205).then(n.bind(n,26205))));const l=function(){const{view:e}=(0,r.LV)();return"history"!==e?null:(0,o.jsx)(i.Suspense,{fallback:(0,o.jsx)(s.e,{delay:500}),children:(0,o.jsx)(a,{})})}},3518:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(22046),s=n(31085);function i(e){let{children:t}=e;return(0,s.jsx)(r.A,{type:"error",content:t})}},4816:(e,t,n)=>{n.d(t,{n:()=>o});var r=n(69687),s=n(64932);let i;const o=(e,t)=>(i||(i=new r.VR((0,s.A)("ol-ExposedSettings").fileIgnorePattern,{nocase:!0,dot:!0})),!!e&&(!t||!i.match(t+"/"+e)))},4941:(e,t,n)=>{n.d(t,{i:()=>l});var r=n(14041),s=n(37858),i=n(45857),o=n(52155);const a=(e,t)=>i.h.compare(e.path,t.path);function l(e){const[t,n]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),{signal:u}=(0,o.A)();return(0,r.useEffect)((()=>{e&&(n(!0),d(!1),l(null),(0,s.hm)(`/project/${e}/entities`,{signal:u}).then((e=>{l(e.entities.sort(a))})).catch((e=>d(e))).finally((()=>n(!1))))}),[e,u]),{loading:t,data:i,error:c}}},5080:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(97434),s=n(31085);function i(){const{t:e}=(0,r.Bd)();return(0,s.jsx)("div",{className:"no-file-selection",children:(0,s.jsx)("div",{className:"no-file-selection-message",children:(0,s.jsx)("h3",{children:e("no_selection_select_file")})})})}},6468:(e,t,n)=>{n.d(t,{F:()=>o,Y:()=>i});var r=n(99420),s=n.n(r);function i(e,t){return e?(null==t&&(t="Do MMM YYYY, h:mm a"),s()(e).format(t)):"N/A"}function o(e){return s()(e).fromNow()}},6539:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),s=n(79184),i=n(11326);function o(){const{fileTreeExpanded:e,toggleFileTreeExpanded:t}=(0,i.r)(),n=(0,r.useRef)(null);return(0,s.A)(e,n),{fileTreeExpanded:e,fileTreePanelRef:n,toggleFileTreeExpanded:t}}},7260:(e,t,n)=>{n.d(t,{E8:()=>i,VQ:()=>o,f$:()=>l,h$:()=>r,sq:()=>a,xx:()=>s});n(82438),n(34840);const r="assistant",s="assistant",i="AI Assist",o="assistant-annual";function a(e){return e===r||e===o}function l(e){const t=e.pendingPlan,n=e.addOns?.some((e=>e.addOnCode===s));return!(!n||t)||n&&!t.addOns?.some((e=>e.code===s))}},7725:(e,t,n)=>{n.d(t,{GR:()=>l,xx:()=>a});n(97107);var r=n(14041),s=n(89139),i=n(31085);const o=(0,r.createContext)(void 0),a=e=>{let{children:t}=e;const[n,a]=(0,r.useState)((()=>({settingToFocus:void 0})));return(0,s.A)("ui.focus-setting",(0,r.useCallback)((e=>{a((t=>({...t,settingToFocus:e.detail})))}),[])),(0,i.jsx)(o.Provider,{value:n,children:t})},l=()=>{const e=(0,r.useContext)(o);if(!e)throw new Error("useEditorLeftMenuContext is only available inside EditorLeftMenuProvider");return e}},8881:(e,t,n)=>{n.d(t,{A:()=>d});var r=n(14041),s=n(90214),i=n(67984),o=n(45330),a=n(31085);const l=(0,r.lazy)((()=>Promise.all([n.e(5982),n.e(2363),n.e(3015),n.e(7565)]).then(n.bind(n,98910))));function c(){return(0,a.jsx)(r.Suspense,{fallback:(0,a.jsx)(s.e,{delay:500}),children:(0,a.jsx)(l,{})})}const d=(0,i.A)((0,r.memo)(c),(()=>(0,a.jsx)(o.j,{})))},11283:(e,t,n)=>{n.d(t,{Pp:()=>o,fU:()=>i,mp:()=>a});var r=n(99420),s=n.n(r);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"h:mm a";return(arguments.length>2&&void 0!==arguments[2]&&arguments[2]?s().utc(e):s()(e)).format(t)}function o(e){return s()(e).calendar()}function a(e){return s()().diff(e,"years")>0?i(e,"D MMMM YYYY, h:mm a"):i(e,"D MMMM, h:mm a")}s().updateLocale("en",{calendar:{lastDay:"[Yesterday]",sameDay:"[Today]",nextDay:"[Tomorrow]",lastWeek:"ddd, Do MMM YY",nextWeek:"ddd, Do MMM YY",sameElse:"ddd, Do MMM YY"}})},11787:(e,t,n)=>{n.d(t,{e:()=>o,r:()=>a});n(97107);var r=n(14041),s=n(31085);const i=(0,r.createContext)(void 0);function o(){const e=(0,r.useContext)(i);if(!e)throw new Error("useFileTreeMainContext is only available inside FileTreeMainProvider");return e}const a=e=>{let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:o,children:a}=e;const[l,c]=(0,r.useState)(null);return(0,s.jsx)(i.Provider,{value:{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:o,contextMenuCoords:l,setContextMenuCoords:c},children:a})}},14301:(e,t,n)=>{n.d(t,{H:()=>s});var r=n(17112);const s=()=>(0,r.u)("new-editor-error-logs-redesign")?"https://forms.gle/83QJ9ALJkiugxTZf8":"https://forms.gle/soyVStc5qDx9na1Z6"},15428:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(73613),s=n(97434),i=n(53373),o=n.n(i),a=n(31085);function l(e){const{t}=(0,s.Bd)();return(0,a.jsx)(r.TW,{...e,children:(0,a.jsx)("div",{className:o()("vertical-resize-handle",{"vertical-resize-handle-enabled":!e.disabled}),title:t("resize")})})}},17484:(e,t,n)=>{var r=n(64932),s=n(60961);var i=n(32524);const{hotjarId:o,hotjarVersion:a}=(0,r.A)("ol-ExposedSettings"),l=(0,r.A)("ol-shouldLoadHotjar");o&&a&&l&&(/^\d+$/.test(o)&&/^\d+$/.test(a)?(0,i.J)((()=>((e,t)=>{return n=window,r=document,n.hj=n.hj||function(){(n.hj.q=n.hj.q||[]).push(arguments)},n._hjSettings={hjid:e,hjsv:t},s=r.getElementsByTagName("head")[0],(i=r.createElement("script")).async=1,i.src="https://static.hotjar.com/c/hotjar-"+n._hjSettings.hjid+".js?sv="+n._hjSettings.hjsv,void s.appendChild(i);var n,r,s,i})(o,a)),"Hotjar"):s.$.error("Invalid Hotjar id or version"))},17905:(e,t,n)=>{n.d(t,{w:()=>i});n(82438),n(50020);var r=n(14041),s=n(7707);const i=(e,t)=>{const{register:n,unregister:i}=(0,s.WB)();(0,r.useEffect)((()=>{const t=e();if(t)return n(...t),()=>{i(...t.map((e=>e.id)))}}),t)}},18730:(e,t,n)=>{n.d(t,{J:()=>o});var r=n(14041),s=n(37858),i=n(52155);function o(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const[n,o]=(0,r.useState)(!1),[a,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),{signal:u}=(0,i.A)();return(0,r.useEffect)((()=>{t&&(o(!0),d(null),l(null),(0,s.hm)(`/${e}/groups`,{signal:u}).then((e=>{l(e.groups)})).catch((e=>{400===e.response.status?e.data.relink&&d("relink"):d("loading_groups")})).finally((()=>{o(!1)})))}),[t,e,u]),{loading:n,data:a,error:c}}},21588:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),s=n(7260),i=n(64932);function o(e,t){const n=(0,i.A)("ol-user"),{hasPaidSubscription:o}=n;return(0,r.useCallback)((()=>{if(o)window.open(`/user/subscription/addon/${s.xx}/add?purchaseReferrer=${t}`);else{const n=e?s.VQ:s.h$;window.open(`/user/subscription/new?planCode=${n}&purchaseReferrer=${t}`)}}),[e,o,t])}},21923:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(14041),s=n(45250),i=n.n(s),o=n(31085);const a=function(e){let{atEnd:t,children:n,className:s="",fetchData:a,itemCount:l,isLoading:c}=e;const d=(0,r.useRef)(null),u=(0,r.useRef)(0);function p(){d.current&&(d.current.scrollTop=d.current.scrollHeight-d.current.clientHeight-u.current)}return(0,r.useLayoutEffect)(p,[l]),(0,r.useEffect)((()=>{const e=i().debounce(p,400);return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[]),(0,o.jsx)("div",{ref:d,onScroll:function(e){if(d.current){if(n=d.current.scrollHeight-d.current.scrollTop-d.current.clientHeight,u.current=n,e.target!==e.currentTarget)return;(function(){if(!d.current)return!1;const e=d.current.children[0].clientHeight<d.current.clientHeight;return!(t||c||e)&&d.current.scrollTop<30})()&&a()}var n},className:`infinite-scroll ${s}`,children:n})}},23823:(e,t,n)=>{n.d(t,{A:()=>s,o:()=>r});const r=e=>{let t=e.split(".").pop();return t=t?t.toLowerCase():t,t&&["png","pdf","jpg","jpeg","gif"].includes(t)?"image":t&&["csv","xls","xlsx"].includes(t)?"table_chart":t&&["py","r"].includes(t)?"code":t&&["bib"].includes(t)?"book_5":"description"};function s(e){let t=e.split(".").pop();return t=t?t.toLowerCase():t,t&&["png","pdf","jpg","jpeg","gif"].includes(t)?"image":t&&["csv","xls","xlsx"].includes(t)?"table_chart":t&&["py","r"].includes(t)?"code":t&&["bib"].includes(t)?"menu_book":"description"}},27101:(e,t,n)=>{var r={};n.r(r),n.d(r,{default:()=>R});var s={};n.r(s),n.d(s,{default:()=>Xt});n(22108),n(9155),n(17484);var i=n(25873),o=n(14041),a=n(36266),l=n(67984),c=n(97434),d=n(3218),u=n(22046),p=n(71627),h=n(31085);function m(e){let{reconnectAt:t,tryReconnectNow:n}=e;const{t:r}=(0,c.Bd)(),[s,i]=(0,o.useState)((0,d.C)(t));return(0,o.useEffect)((()=>{const e=window.setInterval((()=>{i((0,d.C)(t))}),1e3);return()=>window.clearInterval(e)}),[t]),(0,h.jsx)(u.A,{type:"warning",content:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("strong",{children:r("lost_connection")})," ",r("reconnecting_in_x_secs",{seconds:s}),"."]}),action:(0,h.jsx)(p.A,{id:"try-reconnect-now-button",onClick:()=>n(),size:"sm",variant:"secondary",children:r("try_now")})})}var f=n(16896),x=n(60961),j=n(43144),_=n(36471);function g(){const{t:e}=(0,c.Bd)(),{connectionState:t,isConnected:n,isStillReconnecting:r,tryReconnectNow:s,secondsUntilReconnect:i}=(0,f.FX)(),o=(0,_.J)();return o?(0,j.createPortal)((0,h.jsxs)(h.Fragment,{children:[t.forceDisconnected&&"out-of-sync"!==t.error?(0,h.jsx)(u.A,{type:"error",content:(0,h.jsx)("strong",{children:e("disconnected")})}):null,t.reconnectAt?(0,h.jsx)(m,{reconnectAt:t.reconnectAt,tryReconnectNow:s}):null,r?(0,h.jsx)(u.A,{type:"warning",content:(0,h.jsxs)("strong",{children:[e("reconnecting"),"…"]})}):null,t.inactiveDisconnect||t.readyState===WebSocket.CLOSED&&("rate-limited"===t.error||"unable-to-connect"===t.error)&&!i()?(0,h.jsx)(u.A,{type:"warning",content:(0,h.jsx)("strong",{children:e("editor_disconected_click_to_reconnect")})}):null,x.v?(0,h.jsx)(u.A,{type:"warning",content:(0,h.jsxs)("strong",{children:["Connected: ",n.toString()]})}):null]}),o):null}var v=n(36448),b=n(73613),y=n(77934),w=n(53373),k=n.n(w),C=n(56447),A=n(52036),E=n(68543),N=n(69954),F=(n(61412),n(91883),n(70286),n(96713)),S=n(65982);function R(){const{fileTreeFromHistory:e,snapshotLoadingState:t,setFileTreeFromHistory:n}=(0,S.P4)();let r="sync_disabled";if(e)switch(t){case"":r="cloud_sync";break;case"loading":r="hourglass_top";break;case"error":r="sync_problem"}return(0,h.jsx)("div",{className:"toolbar-item",children:(0,h.jsx)("button",{className:"btn btn-full-height",onClick:()=>n(!e),children:(0,h.jsx)(F.A,{type:r})})})}var T=n(97684);const L=function(e){let{onClick:t}=e;const{t:n}=(0,c.Bd)();return(0,h.jsx)("div",{className:"toolbar-item",children:(0,h.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,h.jsx)(F.A,{type:"menu",className:"editor-menu-icon align-middle"}),(0,h.jsx)("p",{className:"toolbar-label",children:n("menu")})]})})};const I=function(e){let{brandVariationHomeUrl:t,brandVariationName:n,logoImgUrl:r}=e;return(0,h.jsx)("a",{className:"btn btn-full-height header-cobranding-logo-container",href:t,target:"_blank",rel:"noreferrer noopener",children:(0,h.jsx)("img",{src:r,className:"header-cobranding-logo",alt:n})})};var D=n(59162);const P=function(){const{t:e}=(0,c.Bd)();return(0,h.jsx)(D.A,{id:"back-to-projects",description:e("back_to_your_projects"),overlayProps:{placement:"right"},children:(0,h.jsx)("div",{className:"toolbar-item",children:(0,h.jsx)("a",{className:"btn btn-full-height",draggable:"false",href:"/project",onClick:()=>{N._("navigation-clicked-home")},children:(0,h.jsx)(F.A,{type:"home",className:"align-text-bottom",accessibilityLabel:e("back_to_your_projects")})})})})};const O=function(){const{t:e}=(0,c.Bd)();return(0,h.jsx)(p.A,{variant:"primary",size:"sm",className:"toolbar-header-upgrade-prompt",href:"/user/subscription/plans?itm_referrer=editor-header-upgrade-prompt",target:"_blank",onClick:function(){N.tN("subscription-funnel","code-editor","upgrade"),N._("upgrade-button-click",{source:"code-editor"})},children:e("upgrade")})};var M=n(35722);const B=function(e){let{chatIsOpen:t,unreadMessageCount:n,onClick:r}=e;const{t:s}=(0,c.Bd)(),i=k()("btn","btn-full-height",{active:t}),o=n>0;return(0,h.jsx)("div",{className:"toolbar-item",children:(0,h.jsxs)("button",{type:"button",className:i,onClick:r,children:[(0,h.jsx)(F.A,{type:"chat",className:k()("align-middle",{bounce:o})}),o&&(0,h.jsx)(M.A,{bg:"info",children:n}),(0,h.jsx)("p",{className:"toolbar-label",children:s("chat")})]})})};var z=n(82151),$=n(61160),V=n(89139);const U=e=>{let{iconFor:t,pdfLayout:n,view:r,detachRole:s}=e;return"detacher"!==s&&"history"!==r&&("editorOnly"===t&&"flat"===n&&("editor"===r||"file"===r)||("pdfOnly"===t&&"flat"===n&&"pdf"===r||"sideBySide"===t&&"sideBySide"===n))};function H(e){let{active:t,...n}=e;return(0,h.jsx)($.tJ,{active:t,"aria-current":t,trailingIcon:t?"check":null,...n})}const G=(0,o.forwardRef)(((e,t)=>{let{onClick:n,...r}=e;return(0,h.jsx)($.fu,{...r,ref:t,onClick:e=>{N._("navigation-clicked-layout"),n(e)}})}));function q(){const{t:e}=(0,c.Bd)();return(0,h.jsx)(D.A,{id:"detach-disabled",description:e("your_browser_does_not_support_this_feature"),overlayProps:{placement:"left"},children:(0,h.jsx)("span",{children:(0,h.jsx)(H,{disabled:!0,leadingIcon:"select_window",children:e("pdf_in_separate_tab")})})})}function K(){const{reattach:e,detach:t,detachIsLinked:n,detachRole:r,changeLayout:s,view:i,pdfLayout:a}=(0,C.LV)(),l=(0,o.useCallback)((()=>{t(),N._("project-layout-detach")}),[t]),c=(0,o.useCallback)((()=>{"detacher"===r&&(e(),N._("project-layout-reattach"))}),[r,e]);(0,V.A)("ui:pdf-open",c);const d=(0,o.useCallback)(((e,t)=>{c(),s(e,t),N._("project-layout-change",{layout:e,view:t})}),[s,c]);return(0,h.jsx)(Y,{processing:!n&&"detacher"===r,handleChangeLayout:d,handleDetach:l,detachIsLinked:n,detachRole:r,pdfLayout:a,view:i,detachable:"BroadcastChannel"in window})}G.displayName="LayoutDropdownToggleButton";const Y=e=>{let{processing:t,handleChangeLayout:n,handleDetach:r,detachIsLinked:s,detachRole:i,view:o,pdfLayout:a,detachable:l}=e;const{t:d}=(0,c.Bd)();return(0,h.jsxs)(h.Fragment,{children:[t&&(0,h.jsx)("div",{"aria-live":"assertive",className:"sr-only",children:d("layout_processing")}),(0,h.jsxs)($.ms,{className:"toolbar-item layout-dropdown",align:"end",children:[(0,h.jsxs)($.C,{id:"layout-dropdown-btn",className:"btn-full-height",as:G,children:[t?(0,h.jsx)(z.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}):(0,h.jsx)(F.A,{type:"dock_to_right",className:"align-middle"}),(0,h.jsx)("span",{className:"toolbar-label",children:d("layout")})]}),(0,h.jsxs)($.rI,{children:[(0,h.jsx)(H,{onClick:()=>n("sideBySide"),active:U({iconFor:"sideBySide",pdfLayout:a,view:o,detachRole:i}),leadingIcon:"dock_to_right",children:d("editor_and_pdf")}),(0,h.jsx)(H,{onClick:()=>n("flat","editor"),active:U({iconFor:"editorOnly",pdfLayout:a,view:o,detachRole:i}),leadingIcon:"code",children:(0,h.jsx)("div",{className:"d-flex flex-column",children:(0,h.jsx)(c.x6,{i18nKey:"editor_only_hide_pdf",components:[(0,h.jsx)("span",{className:"subdued"},"editor_only_hide_pdf")]})})}),(0,h.jsx)(H,{onClick:()=>n("flat","pdf"),active:U({iconFor:"pdfOnly",pdfLayout:a,view:o,detachRole:i}),leadingIcon:"picture_as_pdf",children:(0,h.jsx)("div",{className:"d-flex flex-column",children:(0,h.jsx)(c.x6,{i18nKey:"pdf_only_hide_editor",components:[(0,h.jsx)("span",{className:"subdued"},"pdf_only_hide_editor")]})})}),l?(0,h.jsx)(H,{onClick:()=>r(),active:"detacher"===i&&s,trailingIcon:"detacher"===i?s?"check":(0,h.jsxs)("span",{className:"spinner-container",children:[(0,h.jsx)(z.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"}),(0,h.jsx)("span",{className:"visually-hidden",children:d("loading")})]}):null,leadingIcon:"select_window",children:d("pdf_in_separate_tab")}):(0,h.jsx)(q,{})]})]})]})},W=(0,o.memo)(K);n(82438),n(50020);var J=n(14020);function Z(e){let{user:t,showName:n,onClick:r}=e;const s=(0,J.lr)(t.user_id);const[i]=[...t.name];return(0,h.jsxs)("span",{onClick:function(){r?.(t)},children:[(0,h.jsx)("span",{className:"online-user",style:{backgroundColor:s},children:i}),n&&t.name]})}const Q=o.forwardRef(((e,t)=>{const{t:n}=(0,c.Bd)();return(0,h.jsx)(D.A,{id:"connected-users",description:n("connected_users"),overlayProps:{placement:"left"},children:(0,h.jsxs)("button",{type:"button",className:"online-user online-user-multi",onClick:e.onClick,ref:t,children:[(0,h.jsx)("strong",{children:e.onlineUserCount})," ",(0,h.jsx)(F.A,{type:"groups"})]})})}));Q.displayName="DropDownToggleButton";const X=function(e){let{onlineUsers:t,goToUser:n}=e;const{t:r}=(0,c.Bd)();return t.length>=4?(0,h.jsxs)($.ms,{className:"online-users",align:"end",children:[(0,h.jsx)($.C,{id:"online-users",as:Q,onlineUserCount:t.length}),(0,h.jsxs)($.rI,{children:[(0,h.jsx)($.hO,{"aria-hidden":"true",children:r("connected_users")}),t.map(((e,t)=>(0,h.jsx)("li",{role:"none",children:(0,h.jsx)($.tJ,{as:"button",tabIndex:-1,onClick:()=>n(e),children:(0,h.jsx)(Z,{user:e,showName:!0})})},`${e.user_id}_${t}`)))]})]}):(0,h.jsx)("div",{className:"online-users",children:t.map(((e,t)=>(0,h.jsx)(D.A,{id:"online-user",description:e.name,overlayProps:{placement:"bottom",trigger:["hover","focus"]},tooltipProps:{translate:"no"},children:(0,h.jsx)("span",{children:(0,h.jsx)(Z,{user:e,onClick:n})})},`${e.user_id}_${t}`)))})};var ee=n(7829);const te=function(e){let{projectName:t,hasRenamePermissions:n,onChange:r,className:s}=e;const{t:i}=(0,c.Bd)(),[a,l]=(0,o.useState)(!1),d=n&&!a,[u,p]=(0,o.useState)(t),m=(0,o.useRef)(null);function f(){d&&(p(t),l(!0))}function x(){l(!1),r(u)}return(0,o.useEffect)((()=>{a&&m.current?.select()}),[a]),(0,h.jsxs)("div",{className:k()("project-name",s),children:[!a&&(0,h.jsx)("span",{className:"name",onDoubleClick:f,children:t}),a&&(0,h.jsx)(ee.A,{ref:m,type:"text",onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),x())},onChange:function(e){p(e.target.value)},onBlur:function(){a&&x()},value:u}),d&&(0,h.jsx)(D.A,{id:"online-user",description:i("rename"),overlayProps:{placement:"bottom",trigger:["hover","focus"]},children:(0,h.jsx)("a",{className:"rename",role:"button",onClick:f,children:(0,h.jsx)(F.A,{type:"edit",className:"align-text-bottom"})})})]})};const ne=function(e){let{trackChangesIsOpen:t,disabled:n,onMouseDown:r}=e;const{t:s}=(0,c.Bd)(),i=k()("btn","btn-full-height",{active:t&&!n,disabled:n});return(0,h.jsxs)("div",{className:"toolbar-item",children:[(0,h.jsxs)("button",{type:"button",disabled:n,className:i,onMouseDown:r,children:[(0,h.jsx)(F.A,{type:"rate_review",className:"align-middle"}),(0,h.jsx)("p",{className:"toolbar-label",children:s("review")})]}),(0,h.jsx)("div",{id:"toolbar-cio-review",className:"toolbar-cio-tooltip"})]})};const re=function(e){let{onClick:t}=e;const{t:n}=(0,c.Bd)();return(0,h.jsxs)("div",{className:"toolbar-item",children:[(0,h.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,h.jsx)(F.A,{type:"history",className:"align-middle"}),(0,h.jsx)("p",{className:"toolbar-label",children:n("history")})]}),(0,h.jsx)("div",{id:"toolbar-cio-history",className:"toolbar-cio-tooltip"})]})};const se=function(e){let{onClick:t}=e;const{t:n}=(0,c.Bd)();return(0,h.jsxs)("div",{className:"toolbar-item",children:[(0,h.jsxs)("button",{type:"button",className:"btn btn-full-height",onClick:t,children:[(0,h.jsx)(F.A,{type:"group_add",className:"align-middle"}),(0,h.jsx)("p",{className:"toolbar-label",children:n("share")})]}),(0,h.jsx)("div",{id:"toolbar-cio-share",className:"toolbar-cio-tooltip"})]})};var ie=n(43137),oe=n(64932),ae=n(58528),le=n(97536),ce=n(86040);const de=()=>{const{t:e}=(0,c.Bd)(),{setShowSwitcherModal:t}=(0,ce.vO)(),n=(0,o.useCallback)((()=>{t(!0)}),[t]);return(0,h.jsx)("div",{className:"d-flex align-items-center",children:(0,h.jsx)(p.A,{className:"toolbar-experiment-button",onClick:n,size:"sm",leadingIcon:(0,h.jsx)(F.A,{type:"experiment",unfilled:!0}),variant:"secondary",children:e("try_the_new_editor")})})},[ue]=[{import:T,path:"/overleaf/services/web/modules/publish-modal/frontend/js/components/publish-toolbar-button"}],pe=ue?.import.default,he=[{import:r,path:"/overleaf/services/web/modules/offline-mode/frontend/js/components/editor-toolbar/file-tree-from-history-button"}],me=(0,ae.g9)("ro-mirror-on-client")&&"enabled"===new URLSearchParams(window.location.search).get("ro-mirror-on-client"),fe=o.memo((function(e){let{cobranding:t,onShowLeftMenuClick:n,chatIsOpen:r,toggleChatOpen:s,reviewPanelOpen:i,toggleReviewPanelOpen:o,historyIsOpen:a,toggleHistoryOpen:l,unreadMessageCount:d,onlineUsers:u,goToUser:p,isRestrictedTokenMember:m,hasPublishPermissions:f,chatVisible:x,projectName:j,renameProject:_,hasRenamePermissions:g,openShareModal:v,trackChangesVisible:b}=e;const y=(0,oe.A)("ol-capabilities")?.includes("chat"),{t:w}=(0,c.Bd)(),k=f&&pe;return(0,h.jsxs)("header",{className:"toolbar toolbar-header",role:"navigation","aria-label":w("project_layout_sharing_submission"),children:[(0,h.jsxs)("div",{className:"toolbar-left",children:[(0,h.jsx)(L,{onClick:n}),t&&t.logoImgUrl&&(0,h.jsx)(I,{...t}),(0,h.jsx)(P,{}),me&&he.map((e=>{let{path:t,import:{default:n}}=e;return(0,h.jsx)(n,{},t)}))]}),(0,oe.A)("ol-showUpgradePrompt")&&(0,h.jsx)("div",{className:"d-flex align-items-center",children:(0,h.jsx)(O,{})}),(0,h.jsx)(te,{className:"toolbar-center",projectName:j,hasRenamePermissions:g,onChange:_}),(0,h.jsxs)("div",{className:"toolbar-right",children:[(0,le.x)()&&(0,h.jsx)(de,{}),(0,h.jsx)(X,{onlineUsers:u,goToUser:p}),a?(0,h.jsx)("div",{className:"d-flex align-items-center",children:(0,h.jsx)(ie.A,{onClick:l})}):(0,h.jsxs)(h.Fragment,{children:[b&&(0,h.jsx)(ne,{onMouseDown:o,disabled:a,trackChangesIsOpen:i}),(0,h.jsx)(se,{onClick:v}),k&&(0,h.jsx)(pe,{cobranding:t}),!m&&(0,h.jsx)(re,{onClick:l}),(0,h.jsx)(W,{}),y&&x&&(0,h.jsx)(B,{chatIsOpen:r,onClick:s,unreadMessageCount:d})]})]})]})}));var xe=n(10646),je=n(78494),_e=n(99806),ge=n(86316);function ve(e){return e?"open":"close"}const be=o.memo((function(e){let{onlineUsersArray:t,openDoc:n,openShareProjectModal:r}=e;const{name:s,features:{trackChangesVisible:i}}=(0,ge.Om)(),{cobranding:a,isRestrictedTokenMember:l,renameProject:c}=(0,xe.mi)(),{permissionsLevel:d}=(0,je.yn)(),{chatIsOpen:u,setChatIsOpen:p,reviewPanelOpen:m,setReviewPanelOpen:f,view:x,setView:j,setLeftMenuShown:_}=(0,C.LV)(),{markMessagesAsRead:g,unreadMessageCount:v}=(0,_e.vd)(),b=(0,o.useCallback)((()=>{u||g(),N._("navigation-clicked-chat",{action:ve(!u)}),p(!u)}),[u,p,g]),y=(0,o.useCallback)((e=>{e.preventDefault(),N._("navigation-clicked-review",{action:ve(!m)}),f((e=>!e))}),[m,f]),[w,k]=(0,o.useState)(u),A=(0,o.useCallback)((()=>{const e="history"===x?"close":"open";N._("navigation-clicked-history",{action:e}),u&&"open"===e&&(k(!0),b()),w&&"close"===e&&(k(!1),b()),j("history"===x?"editor":"history")}),[x,u,w,j,b]),E=(0,o.useCallback)((()=>{N._("navigation-clicked-share"),r()}),[r]),F=(0,o.useCallback)((()=>{N._("navigation-clicked-menu"),_((e=>!e))}),[_]),S=(0,o.useCallback)((e=>{e.doc&&"number"==typeof e.row&&n(e.doc,{gotoLine:e.row+1})}),[n]);return(0,h.jsx)(fe,{cobranding:a,onShowLeftMenuClick:F,chatIsOpen:u,unreadMessageCount:v,toggleChatOpen:b,reviewPanelOpen:m,toggleReviewPanelOpen:y,historyIsOpen:"history"===x,toggleHistoryOpen:A,onlineUsers:t,goToUser:S,isRestrictedTokenMember:l,hasPublishPermissions:"owner"===d||"readAndWrite"===d,chatVisible:!l,projectName:s,renameProject:c,hasRenamePermissions:"owner"===d,openShareModal:E,trackChangesVisible:i})}));var ye=n(30158),we=(n(12266),n(43480)),ke=n(28812);function Ce(e){let{handleHide:t}=e;const{t:n}=(0,c.Bd)();return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(ke.IK,{closeButton:!0,children:(0,h.jsx)(ke.rA,{children:n("do_you_need_edit_access")})}),(0,h.jsxs)(ke.$8,{children:[(0,h.jsx)("p",{children:n("this_project_has_more_than_max_collabs",{linkSharingDate:we.V})}),(0,h.jsx)("p",{children:n("to_keep_edit_access")})]}),(0,h.jsxs)(ke.E9,{children:[(0,h.jsx)(p.A,{variant:"secondary",href:"/blog/changes-to-project-sharing",target:"_blank",rel:"noreferrer",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"learn"})},children:n("learn_more")}),(0,h.jsx)(p.A,{variant:"primary",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"ok"}),t()},children:n("ok")})]})]})}var Ae=n(37664);const Ee=()=>{const[e,t]=(0,o.useState)(!1),{isProjectOwner:n}=(0,xe.mi)(),{permissionsLevel:r}=(0,je.yn)(),{project:s,features:i,projectId:a}=(0,ge.Om)(),l=s?.members,c=()=>{t(!1)};return(0,o.useEffect)((()=>{if(!(n||!i||!l||"readOnly"===r)&&-1!==i.collaborators&&l.filter((e=>"readAndWrite"===e.privileges)).length>(i.collaborators??1)){const e=`last-shown-need-edit-modal.${a}`,n=Ae.A.getItem(e);(!n||n+864e5<Date.now())&&(t(!0),Ae.A.setItem(e,Date.now()),(0,N._)("notification-prompt",{name:"link-sharing-collaborator-limit"}))}}),[i,n,l,r,a]),e?(0,h.jsx)(ke.Ay,{animation:!0,show:e,onHide:()=>{(0,N._)("notification-dismiss",{name:"link-sharing-collaborator-limit"}),c()},id:"editor-over-limit-modal",children:(0,h.jsx)(Ce,{handleHide:c})}):null};function Ne(e){let{handleHide:t}=e;const{t:n}=(0,c.Bd)();return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(ke.IK,{closeButton:!0,children:(0,h.jsx)(ke.rA,{children:n("view_only_access")})}),(0,h.jsxs)(ke.$8,{children:[(0,h.jsx)("p",{children:n("this_project_already_has_maximum_collaborators")}),(0,h.jsx)("p",{children:n("please_ask_the_project_owner_to_upgrade_more_collaborators")})]}),(0,h.jsxs)(ke.E9,{children:[(0,h.jsx)(p.A,{variant:"secondary",href:"/blog/changes-to-project-sharing",target:"_blank",rel:"noreferrer",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"learn"})},children:n("learn_more")}),(0,h.jsx)(p.A,{variant:"primary",onClick:()=>{(0,N._)("notification-click",{name:"link-sharing-collaborator-limit",button:"ok"}),t()},children:n("ok")})]})]})}const Fe=()=>{const[e,t]=(0,o.useState)(!1),{isProjectOwner:n,isPendingEditor:r}=(0,xe.mi)(),{permissionsLevel:s}=(0,je.yn)(),{features:i,projectId:a,project:l}=(0,ge.Om)(),c=l?.members,d=()=>{t(!1)};return(0,o.useEffect)((()=>{if(!(n||!i)&&-1!==i.collaborators&&r){const e=`last-shown-view-only-access-modal.${a}`,n=Ae.A.getItem(e);(!n||n+6048e5<Date.now())&&(t(!0),Ae.A.setItem(e,Date.now()),(0,N._)("notification-prompt",{name:"link-sharing-collaborator-limit"}))}}),[i,n,r,c,s,a]),e?(0,h.jsx)(ke.Ay,{animation:!0,show:e,onHide:()=>{(0,N._)("notification-dismiss",{name:"link-sharing-collaborator-limit"}),d()},id:"editor-over-limit-modal",children:(0,h.jsx)(Ne,{handleHide:d})}):null};const Se=function(){const[e,t]=(0,o.useState)(!1),{onlineUsersArray:n}=(0,A.E1)(),{openDoc:r}=(0,E.TS)(),s=(0,o.useCallback)((()=>{N.JY("ide-open-share-modal-once"),t(!0)}),[]),i=(0,o.useCallback)((()=>{t(!1)}),[]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(be,{onlineUsersArray:n,openDoc:r,openShareProjectModal:s}),(0,h.jsx)(Ee,{}),(0,h.jsx)(Fe,{}),(0,h.jsx)(ye.A,{show:e,handleOpen:s,handleHide:i})]})};n(74786);var Re=n(79563),Te=n(21923),Le=n(88929),Ie=n(85960),De=n(37858),Pe=n(90214);const Oe=(0,o.lazy)((()=>n.e(9829).then(n.bind(n,49829)))),Me=()=>(0,h.jsx)(Pe.e,{delay:500,className:"pt-4"}),Be=o.memo((function(){const{t:e}=(0,c.Bd)(),{chatIsOpen:t}=(0,C.LV)(),n=(0,Ie.ur)(),{status:r,messages:s,initialMessagesLoaded:i,atEnd:a,loadInitialMessages:l,loadMoreMessages:d,reset:u,sendMessage:p,markMessagesAsRead:m,error:f}=(0,_e.vd)();(0,o.useEffect)((()=>{t&&!i&&l()}),[t,l,i]);const x="pending"!==r&&0===s.length,j=s.reduce(((e,t)=>{let{contents:n}=t;return e+n.length}),0),[_,g]=(0,o.useState)(t);if((0,o.useEffect)((()=>{t&&g(!0)}),[t]),f){if(f instanceof De.fk)return(0,h.jsx)(Le.A,{reconnect:u});throw f}return n&&_?(0,h.jsxs)("aside",{className:"chat",children:[(0,h.jsx)(Te.A,{atEnd:a,className:"messages",fetchData:d,isLoading:"pending"===r,itemCount:j,children:(0,h.jsxs)("div",{children:[(0,h.jsx)("h2",{className:"visually-hidden",children:e("chat")}),(0,h.jsxs)(o.Suspense,{fallback:(0,h.jsx)(Me,{}),children:["pending"===r&&(0,h.jsx)(Me,{}),x&&(0,h.jsx)(ze,{}),(0,h.jsx)(Oe,{messages:s,resetUnreadMessages:m})]})]})}),(0,h.jsx)(Re.A,{resetUnreadMessages:m,sendMessage:p})]}):null}));function ze(){const{t:e}=(0,c.Bd)();return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("div",{className:"no-messages text-center small",children:e("no_messages")}),(0,h.jsxs)("div",{className:"first-message text-center",children:[e("send_first_message"),(0,h.jsx)("br",{}),(0,h.jsx)(F.A,{type:"arrow_downward"})]})]})}const $e=(0,l.A)(Be,(()=>(0,h.jsx)(Le.A,{})));var Ve=n(73743),Ue=n(64430),He=n(45117),Ge=n(15428),qe=n(42615),Ke=n(57533),Ye=n(61564);const We=[{import:He,path:"/overleaf/services/web/modules/full-project-search/frontend/js/components/full-project-search.tsx"}];function Je(){const{view:e}=(0,C.LV)(),{outlineEnabled:t,outlinePanelRef:n}=(0,Ye.C)();return(0,h.jsxs)("aside",{className:k()("ide-react-editor-sidebar",{hidden:"history"===e}),children:[We.map((e=>{let{import:{default:t},path:n}=e;return(0,h.jsx)(t,{},n)})),(0,h.jsxs)(b.YZ,{autoSaveId:"ide-editor-sidebar-layout",direction:"vertical",children:[(0,h.jsx)(b.Zk,{defaultSize:50,minSize:25,className:"ide-react-file-tree-panel",id:"panel-file-tree",order:1,children:(0,h.jsx)(qe.h,{})}),(0,h.jsx)(Ge.F,{disabled:!t}),(0,h.jsx)(b.Zk,{defaultSize:50,maxSize:75,id:"panel-outline",order:2,collapsible:!0,ref:n,style:{minHeight:32},children:(0,h.jsx)(Ke.S,{})})]})]})}var Ze=n(79184);var Qe=n(309);var Xe=n(5080),et=n(89027),tt=n(68059),nt=n(44167),rt=n(88119),st=n(55904),it=n(39891),ot=n(11326),at=n(8881),lt=n(55937),ct=n(41260),dt=n(96283);const ut=(0,o.lazy)((()=>n.e(2353).then(n.bind(n,92353)))),pt=()=>{const{showSymbolPalette:e}=(0,dt.dB)(),{selectedEntityCount:t,openEntity:n}=(0,ot.r)(),{isLoading:r}=(0,E.TS)(),{currentDocumentId:s}=(0,lt.Wq)();return s?(0,h.jsx)("div",{className:k()("ide-react-editor-content","full-size",{hidden:"doc"!==n?.type||1!==t}),children:(0,h.jsxs)(b.YZ,{autoSaveId:"ide-editor-layout",direction:"vertical",children:[(0,h.jsxs)(b.Zk,{id:"panel-source-editor",order:1,className:"ide-react-editor-panel",children:[(0,h.jsx)(at.A,{}),r&&(0,h.jsx)(ct.R,{})]}),e&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(Ge.F,{id:"editor-symbol-palette"}),(0,h.jsx)(b.Zk,{id:"panel-symbol-palette",order:2,defaultSize:25,minSize:10,maxSize:50,children:(0,h.jsx)(o.Suspense,{fallback:(0,h.jsx)(Pe.e,{delay:500}),children:(0,h.jsx)(ut,{})})})]})]})}):null},ht=()=>{const[e,t]=(0,o.useState)(!1),{t:n}=(0,c.Bd)(),{togglePdfPane:r,handlePdfPaneExpand:s,handlePdfPaneCollapse:i,setPdfIsOpen:a,pdfIsOpen:l,pdfPanelRef:d}=(0,st.A)(),{view:u,pdfLayout:p}=(0,C.LV)(),{selectedEntityCount:m,openEntity:f}=(0,ot.r)(),x="editor"===u||"file"===u||"sideBySide"===p;return(0,h.jsxs)(b.YZ,{autoSaveId:"ide-editor-pdf-layout",direction:"horizontal",className:k()({"ide-panel-group-resizing":e,hidden:"history"===u}),children:[(0,h.jsxs)(b.Zk,{id:"panel-ide",order:1,defaultSize:50,minSize:5,className:k()("ide-react-panel",{"ide-panel-group-resizing":e,hidden:!x}),children:[0===m&&(0,h.jsx)(Xe.A,{}),1===m&&"fileRef"===f?.type&&(0,h.jsx)(et.A,{file:(0,it.g)(f.entity)},f.entity._id),m>1&&(0,h.jsx)(tt.A,{selectedEntityCount:m}),(0,h.jsx)(pt,{})]}),(0,h.jsxs)(y.j,{resizable:"sideBySide"===p,onDoubleClick:r,onDragging:t,className:k()({hidden:!x}),hitAreaMargins:{coarse:0,fine:0},children:[(0,h.jsx)(Ve.$,{id:"editor-pdf",togglerType:"east",isOpen:l,setIsOpen:a,tooltipWhenOpen:n("tooltip_hide_pdf"),tooltipWhenClosed:n("tooltip_show_pdf")}),"sideBySide"===p&&(0,h.jsx)("div",{className:"synctex-controls",children:(0,h.jsx)(nt.Xq,{})})]}),(0,h.jsxs)(b.Zk,{ref:d,id:"panel-pdf",order:2,defaultSize:50,minSize:5,collapsible:!0,onCollapse:i,onExpand:s,className:"ide-react-panel",children:[(0,h.jsx)(rt.A,{}),"flat"===p&&"pdf"===u&&(0,h.jsx)("div",{className:"synctex-controls",hidden:!0,children:(0,h.jsx)(nt.Xq,{})})]})]})};var mt=n(2567);const ft=[{import:v,path:"/overleaf/services/web/modules/ai/frontend/js/components/promotions/overleaf-assist-paywall"}],xt=()=>{const{view:e}=(0,C.LV)(),{isRestrictedTokenMember:t}=(0,xe.mi)(),{isOpen:n,setIsOpen:r,panelRef:s,togglePane:i,handlePaneExpand:a,handlePaneCollapse:l,resizing:d,setResizing:u}=(()=>{const[e,t]=(0,o.useState)(!0),[n,r]=(0,o.useState)(!1),s=(0,o.useRef)(null);(0,Ze.A)(e,s);const i=(0,o.useCallback)((()=>{t((e=>!e))}),[]),a=(0,o.useCallback)((()=>{t(!0)}),[]),l=(0,o.useCallback)((()=>{t(!1)}),[]);return{isOpen:e,setIsOpen:t,panelRef:s,togglePane:i,handlePaneExpand:a,handlePaneCollapse:l,resizing:n,setResizing:r}})(),{isOpen:p,panelRef:m,togglePane:f,resizing:x,setResizing:j,handlePaneCollapse:_,handlePaneExpand:g}=(()=>{const{chatIsOpen:e,setChatIsOpen:t}=(0,C.LV)(),[n,r]=(0,o.useState)(!1),s=(0,o.useRef)(null),[i,a]=(0,o.useState)(e),l=(0,Qe.A)(i,100);(0,Ze.A)(e,s);const c=(0,o.useCallback)((()=>{t((e=>!e))}),[t]),d=(0,o.useCallback)((()=>{a(!0)}),[]),u=(0,o.useCallback)((()=>{a(!1)}),[]);return(0,o.useEffect)((()=>{t(l)}),[l,t]),{isOpen:e,panelRef:s,resizing:n,setResizing:r,togglePane:c,handlePaneExpand:d,handlePaneCollapse:u}})(),v=(0,oe.A)("ol-capabilities")?.includes("chat")&&!t,{t:w}=(0,c.Bd)();return(0,h.jsxs)("div",{className:"ide-react-main",children:[(0,h.jsx)(Se,{}),(0,h.jsx)("div",{className:"ide-react-body",children:(0,h.jsxs)(b.YZ,{autoSaveId:"ide-outer-layout",direction:"horizontal",className:k()({"ide-panel-group-resizing":d||x}),children:[(0,h.jsxs)(b.Zk,{ref:s,id:"panel-sidebar",order:1,defaultSize:15,minSize:5,maxSize:80,collapsible:!0,onCollapse:l,onExpand:a,children:[(0,h.jsx)(Je,{}),"history"===e&&(0,h.jsx)(Ue.N,{})]}),(0,h.jsx)(y.j,{onDoubleClick:i,resizable:n,onDragging:u,hitAreaMargins:{coarse:0,fine:0},children:(0,h.jsx)(Ve.$,{id:"panel-sidebar",togglerType:"west",isOpen:n,setIsOpen:r,tooltipWhenOpen:w("tooltip_hide_filetree"),tooltipWhenClosed:w("tooltip_show_filetree")})}),(0,h.jsx)(b.Zk,{id:"panel-outer-main",order:2,children:(0,h.jsxs)(b.YZ,{autoSaveId:"ide-inner-layout",direction:"horizontal",children:[(0,h.jsxs)(b.Zk,{className:"ide-react-panel",id:"panel-main",order:1,children:[(0,h.jsx)(mt.A,{}),(0,h.jsx)(ht,{})]}),v&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(y.j,{onDoubleClick:f,resizable:p,onDragging:j,hitAreaMargins:{coarse:0,fine:0}}),(0,h.jsx)(b.Zk,{ref:m,id:"panel-chat",order:2,defaultSize:20,minSize:5,maxSize:30,collapsible:!0,onCollapse:_,onExpand:g,children:(0,h.jsx)($e,{})})]})]})})]})}),ft.map((e=>{let{import:{default:t},path:n}=e;return(0,h.jsx)(t,{},n)}))]})};var jt=n(66020);const _t=(0,o.memo)((function(){const{setLeftMenuShown:e}=(0,C.LV)(),{userSettings:t}=(0,jt.dk)(),{editorTheme:n,overallTheme:r}=t,[s]=(0,o.useState)({editorTheme:n,overallTheme:r}),i=(0,o.useRef)(null);return(0,o.useEffect)((()=>{i.current&&(n===s.editorTheme&&r===s.overallTheme||(i.current.style.opacity="0"))}),[n,r,s]),(0,h.jsx)("div",{id:"left-menu-mask",ref:i,onClick:()=>e(!1)})}));var gt=n(18717),vt=n(7725);const bt=(0,o.lazy)((()=>Promise.all([n.e(4686),n.e(6903),n.e(7014)]).then(n.bind(n,97014)))),yt=(0,l.A)((()=>(0,h.jsx)(o.Suspense,{fallback:(0,h.jsx)(Pe.e,{delay:500}),children:(0,h.jsx)(bt,{})})),(()=>{const{t:e}=(0,c.Bd)();return(0,h.jsx)(u.A,{type:"error",content:e("something_went_wrong")})}));function wt(){const{leftMenuShown:e,setLeftMenuShown:t}=(0,C.LV)();return(0,h.jsxs)(vt.xx,{children:[(0,h.jsx)(gt.A,{show:e,onHide:()=>{t(!1)},backdropClassName:"left-menu-modal-backdrop",id:"left-menu-offcanvas",children:(0,h.jsx)(gt.A.Body,{className:k()("full-size","left-menu",{shown:e}),id:"left-menu","data-testid":"left-menu",children:(0,h.jsx)(yt,{})})}),e&&(0,h.jsx)(_t,{})]})}const kt=(0,o.memo)(wt);var Ct=n(6599),At=n(31622),Et=n(83096),Nt=n(89753);const Ft=function(){const{t:e}=(0,c.Bd)(),{socket:t}=(0,f.FX)(),{showGenericMessageModal:n}=(0,Et.T)(),{permissionsLevel:r}=(0,je.yn)(),{projectId:s,updateProject:i}=(0,ge.Om)(),a=(0,Nt.z)();(0,Ct.A)(t,"project:access:revoked",(0,o.useCallback)((()=>{n(e("removed_from_project"),e("you_have_been_removed_from_this_project_and_will_be_redirected_to_project_dashboard"));const t=window.setTimeout((()=>{a.assign("/project")}),5e3);return()=>{window.clearTimeout(t)}}),[n,e,a])),(0,Ct.A)(t,"project:publicAccessLevel:changed",(0,o.useCallback)((e=>{e.newAccessLevel&&i({publicAccessLevel:e.newAccessLevel})}),[i])),(0,Ct.A)(t,"project:collaboratorAccessLevel:changed",(0,o.useCallback)((()=>{(0,At.hu)(s).then((e=>{let{members:t}=e;t&&i({members:t})})).catch((e=>{x.$.error("Error fetching members for project",e)}))}),[s,i])),(0,Ct.A)(t,"project:membership:changed",(0,o.useCallback)((e=>{e.members&&(0,At.hu)(s).then((e=>{let{members:t}=e;t&&i({members:t})})).catch((e=>{x.$.error("Error fetching members for project",e)})),e.invites&&"owner"===r&&(0,At.kn)(s).then((e=>{let{invites:t}=e;t&&i({invites:t})})).catch((e=>{x.$.error("Error fetching invites for project",e)}))}),[s,i,r])),(0,Ct.A)(t,"mainBibliographyDocUpdated",(0,o.useCallback)((e=>{i({mainBibliographyDocId:e})}),[i])),(0,Ct.A)(t,"projectNameUpdated",(0,o.useCallback)((e=>{i({name:e})}),[i]))};function St(e,t,n){(0,o.useEffect)((()=>(e.addEventListener(t,n),()=>{e.removeEventListener(t,n)})),[e,t,n])}function Rt(){const{projectId:e}=(0,je.yn)(),{getEditorType:t}=(0,E.TS)(),n=(0,le.G)(),r=(0,o.useRef)(0),s=(0,o.useRef)(!1),i=(0,o.useRef)();(0,o.useEffect)((()=>()=>{window.clearTimeout(i.current)}),[]);const a=(0,o.useCallback)((()=>{x.$.log("[Event] heartbeat trigger");const o=t();if(null===o)return;if(s.current)return;s.current=!0;const a=function(e,t){return{editorType:e,editorRedesign:t}}(o,n);x.$.log("[Event] send heartbeat request",a),function(e,t){(0,De.mI)(`/editingSession/${e}`,{body:{segmentation:t}}).catch(x.$.error)}(e,a);const l=r.current;r.current++;const c=l<=2?30:l<=6?60*(l-2):300;i.current=window.setTimeout((()=>{s.current=!1}),1e3*c)}),[t,e,n]);(0,V.A)("cursor:editor:update",a),(0,V.A)("scroll:editor:update",a),St(document,"click",a)}var Tt=n(80760);function Lt(){const{connectionState:e}=(0,f.FX)(),{t}=(0,c.Bd)(),[n,r]=(0,o.useState)(0),[s,i]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{e.forceDisconnected&&"out-of-sync"!==e.error&&i(!0)}),[e.forceDisconnected,e.error]),(0,o.useEffect)((()=>{e.forceDisconnected&&r(e.forcedDisconnectDelay)}),[e.forceDisconnected,e.forcedDisconnectDelay]),(0,o.useEffect)((()=>{if(s){const e=window.setInterval((()=>{r((e=>Math.max(0,e-1)))}),1e3);return()=>{window.clearInterval(e)}}}),[s]),s?(0,h.jsxs)(ke.Ay,{show:!0,onHide:()=>{},className:"lock-editor-modal",backdrop:!1,keyboard:!1,children:[(0,h.jsx)(ke.IK,{children:(0,h.jsx)(ke.rA,{children:t("please_wait")})}),(0,h.jsx)(ke.$8,{children:t("were_performing_maintenance",{seconds:n})})]}):null}const It=(0,o.memo)(Lt),Dt=()=>{const{t:e}=(0,c.Bd)();return(0,h.jsx)(u.A,{type:"warning",content:(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("strong",{children:e("connection_lost_with_unsaved_changes")})," ",e("dont_reload_or_close_this_tab")," ",e("your_changes_will_save")]})})};var Pt=n(89997);const Ot=e=>{let{unsavedDocs:t}=e;return(0,h.jsx)(h.Fragment,{children:[...t.entries()].map((e=>{let[t,n]=e;return n>=15&&(0,h.jsx)(Mt,{docId:t,seconds:n},t)}))})},Mt=e=>{let{docId:t,seconds:n}=e;const{pathInFolder:r,findEntityByPath:s}=(0,Pt.m8)(),{socket:i}=(0,f.FX)(),{t:a}=(0,c.Bd)(),l=(0,o.useRef)(!1);(0,o.useEffect)((()=>{l.current||(l.current=!0,(0,N._)("unsaved-doc-alert-shown",{docId:t,transport:i.socket.transport?.name}))}),[t,i]);const d=(0,o.useMemo)((()=>{const e=r(t);return e?s(e):null}),[t,s,r]);return d?(0,h.jsx)(u.A,{type:"warning",content:a("saving_notification_with_seconds",{docname:d.entity.name,seconds:n})}):null},Bt=()=>{const{openDocs:e,debugTimers:t}=(0,E.TS)(),{permissionsLevel:n,setPermissionsLevel:r}=(0,je.yn)(),[s,i]=(0,o.useState)(!1),[a,l]=(0,o.useState)(new Map),c=(0,_.J)(),d=(0,o.useRef)(a),u=(0,o.useRef)(n);(0,o.useEffect)((()=>{u.current=n}),[n]),(0,V.A)("beforeunload",(0,o.useCallback)((t=>{e.hasUnsavedChanges()&&t.preventDefault()}),[e])),(0,o.useEffect)((()=>{const n=window.setInterval((()=>{t.current.CheckUnsavedDocs=Date.now();const n=new Map,r=e.unsavedDocs();for(const e of r){const t=e.getInflightOpCreatedAt()??e.getPendingOpCreatedAt();if(t){const r=Math.floor((performance.now()-t)/1e3);n.set(e.doc_id,r)}}(n.size>0||d.current.size>0)&&(d.current=n,l(n))}),1e3);return()=>{window.clearInterval(n)}}),[e,t]);const p=Math.max(0,...a.values());(0,o.useEffect)((()=>{i(p>30)}),[p]);const m=(0,o.useRef)(null);return(0,o.useEffect)((()=>{s?(m.current=u.current,r("readOnly"),i(!0)):m.current&&r(m.current)}),[s,r]),(0,o.useEffect)((()=>{0===a.size&&"readOnly"===u.current&&i(!1)}),[a]),c?(0,h.jsxs)(h.Fragment,{children:[s&&(0,j.createPortal)((0,h.jsx)(Dt,{}),c),a.size>0&&(0,j.createPortal)((0,h.jsx)(Ot,{unsavedDocs:a}),c)]}):null};var zt=n(37318),$t=n(79953),Vt=n(84826),Ut=n(69242),Ht=n(17112),Gt=n(14301);const qt=()=>{const{t:e}=(0,c.Bd)(),{showSwitcherModal:t,setShowSwitcherModal:n}=(0,ce.vO)(),r=(0,o.useCallback)((()=>n(!1)),[n]),{loading:s,error:i,setEditorRedesignStatus:a}=(0,Vt.Z)(),l=(0,le.G)();if(!(0,le.x)())return null;const d=l?Kt:Yt;return(0,h.jsxs)(ke.Ay,{show:t,onHide:r,className:"ide-redesign-switcher-modal",children:[(0,h.jsx)(ke.IK,{closeButton:!0,children:(0,h.jsx)(ke.rA,{children:e("the_new_overleaf_editor")})}),i&&(0,h.jsx)($t.A,{type:"error",content:i,isDismissible:!0}),(0,h.jsx)(d,{setEditorRedesignStatus:a,hide:r,loading:s})]})},Kt=e=>{let{setEditorRedesignStatus:t,hide:n,loading:r}=e;const{t:s}=(0,c.Bd)(),{sendEvent:i}=(0,Ut.D)(),a=(0,o.useCallback)((()=>{i("editor-redesign-toggle",{action:"disable",location:"modal"}),t(!1).then(n).catch((()=>{}))}),[t,n,i]),l=(0,Gt.H)();return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(ke.$8,{children:[(0,h.jsx)("h3",{children:s("youre_helping_us_shape_the_future_of_overleaf")}),(0,h.jsx)("p",{children:s("thanks_for_being_part_of_this_labs_experiment_your_feedback_will_help_us_make_the_new_editor_the_best_yet")}),(0,h.jsx)(Wt,{}),(0,h.jsx)(Jt,{})]}),(0,h.jsxs)(ke.E9,{children:[(0,h.jsx)(p.A,{onClick:a,variant:"secondary",className:"me-auto",disabled:r,children:s("switch_to_old_editor")}),(0,h.jsx)(p.A,{onClick:n,variant:"secondary",children:s("cancel")}),(0,h.jsx)(p.A,{href:l,target:"_blank",rel:"noopener noreferrer",variant:"primary",children:s("give_feedback")})]})]})},Yt=e=>{let{setEditorRedesignStatus:t,hide:n,loading:r}=e;const{t:s}=(0,c.Bd)(),{sendEvent:i}=(0,Ut.D)(),a=(0,o.useCallback)((()=>{i("editor-redesign-toggle",{action:"enable",location:"modal"}),t(!0).then(n).catch((()=>{}))}),[t,n,i]);return(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)(ke.$8,{children:[(0,h.jsx)("h3",{children:s("help_shape_the_future_of_overleaf")}),(0,h.jsx)("p",{children:s("were_redesigning_our_editor_to_make_it_easier_to_use")}),(0,h.jsx)(Wt,{}),(0,h.jsx)(Jt,{})]}),(0,h.jsxs)(ke.E9,{children:[(0,h.jsx)(p.A,{onClick:n,variant:"secondary",children:s("cancel")}),(0,h.jsx)(p.A,{onClick:a,variant:"primary",disabled:r,children:s("switch_to_new_editor")})]})]})},Wt=()=>{const{t:e}=(0,c.Bd)(),t=(0,Ht.u)("new-editor-error-logs-redesign");return(0,h.jsxs)("div",{className:"ide-redesign-switcher-modal-whats-new",children:[(0,h.jsx)("h4",{children:e("latest_updates")}),(0,h.jsxs)("ul",{children:[t&&(0,h.jsx)("li",{children:e("new_error_logs_panel")}),(0,h.jsx)("li",{children:e("searching_all_project_files_is_now_available")}),(0,h.jsx)("li",{children:e("double_clicking_on_the_pdf_shows")})]}),(0,h.jsx)("hr",{}),(0,h.jsx)("h4",{children:e("whats_different_in_the_new_editor")}),(0,h.jsxs)("ul",{children:[(0,h.jsx)("li",{children:e("new_look_and_feel")}),(0,h.jsx)("li",{children:e("new_navigation_introducing_left_hand_side_rail_and_top_menus")}),(0,h.jsx)("li",{children:e("new_look_and_placement_of_the_settings")}),(0,h.jsx)("li",{children:e("improved_dark_mode")}),(0,h.jsx)("li",{children:e("review_panel_and_error_logs_moved_to_the_left")})]})]})},Jt=()=>(0,h.jsx)("p",{className:"ide-redesign-switcher-modal-leave-text",children:(0,h.jsx)(c.x6,{i18nKey:"you_can_leave_the_experiment_from_your_account_settings_at_any_time",components:[(0,h.jsx)("a",{href:"/user/settings"})],shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})}),Zt=(0,o.memo)((()=>(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(It,{}),(0,h.jsx)(Bt,{}),(0,h.jsx)(zt.A,{}),(0,h.jsx)(qt,{})]})));Zt.displayName="Modals";const Qt=e=>{let{data:t}=e;const{t:n}=(0,c.Bd)();return t?.filePath||t.providerName?t?.filePath?t.providerName?(0,h.jsx)("span",{children:(0,h.jsx)(c.x6,{i18nKey:"a_new_reference_was_added_to_file_from_provider",shouldUnescape:!0,values:{filePath:t.filePath,provider:t.providerName},tOptions:{interpolation:{escapeValue:!0}},components:[(0,h.jsx)("strong",{})]})}):(0,h.jsx)("span",{children:(0,h.jsx)(c.x6,{i18nKey:"a_new_reference_was_added_to_file",shouldUnescape:!0,values:{filePath:t.filePath},tOptions:{interpolation:{escapeValue:!0}},components:[(0,h.jsx)("strong",{})]})}):(0,h.jsx)("span",{children:n("a_new_reference_was_added_from_provider",{provider:t.providerName})}):(0,h.jsx)("span",{children:n("a_new_reference_was_added")})},Xt=[{key:"write-and-cite:entry-added",generator:e=>({content:(0,h.jsx)(Qt,{data:e}),type:"success",autoHide:!0,delay:4e3,isDismissible:!0})}];var en=n(14875),tn=n(60230),nn=n(36712);const rn=[{import:s,path:"/overleaf/services/web/modules/references-search/frontend/js/toasts"},{import:en,path:"/overleaf/services/web/frontend/js/features/pdf-preview/components/synctex-toasts"}].map((e=>{let{import:{default:t}}=e;return t})).flat(),sn=new Map(rn.map((e=>{let{key:t,generator:n}=e;return[t,n]})));let on=1;const an=()=>{const[e,t]=(0,o.useState)([]),n=(0,o.useCallback)((e=>{t((t=>t.filter((t=>t.id!==e))))}),[]),r=(0,o.useCallback)(((e,t,r)=>{const s=sn.get(t);if(!s)return x.$.error("No toast generator found for key:",t),null;const i=s(r);return i.autoHide||i.isDismissible||(i.isDismissible=!0),i.autoHide&&!i.isDismissible&&void 0!==i.delay&&(i.delay=Math.min(i.delay,6e4)),(0,h.jsx)(tn.t,{...i,onDismiss:()=>n(e)})}),[n]),s=(0,o.useCallback)(((e,n)=>{const s="toast-"+on++,i=r(s,e,n);i&&t((e=>[...e,{id:s,component:i}]))}),[r]),i=(0,o.useCallback)((e=>{if(!e.detail?.key)return void x.$.error("No key provided for toast");const{key:t,...n}=e.detail;s(t,n)}),[s]);return(0,V.A)("ide:show-toast",i),(0,h.jsx)(nn.A,{className:"global-toasts",children:e.map((e=>{let{component:t,id:n}=e;return(0,h.jsx)(o.Fragment,{children:t},n)}))})};var ln=n(1705),cn=n(63003),dn=n(12327),un=n(24639),pn=n(35447);function hn(){return(0,h.jsx)(nn.A,{className:"editor-survey-toast",children:(0,h.jsx)(fn,{})})}const mn="editor-popup-ux-survey",fn=()=>{const[e,t]=(0,o.useState)(null),[n,r]=(0,o.useState)(null),[s,i]=(0,o.useState)("ease-of-use"),{inactiveTutorials:a}=(0,xe.mi)(),l=a.includes(mn),d=(0,le.G)(),{t:u}=(0,c.Bd)(),{tryShowingPopup:p,showPopup:m,dismissTutorial:f,completeTutorial:x}=(0,pn.A)(mn,{name:mn});(0,o.useEffect)((()=>{l||p()}),[l,p]);const j=(0,o.useCallback)((()=>{(0,N._)("editor-survey-submit",{easeOfUse:e,meetsMyNeeds:n,newEditor:d}),i("thank-you"),x({event:"promo-click",action:"complete"})}),[e,n,x,d]);return m||"thank-you"===s?"ease-of-use"===s?(0,h.jsx)(tn.t,{className:"editor-survey-question-toast",content:(0,h.jsx)(xn,{questionText:u("overleaf_is_easy_to_use"),name:"ease-of-use",buttonText:u("next"),onButtonClick:()=>i("meets-my-needs"),value:e,onValueChange:t,onDismiss:f}),type:"info"}):"meets-my-needs"===s?(0,h.jsx)(tn.t,{className:"editor-survey-question-toast",content:(0,h.jsx)(xn,{questionText:u("overleafs_functionality_meets_my_needs"),name:"meets-my-needs",buttonText:u("submit_title"),onButtonClick:j,value:n,onValueChange:r,onDismiss:f}),type:"info"}):(0,h.jsx)(tn.t,{type:"info",content:u("thank_you"),autoHide:!0,delay:3e3}):null},xn=e=>{let{onDismiss:t,name:n,questionText:r,buttonText:s,onButtonClick:i,value:a,onValueChange:l}=e;const{t:d}=(0,c.Bd)(),u=(0,o.useMemo)((()=>[{value:1,description:d("strongly_disagree")},{value:2,description:d("disagree")},{value:3,description:d("neither_agree_nor_disagree")},{value:4,description:d("agree")},{value:5,description:d("strongly_agree")}]),[d]),m=(0,o.useCallback)((e=>{const t=e.target.value;t&&l(Number(t))}),[l]);return(0,h.jsxs)("div",{className:"editor-survey-question",children:[(0,h.jsxs)("div",{className:"editor-survey-question-top-line",children:[(0,h.jsx)("div",{children:d("your_feedback_matters_answer_two_quick_questions")}),(0,h.jsx)(un.A,{variant:"ghost",size:"sm",icon:"close",accessibilityLabel:d("close"),onClick:t})]}),(0,h.jsxs)("div",{children:[(0,h.jsx)("label",{className:"editor-survey-question-label",htmlFor:n,children:r}),(0,h.jsx)(ln.A,{className:"editor-survey-question-form",children:(0,h.jsx)(dn.A,{className:"editor-survey-question-options",children:u.map((e=>{let{value:t,description:r}=e;return(0,h.jsx)(cn.A,{name:n,type:"radio",value:t,id:t.toString(),label:t,checked:t===a,onChange:m,"aria-label":`${t} ${r}`},t)}))})}),(0,h.jsxs)("div",{className:"editor-survey-option-labels",children:[(0,h.jsx)("div",{children:d("strongly_disagree")}),(0,h.jsx)("div",{children:d("strongly_agree")})]})]}),(0,h.jsx)(p.A,{size:"sm",variant:"secondary",onClick:i,disabled:!a,children:s})]})};n(57327);var jn=n(8164),_n=n(28699);const gn={ERROR:"/favicon-error.svg",COMPILING:"/favicon-compiling.svg",COMPILED:"/favicon-compiled.svg",UNCOMPILED:"/favicon.svg"},vn=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"UNCOMPILED";document.head.querySelectorAll("link[rel='icon']").forEach((e=>{e.href.endsWith(".svg")&&e.parentNode?.removeChild(e)}));const t=document.createElement("link");t.rel="icon",t.href=gn[e],t.type="image/svg+xml",t.setAttribute("data-compile-status","true"),document.head.appendChild(t)},bn=()=>!document.hidden,yn=()=>{const e=(()=>{const e=(0,jn.Rf)();return e.uncompiled?"UNCOMPILED":e.compiling?"COMPILING":e.error?"ERROR":"COMPILED"})(),t=(0,_n.A)(e),n=(()=>{const[e,t]=(0,o.useState)(bn());return(0,o.useEffect)((()=>{const e=()=>t(bn());return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),e})();(0,o.useEffect)((()=>{if(t!==e)return vn(e);if(n&&("COMPILED"===e||"ERROR"===e)){const e=setTimeout(vn,5e3);return()=>clearTimeout(e)}}),[e,n,t])},wn=(0,o.lazy)((()=>Promise.all([n.e(4686),n.e(6903),n.e(9444)]).then(n.bind(n,49444)))),kn=(0,o.lazy)((()=>n.e(5324).then(n.bind(n,15324))));function Cn(){!function(){const{view:e,leftMenuShown:t,chatIsOpen:n}=(0,C.LV)();(0,o.useEffect)((()=>{e&&"editor"!==e&&"pdf"!==e&&(0,N.JY)(`ide-open-view-${e}-once`)}),[e]),(0,o.useEffect)((()=>{t&&(0,N.JY)("ide-open-left-menu-once")}),[t]),(0,o.useEffect)((()=>{n&&(0,N.JY)("ide-open-chat-once")}),[n])}(),Ft(),Rt(),function(){const{registerUserActivity:e}=(0,f.FX)();(0,V.A)("cursor:editor:update",e),St(document.body,"click",e)}(),function useHasLintingError(){const{setHasLintingError:e}=(0,Tt.tB)();(0,V.A)("editor:lint",(0,o.useCallback)((t=>{e(t.detail.hasLintingError)}),[e]))}(),yn();const e=(0,le.G)(),t=(0,le.x)(),n=(0,Ht.u)("editor-popup-ux-survey")&&!t;return(0,h.jsxs)(_.a,{children:[(0,h.jsx)(g,{}),(0,h.jsx)(Zt,{}),e?(0,h.jsxs)(o.Suspense,{fallback:null,children:[(0,h.jsx)(kn,{}),(0,h.jsx)(wn,{})]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(kt,{}),(0,h.jsx)(xt,{})]}),(0,h.jsx)(an,{}),n&&(0,h.jsx)(hn,{})]})}var An=n(10228),En=(n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539),n(80997)),Nn=n(27602);const Fn={"io-not-loaded":"ol-translationIoNotLoaded","unable-to-join":"ol-translationUnableToJoin","i18n-error":"ol-translationLoadErrorMessage"},LoadingError=e=>{let{errorCode:t}=e;return t in Fn?(0,h.jsx)("p",{className:"loading-screen-error",children:(0,oe.A)(Fn[t])}):null},Sn=new Set(["initial"]),Rn=new Set(["initial","render","connection","translations","project"]),Tn=e=>{let{setLoaded:t}=e;const[n,r]=(0,o.useState)(Sn),s=n.size/Rn.size*100;(0,o.useEffect)((()=>{t(100===s)}),[s,t]);const{connectionState:i,isConnected:a}=(0,f.FX)(),l=(0,Nn.A)(),{projectJoined:c}=(0,je.yn)();(0,o.useEffect)((()=>{r((e=>new Set(e).add("render")))}),[]),(0,o.useEffect)((()=>{a&&r((e=>new Set(e).add("connection")))}),[a]),(0,o.useEffect)((()=>{l.isReady&&r((e=>new Set(e).add("translations")))}),[l.isReady]),(0,o.useEffect)((()=>{c&&r((e=>new Set(e).add("project")))}),[c]);const d=(0,oe.A)("ol-loadingText"),u=i.error??(l.error?"i18n-error":"");return(0,h.jsx)(Ln,{progress:s,label:d,errorCode:u})},Ln=e=>{let{progress:t,label:n,errorCode:r}=e;return(0,h.jsxs)("div",{className:"loading-screen",children:[(0,h.jsx)(En.A,{loadProgress:t,label:n,hasError:Boolean(r)}),Boolean(r)&&(0,h.jsx)(LoadingError,{errorCode:r})]})},In=()=>{const[e,t]=(0,o.useState)(!1);return(0,h.jsx)(An.F,{children:e?(0,h.jsx)(Cn,{}):(0,h.jsx)(Tn,{setLoaded:t})})},Dn=(0,l.A)((0,o.memo)(In),(()=>(0,h.jsx)(a.s,{}))),Pn=document.getElementById("ide-root");if(Pn){(0,i.H)(Pn).render((0,h.jsx)(Dn,{}))}try{if(document.body.parentElement&&document.body.parentElement?.clientHeight<document.body.clientHeight){const e=document.querySelector("#ide-root");e&&(e.style.height="100vh")}}catch{}},27916:(e,t,n)=>{n.d(t,{Lc:()=>DuplicateFilenameError,di:()=>InvalidFilenameError,ui:()=>DuplicateFilenameMoveError,yG:()=>BlockedFilenameError});n(97107);class InvalidFilenameError extends Error{constructor(){super("invalid filename")}}class BlockedFilenameError extends Error{constructor(){super("blocked filename")}}class DuplicateFilenameError extends Error{constructor(){super("duplicate filename")}}class DuplicateFilenameMoveError extends Error{constructor(){super("duplicate filename on move")}}},30158:(e,t,n)=>{n.d(t,{A:()=>w,h:()=>y});n(97107),n(82438),n(12266),n(34840);var r=n(14041),s=n(97434),i=n(10646),o=n(90214),a=n(88342),l=n(28812),c=n(22046),d=n(71627),u=n(82151),p=n(31085);const h=(0,r.lazy)((()=>n.e(6941).then(n.bind(n,16941)).then((e=>{let{ReadOnlyTokenLink:t}=e;return{default:t}})))),m=(0,r.lazy)((()=>n.e(3521).then(n.bind(n,17693))));function f(e){let{show:t,cancel:n,animation:f,inFlight:j,error:_}=e;const{t:g}=(0,s.Bd)(),{isRestrictedTokenMember:v}=(0,i.mi)();return(0,p.jsxs)(l.Ay,{show:t,onHide:n,animation:f,children:[(0,p.jsx)(l.IK,{closeButton:!0,children:(0,p.jsx)(l.rA,{children:g("share_project")})}),(0,p.jsx)(l.$8,{className:"modal-body-share modal-link-share",children:(0,p.jsxs)("div",{className:"container-fluid",children:[(0,p.jsx)(r.Suspense,{fallback:(0,p.jsx)(o.e,{minHeight:"15rem"}),children:v?(0,p.jsx)(h,{}):(0,p.jsx)(m,{})}),_&&(0,p.jsx)(c.A,{type:"error",content:(0,p.jsx)(x,{error:_}),className:"mb-0 mt-3"})]})}),(0,p.jsxs)(l.E9,{children:[(0,p.jsx)("div",{className:"me-auto",children:j&&(0,p.jsx)(u.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})}),(0,p.jsx)(a.A,{onClick:n,as:d.A,variant:"secondary",disabled:j,children:g("close")})]})]})}function x(e){let{error:t}=e;const{t:n}=(0,s.Bd)();switch(t){case"cannot_invite_non_user":return(0,p.jsx)(p.Fragment,{children:n("cannot_invite_non_user")});case"cannot_verify_user_not_robot":return(0,p.jsx)(p.Fragment,{children:n("cannot_verify_user_not_robot")});case"cannot_invite_self":return(0,p.jsx)(p.Fragment,{children:n("cannot_invite_self")});case"invalid_email":return(0,p.jsx)(p.Fragment,{children:n("invalid_email")});case"too_many_requests":return(0,p.jsx)(p.Fragment,{children:n("too_many_requests")});case"invite_expired":return(0,p.jsx)(p.Fragment,{children:n("invite_expired")});case"invite_resend_limit_hit":return(0,p.jsx)(p.Fragment,{children:n("invite_resend_limit_hit")});default:return(0,p.jsx)(p.Fragment,{children:n("generic_something_went_wrong")})}}var j=n(86316),_=n(17112),g=n(69954),v=n(37664);const b=(0,r.createContext)(void 0);function y(){const e=(0,r.useContext)(b);if(!e)throw new Error("useShareProjectContext is only available inside ShareProjectProvider");return e}const w=r.memo((function(e){let{handleHide:t,show:n,handleOpen:s,animation:o=!0}=e;const[a,l]=(0,r.useState)(!1),[c,d]=(0,r.useState)(),{project:u,projectId:h}=(0,j.Om)(),{isProjectOwner:m}=(0,i.mi)(),{splitTestVariants:x}=(0,_.d1)();(0,r.useEffect)((()=>{if(!!(m&&u&&u.features)&&-1!==u.features.collaborators&&(u.members.filter((e=>["readAndWrite","review"].includes(e.privileges))).length>(u.features.collaborators??1)||u.members.some((e=>e.pendingEditor||e.pendingReviewer)))){const e=`last-shown-share-modal.${h}`,t=v.A.getItem(e);(!t||t+864e5<Date.now())&&(s(),v.A.setItem(e,Date.now()))}}),[u,m,s,h]),(0,r.useEffect)((()=>{n&&(0,g._)("share-modal-opened",{splitTestVariant:x["null-test-share-modal"],project_id:h})}),[x,h,n]),(0,r.useEffect)((()=>{n&&d(void 0)}),[n]);const y=(0,r.useCallback)((()=>{a||t()}),[t,a]),w=(0,r.useCallback)((e=>{d(void 0),l(!0);const t=e();return t.catch((e=>{d(e.data?.errorReason||e.data?.error||"generic_something_went_wrong")})),t.finally((()=>{l(!1)})),t}),[]);return u?(0,p.jsx)(b.Provider,{value:{monitorRequest:w,inFlight:a,setInFlight:l,error:c,setError:d},children:(0,p.jsx)(f,{animation:o,cancel:y,error:c,inFlight:a,show:n})}):null}))},31352:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(61160),s=n(85886),i=n(31085);const o=function(e){return(0,i.jsx)(s.A,{children:(0,i.jsx)(r.tJ,{...e})})}},31622:(e,t,n)=>{n.d(t,{kn:()=>f,hu:()=>m,ee:()=>u,$S:()=>l,eb:()=>c,kw:()=>a,oA:()=>h,mI:()=>p,ON:()=>d});var r=n(37858);let s,i;var o=n(64932);function a(e,t,n){return function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(((t,n)=>{if(e||!window.grecaptcha)return t();try{s||(s=window.grecaptcha.render("recaptcha",{callback:e=>{i&&(i(e),i=void 0),window.grecaptcha.reset()}})),i=t}catch(e){n(e)}}))}((0,o.A)("ol-ExposedSettings").recaptchaDisabled?.invite).then((s=>(0,r.TB)(`/project/${e}/invite`,{body:{email:t,privileges:n,"g-recaptcha-response":s}})))}function l(e,t){return(0,r.TB)(`/project/${e}/invite/${t._id}/resend`)}function c(e,t){return(0,r.Un)(`/project/${e}/invite/${t._id}`)}function d(e,t,n){return(0,r.mI)(`/project/${e}/users/${t._id}`,{body:n})}function u(e,t){return(0,r.Un)(`/project/${e}/users/${t._id}`)}function p(e,t){return(0,r.TB)(`/project/${e}/transfer-ownership`,{body:{user_id:t._id}})}function h(e,t){return(0,r.TB)(`/project/${e}/settings/admin`,{body:{publicAccessLevel:t}})}function m(e){return(0,r.hm)(`/project/${e}/members`)}function f(e){return(0,r.hm)(`/project/${e}/invites`)}},32403:(e,t,n)=>{n.d(t,{a:()=>c,e:()=>u});var r=n(79953),s=n(10646),i=n(35447),o=n(14041),a=n(97434),l=n(31085);const c=e=>{let{providerName:t,isDismissible:n,onDismiss:s,className:i}=e;return(0,l.jsx)(r.A,{isDismissible:n,onDismiss:s,type:"info",className:i,content:(0,l.jsx)(a.x6,{i18nKey:"you_can_now_search_and_add_references_from_your_rm_library_without_needing_to_import_files",values:{referenceManager:t},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}},components:{code:(0,l.jsx)("code",{}),a:(0,l.jsx)("a",{href:"/learn/how-to/How_to_search_for_references_in_an_Overleaf_project#How_to_use_advanced_reference_search_(premium_feature)"})}})})},d="write-and-cite-nudge-in-linked-file",u=e=>{let{providerName:t,className:n}=e;const{inactiveTutorials:r}=(0,s.mi)(),[a,u]=(0,o.useState)(!r.includes(d)),{dismissTutorial:p}=(0,i.A)(d,{name:d}),h=(0,o.useCallback)((()=>{u(!1),p()}),[p]);return a?(0,l.jsx)(c,{providerName:t,className:n,isDismissible:!0,onDismiss:h}):null}},32524:(e,t,n)=>{n.d(t,{F:()=>i,J:()=>s});n(82438),n(34840);var r=n(60961);const s=(e,t)=>{let n=!1;const s=()=>{const s=document.cookie.split("; ").some((e=>"oa=1"===e));!n&&s&&(r.$.log("Loading Analytics",t),n=!0,e())};"function"==typeof window.requestIdleCallback?window.requestIdleCallback(s):s(),window.addEventListener("cookie-consent",(e=>{e.detail&&s()}))},i=e=>{const t=document.createElement("script");t.setAttribute("src",e.src),e.crossorigin&&t.setAttribute("crossorigin",e.crossorigin),e.async&&t.setAttribute("async","async"),e.onload&&(t.onload=e.onload),document.querySelector("head")?.append(t)}},35545:(e,t,n)=>{n.d(t,{A:()=>r});n(82438),n(50020);function r(e){return(e||[]).map((e=>r(e.children).concat(e.line))).flat()}},36266:(e,t,n)=>{n.d(t,{s:()=>c});var r=n(97434),s=n(89753),i=n(29295),o=n(96713),a=n(71627),l=n(31085);const c=e=>{let{children:t}=e;const{t:n}=(0,r.Bd)(),{reload:c}=(0,s.z)();return(0,l.jsxs)("div",{className:"error-boundary-container",children:[(0,l.jsx)(o.A,{accessibilityLabel:`${n("generic_something_went_wrong")} ${n("please_refresh")}`,type:"warning",size:"2x"}),t||(0,l.jsx)("div",{className:"error-message",children:(0,l.jsx)(i.f,{className:"small",style:{fontWeight:"bold"}})}),(0,l.jsx)(a.A,{variant:"primary",onClick:c,children:n("refresh")})]})}},36448:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var r=n(14041),s=n(28812);const i=n.p+"images/check-circle-53e6dae9ecf88000b906.svg";var o=n(64840),a=n(71627),l=n(6638),c=n(90598);const d=n.p+"images/writefull-logo-292e482d1b060164ce39.png";var u=n(64932),p=n(97434),h=n(69954),m=n(21588),f=n(31085);const x=e=>{let{show:t,origin:n,onHide:i}=e;const{t:x}=(0,p.Bd)(),g=(0,u.A)("ol-user"),v="personal"===g.planCode||g.isMemberOfGroupSubscription||g.hasInstitutionLicence,[b,y]=(0,r.useState)("personal"===g.planCode||v||g.isAnnualPlan),w=(0,u.A)("ol-addonPrices");(0,r.useEffect)((()=>{t&&(0,h._)("add-on-plans-view",{addOnType:"assistant",referrer:n})}),[t,n]);const k=(0,m.A)(b,n),C=(0,r.useCallback)((()=>{(0,h._)("add-on-plans-click",{addOnType:"assistant",origin:n}),k()}),[k,n]);return(g.planCode||g.isMemberOfGroupSubscription||g.hasInstitutionLicence)&&w?.assistant?(0,f.jsxs)(s.Ay,{className:"overleaf-assist-paywall-modal",size:"sm",show:t,onHide:i,centered:!0,children:[(0,f.jsx)(s.IK,{className:"border-0 pb-0",children:(0,f.jsx)("div",{className:"d-flex align-items-center justify-content-center w-100",children:(0,f.jsxs)("div",{className:"d-flex flex-column align-items-center",children:[(0,f.jsxs)("div",{className:"d-flex align-items-center justify-content-center gap-3 mb-2",children:[(0,f.jsx)("img",{alt:"Overleaf",src:c,"aria-hidden":"true"}),(0,f.jsx)("img",{alt:"Writefull",className:"writefull-logo",src:d,"aria-hidden":"true"})]}),(0,f.jsx)(s.rA,{className:"",children:(0,f.jsx)(j,{})})]})})}),(0,f.jsxs)(s.$8,{children:[(0,f.jsx)("p",{className:"text-center mb-4 px-4",children:x("write_faster_smarter_with_overleaf_and_writefull_ai_tools")}),(0,f.jsxs)("div",{className:"overleaf-assist-paywall-content",children:[(0,f.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("span",{className:"overleaf-assist-paywall-price",children:b?w.assistant.annualDividedByTwelve:w.assistant.monthly}),(0,f.jsx)("div",{className:"small",children:b?x("per_month_x_annually",{price:w.assistant?.annual}):x("per_month")})]}),v&&(0,f.jsxs)("div",{className:"d-flex",children:[(0,f.jsx)("span",{className:"small",children:x("annual_discount")}),(0,f.jsx)(o.A,{className:"d-flex",checked:b,onChange:()=>y(!b)})]})]}),(0,f.jsxs)("div",{className:"d-flex justify-content-between mb-3",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("strong",{children:"Overleaf LaTeX AI"}),(0,f.jsxs)("div",{className:"overleaf-assist-feature-list",children:[(0,f.jsx)(_,{children:(0,f.jsx)("strong",{children:x("error_assist")})}),(0,f.jsx)(_,{children:(0,f.jsx)("strong",{children:x("table_generator")})}),(0,f.jsx)(_,{children:(0,f.jsx)("strong",{children:x("equation_generator")})})]})]}),(0,f.jsxs)("div",{className:"feature-column w-50",children:[(0,f.jsx)("strong",{children:"Writefull language AI"}),(0,f.jsxs)("div",{className:"overleaf-assist-feature-list",children:[(0,f.jsx)(_,{children:(0,f.jsx)("strong",{children:x("language_suggestions")})}),(0,f.jsx)(_,{children:(0,f.jsx)("strong",{children:x("editing_tools")})}),(0,f.jsx)(_,{children:(0,f.jsx)("strong",{children:x("texgpt")})})]})]})]}),(0,f.jsxs)("div",{className:"d-flex flex-column align-items-center gap-1",children:[(0,f.jsxs)(a.A,{variant:"premium",type:"button",size:"lg",onClick:C,className:"w-100",children:[(0,f.jsx)("span",{children:x("add_ai_assist")}),(0,f.jsx)("img",{alt:"sparkle",className:"ai-error-assistant-sparkle",src:l,"aria-hidden":"true"})]}),(0,f.jsx)(a.A,{className:"overleaf-assist-paywall-secondary",variant:"link",onClick:i,children:x("maybe_later")})]})]}),(0,f.jsxs)("div",{className:"text-center mt-3",children:[(0,f.jsxs)("span",{className:"small",children:["*",x("fair_usage_policy_applies")]}),(0,f.jsx)(a.A,{className:"small px-1",variant:"link",href:"/learn/how-to/AI_Assist#Daily_use_limits",target:"_blank",children:x("learn_more")})]})]})]}):null};function j(){const{t:e}=(0,p.Bd)(),t=(0,u.A)("ol-user");return t.planName&&"personal"!==t.planName?(0,f.jsx)(f.Fragment,{children:e("add_unlimited_ai_to_your_overleaf_plan",{planName:t.planName})}):t.hasInstitutionLicence||t.isMemberOfGroupSubscription?(0,f.jsx)(f.Fragment,{children:e("add_unlimited_ai_to_overleaf")}):(0,f.jsx)(f.Fragment,{children:e("add_unlimited_ai_to_your_overleaf_plan",{planName:t.planName})})}function _(e){let{children:t}=e;return(0,f.jsxs)("div",{className:"overleaf-assist-paywall-list-item",children:[(0,f.jsx)("img",{className:"list-item-check-icon",alt:"check",src:i,"aria-hidden":"true"}),(0,f.jsx)("span",{children:t})]})}var g=n(89139),v=n(17112),b=n(10646);const y=()=>{const e=(0,v.u)("overleaf-assist-bundle"),t=(0,u.A)("ol-addonPrices"),[n,s]=(0,r.useState)(!1),{writefullInstance:i}=(0,b.mi)(),[o,a]=(0,r.useState)(null);(0,g.A)("aiAssist:showPaywall",(0,r.useCallback)((e=>{a(e.detail.origin||"overleaf"),s(!0)}),[])),(0,r.useEffect)((()=>{const e=e=>{a(e?.origin||"writefull"),s(!0)};return i?.addEventListener("writefull-ai-assist-show-paywall",e),()=>{i?.removeEventListener("writefull-ai-assist-show-paywall",e)}}),[i]);const l=(0,r.useCallback)((()=>s(!1)),[]);return t&&e?(0,f.jsx)(x,{show:n,origin:o,onHide:l}):null},w=(0,r.memo)(y)},36471:(e,t,n)=>{n.d(t,{J:()=>a,a:()=>o});n(97107);var r=n(14041),s=n(31085);const i=(0,r.createContext)(void 0),o=e=>{let{children:t}=e;const[n,o]=(0,r.useState)(null),a=(0,r.useCallback)((e=>{o(e)}),[]);return(0,s.jsxs)(i.Provider,{value:n,children:[(0,s.jsx)("div",{className:"global-alerts",ref:a}),t]})},a=()=>{const e=(0,r.useContext)(i);if(void 0===e)throw new Error("useGlobalAlertsContainer is only available inside GlobalAlertsProvider");return e}},37e3:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),s=n(90274);const i={status:"idle",data:null,error:null};const o=function(e){const t=r.useRef({...i,...e}),[{status:n,data:o,error:a},l]=r.useReducer(((e,t)=>({...e,...t})),t.current),c=(0,s.A)(l),d=r.useCallback((e=>c({data:e,status:"resolved"})),[c]),u=r.useCallback((e=>c({error:e,status:"rejected"})),[c]),p=r.useCallback((()=>c(t.current)),[c]),h=r.useCallback((e=>(c({status:"pending"}),e.then((e=>(d(e),e)),(e=>(u(e),Promise.reject(e)))))),[c,d,u]);return{isIdle:"idle"===n,isLoading:"pending"===n,isError:"rejected"===n,isSuccess:"resolved"===n,setData:d,setError:u,error:a,status:n,data:o,runAsync:h,reset:p}}},37318:(e,t,n)=>{n.d(t,{A:()=>m});n(82438),n(50020);var r=n(14041),s=n(75962),i=n(42093),o=n(31085);const a=function(e){let{id:t,children:n}=e;const[r,a]=(0,i.A)(`systemMessage.hide.${t}`,!1);return r?null:(0,o.jsxs)("li",{className:"system-message",children:["protected"!==t?(0,o.jsx)(s.A,{onDismiss:()=>a(!0),variant:"dark"}):null,n]})};var l=n(97434),c=n(64932);const d=function(){const{t:e}=(0,l.Bd)(),[t,n]=(0,i.A)("hide-i18n-notification",!1),r=(0,c.A)("ol-suggestedLanguage"),a=(0,c.A)("ol-currentUrl");return t?null:(0,o.jsxs)("li",{className:"system-message",children:[(0,o.jsx)(s.A,{onDismiss:()=>n(!0)}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsxs)("a",{href:r.url+a,children:[(0,o.jsx)(l.x6,{i18nKey:"click_here_to_view_sl_in_lng",components:[(0,o.jsx)("strong",{})],values:{lngName:r.lngName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}}),(0,o.jsx)("img",{className:"ms-1",src:r.imgUrl,alt:e("country_flag",{country:r.lngName}),"aria-hidden":!0})]})})]})};var u=n(37e3),p=n(37858),h=n(60961);const m=function(){const{data:e,runAsync:t}=(0,u.A)(),n=(0,c.A)("ol-suggestedLanguage");return(0,r.useEffect)((()=>{const e=()=>{!document.hidden&&navigator.onLine&&t((0,p.hm)("/system/messages")).catch(h.$.error)};e();const n=setInterval(e,9e5);return()=>{clearInterval(n)}}),[t]),e?.length||n?(0,o.jsxs)("ul",{className:"system-messages",children:[e?.map(((e,t)=>(0,o.jsx)(a,{id:e._id,children:e.content},t))),n?(0,o.jsx)(d,{}):null]}):null}},41260:(e,t,n)=>{n.d(t,{R:()=>i});var r=n(90214),s=n(31085);const i=()=>(0,s.jsx)("div",{className:"loading-panel",children:(0,s.jsx)(r.A,{})})},42615:(e,t,n)=>{n.d(t,{h:()=>Yt});var r={};n.r(r),n.d(r,{default:()=>ce});var s={};n.r(s),n.d(s,{CreateFileMode:()=>jt,CreateFilePane:()=>_t});var i={};n.r(i),n.d(i,{CreateFileMode:()=>gt,CreateFilePane:()=>vt});var o={};n.r(o),n.d(o,{CreateFileMode:()=>bt,CreateFilePane:()=>yt});var a=n(14041),l=n(85960),c=n(78494),d=n(16896),u=n(67984),p=n(86316),h=n(60440),m=n(11787),f=n(92902),x=n(88588),j=(n(82438),n(12266),n(50020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539),n(97434)),_=n(95014),g=n(52924),v=n(97484),b=n(81257),y=n(3762),w=n(24480),k=n(45186),C=n(6896),A=n(4816),E=n(31085);const N="ENTITY",F=e=>{let{fileTreeContainer:t,children:n}=e;const r=(0,a.useMemo)((()=>({rootElement:t})),[t]);return(0,E.jsx)(g.Q,{backend:y.t2,options:r,children:n})};function S(e){const{t}=(0,j.Bd)(),{fileTreeData:n,fileTreeReadOnly:r}=(0,h.Q)(),{selectedEntityIds:s,isRootFolderSelected:i}=(0,x.G1)(),{finishMoving:o}=(0,f.m)(),[l,c]=(0,a.useState)(!0),[,d,u]=(0,v.i)({type:N,item(){const r=function(e,t){return e.size>1&&e.has(t)?new Set(e):new Set([t])}(i?new Set:s,e),o=(0,C.jr)(n,r);return{type:N,title:T(o,t),forbiddenFolderIds:L(o),draggedEntityIds:r}},canDrag:()=>!r&&l,end(e,t){if(t.didDrop()){const n=t.getDropResult();n&&o(n.targetEntityId,e.draggedEntityIds)}}});return(0,a.useEffect)((()=>{u((0,w.n)())}),[u]),{dragRef:d,setIsDraggable:c}}function R(e){const{setDroppedFiles:t,startUploadingDocOrFile:n}=(0,f.m)(),[{isOver:r},s]=(0,b.H)({accept:[N,k.FILE],canDrop:(t,n)=>!!n.isOver({shallow:!0})&&!(t.type===N&&t.forbiddenFolderIds.has(e)),drop(r,s){if(!s.didDrop())return r.type===N?{targetEntityId:e}:void(0,_.A)(r).then((e=>e.filter((e=>(0,A.n)(e.name,e.relativePath))))).then((r=>{t({files:r,targetFolderId:e}),n()}))},collect:e=>({isOver:e.canDrop()})});return{dropRef:s,isOver:r}}function T(e,t){if(1===e.size){return Array.from(e)[0].entity.name}return t("n_items",{count:e.size})}function L(e){const t=Array.from(e).filter((e=>"folder"===e.type)).map((e=>e.entity)),n=new Set(t);return(0,C.b_)(n)}const I=e=>{let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:s,fileTreeContainer:i,children:o}=e;return(0,E.jsx)(m.r,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,children:(0,E.jsx)(x.k2,{onSelect:s,children:(0,E.jsx)(f.g,{children:(0,E.jsx)(F,{fileTreeContainer:i,children:o})})})})};var D=n(53373),P=n.n(D);function O(e){let{title:t}=e;return(0,E.jsx)("div",{className:"dnd-draggable-preview-item",children:t})}function M(e,t){if(!t||!e)return{display:"none"};const{x:n,y:r}=t,{x:s,y:i}=e,o=`translate(${s-n-15}px, ${i-r-15}px)`;return{transform:o,WebkitTransform:o}}const B=function(e){let{isOver:t,isDragging:n,item:r,clientOffset:s}=e;const i=(0,a.useRef)(null);return(0,E.jsx)("div",{ref:i,className:P()("dnd-draggable-preview-layer",{"dnd-droppable-hover":t}),children:n&&r?.title&&(0,E.jsx)("div",{style:M(s,i.current?.getBoundingClientRect()),children:(0,E.jsx)(O,{title:r.title})})})};var z=n(23823),$=n(96713),V=n(97536);const U=function(e){let{isLinkedFile:t,name:n}=e;const{t:r}=(0,j.Bd)(),s=P()("file-tree-icon",{"linked-file-icon":t});return(0,V.G)()?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)($.A,{unfilled:!0,type:(0,z.o)(n),className:s}),t&&(0,E.jsx)($.A,{type:"open_in_new",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:r("linked_file")})]}):(0,E.jsxs)(E.Fragment,{children:[" ",(0,E.jsx)($.A,{type:(0,z.A)(n),className:s}),t&&(0,E.jsx)($.A,{type:"open_in_new",modifier:"rotate-180",className:"linked-file-highlight",accessibilityLabel:r("linked_file")})]})};var H=n(14935),G=n(93045);function q(e){let{name:t,isSelected:n,startRenaming:r}=e;const[s,i]=(0,a.useState)(0);return(0,E.jsx)("button",{className:"item-name-button",onClick:function(){i(s+1),n||i(0)},onDoubleClick:function(){s<2||r()},children:(0,E.jsx)("span",{children:t})})}function K(e){let{initialValue:t,finishRenaming:n,cancel:r}=e;const[s,i]=(0,a.useState)(t),{autoFocusedRef:o}=(0,G.U)();return(0,E.jsx)("span",{className:"rename-input",children:(0,E.jsx)("input",{type:"text",value:s,onKeyDown:function(e){"Enter"===e.key&&n(s),"Escape"===e.key&&r()},onChange:function(e){i(e.target.value)},onBlur:function(){n(s)},onFocus:function(e){const t=e.target.value.lastIndexOf(".");e.target.setSelectionRange(0,t)},ref:o})})}const Y=function(e){let{name:t,isSelected:n,setIsDraggable:r}=e;const{isRenaming:s,startRenaming:i,finishRenaming:o,error:l,cancel:c}=(0,f.m)(),d=s&&n&&!l;return(0,a.useEffect)((()=>{r(!d)}),[r,d]),d?(0,E.jsx)(K,{initialValue:t,finishRenaming:o,cancel:c}):(0,E.jsx)(q,{name:t,isSelected:n,startRenaming:i})};const W=function(e){let{id:t,name:n}=e;const{t:r}=(0,j.Bd)(),{contextMenuCoords:s,setContextMenuCoords:i}=(0,m.e)(),o=(0,a.useRef)(null),l=Boolean(s);return(0,E.jsx)("div",{className:"menu-button btn-group",children:(0,E.jsx)("button",{className:"entity-menu-toggle btn btn-sm",id:`menu-button-${t}`,onClick:function(e){if(e.stopPropagation(),!s&&o.current){const e=o.current.getBoundingClientRect();i({top:e.top+e.height/2,left:e.right})}else i(null)},ref:o,"aria-haspopup":"true","aria-expanded":l,"aria-label":r("open_action_menu",{name:n}),children:(0,E.jsx)($.A,{type:"more_vert",accessibilityLabel:r("menu")})})})};var J=n(5658);const Z=function(e){let{id:t,name:n,type:r,isSelected:s,icons:i}=e;const{fileTreeReadOnly:o}=(0,h.Q)(),{setContextMenuCoords:l}=(0,m.e)(),{isRenaming:c}=(0,f.m)(),{selectedEntityIds:d}=(0,x.G1)(),u=!o&&s&&1===d.size,{dragRef:p,setIsDraggable:j}=S(t),_=(0,J.u)().getMonitor().getItem(),g=(0,a.useRef)(null);return(0,a.useEffect)((()=>{const e=g.current;s&&e&&setTimeout((()=>{e&&(0,H.A)(e,{scrollMode:"if-needed"})}),100)}),[s,g]),(0,E.jsx)("div",{className:P()("entity",{"file-tree-entity-dragging":_?.draggedEntityIds?.has(t)}),role:"presentation",ref:p,draggable:!c,onContextMenu:function(e){e.preventDefault(),l({top:e.pageY,left:e.pageX})},"data-file-id":t,"data-file-type":r,children:(0,E.jsxs)("div",{className:"entity-name entity-name-react",role:"presentation",ref:g,children:[i,(0,E.jsx)(Y,{name:n,isSelected:s,setIsDraggable:j}),u?(0,E.jsx)(W,{id:t,name:n}):null]})})};const Q=function(e){let{name:t,id:n,isFile:r,isLinkedFile:s}=e;const i=r?"file":"doc",{isSelected:o,props:a}=(0,x.hj)(n,i);return(0,E.jsx)("li",{role:"treeitem",...a,"aria-label":t,tabIndex:0,translate:"no",children:(0,E.jsx)(Z,{id:n,name:t,type:i,isSelected:o,icons:(0,E.jsx)(U,{isLinkedFile:s,name:t})})})};var X=n(42093);const ee=function(e){let{expanded:t,onExpandCollapseClick:n}=e;const{t:r}=(0,j.Bd)();return(0,V.G)()?(0,E.jsx)(E.Fragment,{children:(0,E.jsx)("button",{className:"folder-expand-collapse-button",onClick:n,"aria-label":r(t?"collapse":"expand"),children:(0,E.jsx)($.A,{type:t?"expand_more":"chevron_right",className:"file-tree-expand-icon"})})}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("button",{onClick:n,"aria-label":r(t?"collapse":"expand"),children:(0,E.jsx)($.A,{type:t?"expand_more":"chevron_right",className:"file-tree-expand-icon"})}),(0,E.jsx)($.A,{type:t?"folder_open":"folder",className:"file-tree-folder-icon"})]})};const te=function(e){let{name:t,id:n,folders:r,docs:s,files:i}=e;const{isSelected:o,props:l}=(0,x.hj)(n,"folder"),{selectedEntityParentIds:c}=(0,x.G1)(),[d,u]=(0,X.A)(`folder.${n}.expanded`,!1);(0,a.useEffect)((()=>{c.has(n)&&u(!0)}),[n,c,u]);const{isOver:p,dropRef:h}=R(n),{isOver:m,dropRef:f}=R(n);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("li",{role:"treeitem",...l,"aria-expanded":d,"aria-label":t,tabIndex:0,ref:h,className:P()(l.className,{"dnd-droppable-hover":p||m}),translate:"no",children:(0,E.jsx)(Z,{id:n,name:t,type:"folder",isSelected:o,icons:(0,E.jsx)(ee,{expanded:d,onExpandCollapseClick:function(){u(!d)}})})}),d?(0,E.jsx)(se,{folders:r,docs:s,files:i,dropRef:f}):null]})};var ne=n(45857);function re(e,t){return ne.h.compare(e.name,t.name)}const se=function(e){let{folders:t,docs:n,files:r,classes:s={},dropRef:i=null,children:o,dataTestId:a}=e;r=r.map((e=>({...e,isFile:!0})));const l=[...n,...r];return(0,E.jsx)("ul",{className:P()("list-unstyled","file-tree-folder-list",s.root),role:"tree",ref:i,"data-testid":a,children:(0,E.jsxs)("div",{className:"file-tree-folder-list-inner",children:[t.sort(re).map((e=>(0,E.jsx)(te,{name:e.name,id:e._id,folders:e.folders,docs:e.docs,files:e.fileRefs},e._id))),l.sort(re).map((e=>"isFile"in e?(0,E.jsx)(Q,{name:e.name,id:e._id,isFile:e.isFile,isLinkedFile:e.linkedFileData&&!!e.linkedFileData.provider},e._id):(0,E.jsx)(Q,{name:e.name,id:e._id},e._id))),o]})})};var ie=n(59162),oe=n(56447),ae=n(94857),le=n(22440);const ce=()=>{const{projectSearchIsOpen:e,setProjectSearchIsOpen:t}=(0,oe.LV)(),{t:n}=(0,j.Bd)(),r=(0,a.useMemo)((()=>({id:"search",description:(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{children:n("search_project")}),(0,E.jsx)("div",{children:ae.c?"⇧⌘F":"Ctrl+Shift+F"})]}),overlayProps:{placement:"bottom"}})),[n]);return(0,E.jsx)(ie.A,{...r,children:(0,E.jsx)("button",{className:P()("btn",{active:e}),onClick:()=>{e||(0,le.T)("search-open",{searchType:"full-project",method:"button",location:"toolbar"}),t((e=>!e))},tabIndex:-1,"data-active":e,children:(0,E.jsx)($.A,{type:"search",accessibilityLabel:n("search")})})})};var de=n(69954),ue=n(98509);const pe=[{import:r,path:"/overleaf/services/web/modules/full-project-search/frontend/js/components/full-project-search-button.tsx"}];function he(){const{t:e}=(0,j.Bd)(),{canCreate:t,startCreatingFolder:n,startCreatingDocOrFile:r,startUploadingDocOrFile:s}=(0,f.m)();return t?(0,E.jsxs)("div",{className:"toolbar-left",children:[(0,E.jsx)(ie.A,{id:"new-file",description:e("new_file"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:()=>{de._("new-file-click",{location:"toolbar"}),r()},children:(0,E.jsx)($.A,{type:"description",accessibilityLabel:e("new_file")})})}),(0,E.jsx)(ie.A,{id:"new-folder",description:e("new_folder"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:n,tabIndex:-1,children:(0,E.jsx)($.A,{type:"folder",accessibilityLabel:e("new_folder")})})}),(0,E.jsx)(ie.A,{id:"upload",description:e("upload"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:()=>{de._("upload-click",{location:"toolbar"}),s()},tabIndex:-1,children:(0,E.jsx)($.A,{type:"upload",accessibilityLabel:e("upload")})})})]}):null}function me(){const{t:e}=(0,j.Bd)(),{canRename:t,canDelete:n,startRenaming:r,startDeleting:s}=(0,f.m)();return(0,E.jsxs)("div",{className:"toolbar-right",children:[pe.map((e=>{let{import:{default:t},path:n}=e;return(0,E.jsx)(t,{},n)})),t?(0,E.jsx)(ie.A,{id:"rename",description:e("rename"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:r,tabIndex:-1,children:(0,E.jsx)($.A,{type:"edit",accessibilityLabel:e("rename")})})}):null,n?(0,E.jsx)(ie.A,{id:"delete",description:e("delete"),overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn",onClick:s,tabIndex:-1,children:(0,E.jsx)($.A,{type:"delete",accessibilityLabel:e("delete")})})}):null]})}const fe=function(){const{fileTreeReadOnly:e}=(0,h.Q)(),{t}=(0,j.Bd)();return e?null:(0,E.jsxs)(ue.A,{className:"toolbar toolbar-filetree","aria-label":t("project_files"),children:[(0,E.jsx)(he,{}),(0,E.jsx)(me,{})]})};var xe=n(6539),je=n(17905),_e=n(58516);function ge(e){let{id:t,description:n,onClick:r,iconType:s}=e;return(0,E.jsx)(ie.A,{id:t,description:n,overlayProps:{placement:"bottom"},children:(0,E.jsx)("button",{className:"btn file-tree-toolbar-action-button",onClick:r,children:(0,E.jsx)($.A,{unfilled:!0,type:s,accessibilityLabel:n})})})}var ve=n(70569);function be(){const{t:e}=(0,j.Bd)(),{fileTreeReadOnly:t}=(0,h.Q)(),{write:n}=(0,_e.Tg)(),{handlePaneCollapse:r}=(0,ve.h)(),{canCreate:s,canBulkDelete:i,startDeleting:o,startCreatingFolder:a,startCreatingDocOrFile:l,startUploadingDocOrFile:c}=(0,f.m)();if((0,je.w)((()=>{if(s&&!t&&n)return[{label:e("new_file"),id:"new_file",handler:e=>{let{location:t}=e;de._("new-file-click",{location:t}),l()}},{label:e("new_folder"),id:"new_folder",handler:a},{label:e("upload_file"),id:"upload_file",handler:e=>{let{location:t}=e;de._("upload-click",{location:t}),c()}}]}),[s,t,l,e,a,c,n]),t)return null;return(0,E.jsxs)("div",{className:"file-tree-toolbar-action-buttons",children:[s&&(0,E.jsx)(ge,{id:"new-file",description:e("new_file"),onClick:()=>{de._("new-file-click",{location:"toolbar"}),l()},iconType:"note_add"}),s&&(0,E.jsx)(ge,{id:"new-folder",description:e("new_folder"),onClick:a,iconType:"create_new_folder"}),s&&(0,E.jsx)(ge,{id:"upload",description:e("upload"),onClick:()=>{de._("upload-click",{location:"toolbar"}),c()},iconType:"upload"}),i&&(0,E.jsx)(ge,{id:"delete",description:e("delete"),onClick:o,iconType:"delete"}),(0,E.jsx)(ge,{id:"close",description:e("close"),onClick:r,iconType:"close"})]})}const ye=function(){const{t:e}=(0,j.Bd)(),{fileTreeExpanded:t,toggleFileTreeExpanded:n}=(0,xe.A)();return(0,E.jsxs)("div",{className:"file-tree-toolbar",children:[(0,E.jsxs)("button",{className:"file-tree-expand-collapse-button",onClick:n,"aria-label":e(t?"hide_file_tree":"show_file_tree"),children:[(0,E.jsx)($.A,{type:t?"keyboard_arrow_down":"keyboard_arrow_right"}),(0,E.jsx)("h4",{children:e("file_tree")})]}),(0,E.jsx)(be,{})]})};var we=n(28812),ke=n(71627),Ce=n(22046);const Ae=function(){const{t:e}=(0,j.Bd)(),{isDeleting:t,inFlight:n,finishDeleting:r,actionedEntities:s,cancel:i,error:o}=(0,f.m)(),{select:a}=(0,x.G1)();if(!t)return null;function l(){i()}return(0,E.jsxs)(we.Ay,{show:!0,onHide:l,children:[(0,E.jsx)(we.IK,{children:(0,E.jsx)(we.rA,{children:e("delete")})}),(0,E.jsxs)(we.$8,{children:[(0,E.jsx)("p",{children:e("sure_you_want_to_delete")}),(0,E.jsx)("ul",{children:s.map((e=>(0,E.jsx)("li",{children:e.name},e._id)))}),o&&(0,E.jsx)(Ce.A,{type:"error",content:e("generic_something_went_wrong")})]}),(0,E.jsx)(we.E9,{children:n?(0,E.jsx)(ke.A,{variant:"danger",disabled:!0,isLoading:!0}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ke.A,{variant:"secondary",onClick:l,children:e("cancel")}),(0,E.jsx)(ke.A,{variant:"danger",onClick:function(){a([]),r()},children:e("delete")})]})})]})};var Ee=n(27916),Ne=n(89761);function Fe(e){let{name:t,setName:n,validName:r,setValidName:s,handleCreateFolder:i}=e;const{autoFocusedRef:o}=(0,G.U)();return(0,E.jsx)("input",{ref:o,className:"form-control",type:"text",value:t,onKeyDown:function(e){"Enter"===e.key&&r&&i()},onChange:function(e){s((0,Ne.tL)(e.target.value.trim())),n(e.target.value)},onFocus:function(e){e.target.setSelectionRange(0,-1)}})}const Se=function(){const{t:e}=(0,j.Bd)(),[t,n]=(0,a.useState)(""),[r,s]=(0,a.useState)(!0),{isCreatingFolder:i,inFlight:o,finishCreatingFolder:l,cancel:c,error:d}=(0,f.m)();if((0,a.useEffect)((()=>{i||n("")}),[i]),!i)return null;function u(){c()}function p(){l(t)}function h(){return d.constructor===Ee.Lc?e("file_already_exists"):e("generic_something_went_wrong")}return(0,E.jsxs)(we.Ay,{show:!0,onHide:u,children:[(0,E.jsx)(we.IK,{children:(0,E.jsx)(we.rA,{children:e("new_folder")})}),(0,E.jsxs)(we.$8,{children:[(0,E.jsx)(Fe,{name:t,setName:n,validName:r,setValidName:s,handleCreateFolder:p}),r?null:(0,E.jsx)("div",{role:"alert","aria-label":e("files_cannot_include_invalid_characters"),className:"alert alert-danger file-tree-modal-alert",children:e("files_cannot_include_invalid_characters")}),d?(0,E.jsx)("div",{role:"alert","aria-label":h(),className:"alert alert-danger file-tree-modal-alert",children:h()}):null]}),(0,E.jsx)(we.E9,{children:o?(0,E.jsx)(ke.A,{variant:"primary",disabled:!0,isLoading:o}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(ke.A,{variant:"secondary",onClick:u,children:e("cancel")}),(0,E.jsx)(ke.A,{variant:"primary",onClick:p,disabled:!r,children:e("create")})]})})]})};const Re=function FileTreeModalError(){const{t:e}=(0,j.Bd)(),{isRenaming:t,isMoving:n,cancel:r,error:s}=(0,f.m)();if(!s)return null;if(!t&&!n)return null;function i(){r()}function o(){switch(s.constructor){case Ee.Lc:return e("file_already_exists");case Ee.ui:return(0,E.jsx)(j.x6,{i18nKey:"file_already_exists_in_this_location",components:[(0,E.jsx)("strong",{})],values:{fileName:s.entityName},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}});case Ee.di:return e("files_cannot_include_invalid_characters");case Ee.yG:return e("blocked_filename");default:return e("generic_something_went_wrong")}}return(0,E.jsxs)(we.Ay,{show:!0,onHide:i,children:[(0,E.jsx)(we.IK,{children:(0,E.jsx)(we.rA,{children:function(){switch(s.constructor){case Ee.Lc:case Ee.ui:return e("duplicate_file");case Ee.di:case Ee.yG:return e("invalid_file_name");default:return e("error")}}()})}),(0,E.jsx)(we.$8,{children:(0,E.jsx)("div",{role:"alert","aria-label":o(),children:o()})}),(0,E.jsx)(we.E9,{children:(0,E.jsx)(ke.A,{onClick:i,variant:"primary",children:e("ok")})})]})};var Te=n(43144),Le=n(61160);const Ie=function(){const{t:e}=(0,j.Bd)(),{canRename:t,canDelete:n,canCreate:r,startRenaming:s,startDeleting:i,startCreatingFolder:o,startCreatingDocOrFile:l,startUploadingDocOrFile:c,downloadPath:d,selectedFileName:u}=(0,f.m)(),{project:h}=(0,p.Om)(),m=h?.owner?._id,x=(0,a.useCallback)((()=>{u?.endsWith(".bib")&&de._("download-bib-file",{projectOwner:m})}),[u,m]),_=(0,a.useCallback)((()=>{de._("new-file-click",{location:"file-menu"}),l()}),[l]),g=(0,a.useCallback)((()=>{de._("upload-click",{location:"file-menu"}),c()}),[c]);return(0,E.jsxs)(E.Fragment,{children:[t?(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:s,children:e("rename")})}):null,d?(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{href:d,onClick:x,download:u??void 0,children:e("download")})}):null,n?(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:i,children:e("delete")})}):null,r?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(Le.rx,{}),(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:_,children:e("new_file")})}),(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:o,children:e("new_folder")})}),(0,E.jsx)("li",{role:"none",children:(0,E.jsx)(Le.tJ,{onClick:g,children:e("upload")})})]}):null]})};const De=function(){const{fileTreeReadOnly:e}=(0,h.Q)(),{contextMenuCoords:t,setContextMenuCoords:n}=(0,m.e)(),r=(0,a.useRef)(null),s=(0,a.useRef)(!1);function i(){t&&(n(null),r.current&&r.current.focus())}(0,a.useEffect)((()=>{t&&(r.current=document.querySelector(".entity-menu-toggle"))}),[t]),(0,a.useEffect)((()=>{if(t&&s.current){const e=document.querySelector("#dropdown-file-tree-context-menu .dropdown-item:not([disabled])");e&&e.focus()}}),[t]);const o=(0,a.useCallback)((()=>{s.current=!0}),[]),l=(0,a.useCallback)((()=>{s.current=!1}),[]);return(0,a.useEffect)((()=>(document.addEventListener("keydown",o),document.addEventListener("mousedown",l),()=>{document.removeEventListener("keydown",o),document.removeEventListener("mousedown",l)})),[o,l]),!t||e?null:Te.createPortal((0,E.jsx)("div",{style:t,className:"context-menu",children:(0,E.jsx)(Le.ms,{show:!0,drop:document.body.offsetHeight/t.top<2&&document.body.offsetHeight-t.top<250?"up":"down",onKeyDown:function(e){"Tab"!==e.key&&"Escape"!==e.key||(e.preventDefault(),i())},onToggle:function(e){e||i()},children:(0,E.jsx)(Le.rI,{className:"dropdown-menu-sm-width",id:"dropdown-file-tree-context-menu",children:(0,E.jsx)(Ie,{})})})}),document.body)};var Pe=n(89753);const Oe=function FileTreeError(){const{t:e}=(0,j.Bd)(),{reload:t}=(0,Pe.z)();return(0,E.jsxs)("div",{className:"file-tree-error",children:[(0,E.jsx)("p",{children:e("generic_something_went_wrong")}),(0,E.jsx)("p",{children:e("please_refresh")}),(0,E.jsx)(ke.A,{variant:"primary",onClick:t,children:e("refresh")})]})};var Me=n(67353),Be=n(65982);n(97107);const ze=(0,a.createContext)(void 0),$e=()=>{const e=(0,a.useContext)(ze);if(!e)throw new Error("useFileTreeCreateForm is only available inside FileTreeCreateFormProvider");return e},Ve=e=>{let{children:t}=e;const[n,r]=(0,a.useState)(!1);return(0,E.jsx)(ze.Provider,{value:{valid:n,setValid:r},children:t})};function Ue(e){let{mode:t,icon:n,label:r}=e;const{newFileCreateMode:s,startCreatingFile:i}=(0,f.m)();return(0,E.jsx)("li",{className:P()({active:s===t}),children:(0,E.jsx)(ke.A,{variant:"link",onClick:()=>{i(t),de._("file-modal-click",{method:t})},className:"modal-new-file-mode",leadingIcon:n,children:r})})}const He=(0,a.createContext)(void 0),Ge=()=>{const e=(0,a.useContext)(He);if(!e)throw new Error("useFileTreeCreateName is only available inside FileTreeCreateNameProvider");return e},qe=e=>{let{children:t,initialName:n=""}=e;const[r,s]=(0,a.useReducer)(((e,t)=>({name:t,touchedName:!0})),{name:n,touchedName:!1}),i=(0,a.useMemo)((()=>(0,Ne.tL)(r.name.trim())),[r]);return(0,E.jsx)(He.Provider,{value:{...r,setName:s,validName:i},children:t})};var Ke=n(18730),Ye=n(12327),We=n(96700),Je=n(7829);function Ze(e){let{label:t,focusName:n=!1,classes:r={},placeholder:s,error:i,inFlight:o}=e;const{t:l}=(0,j.Bd)(),{name:c,setName:d,touchedName:u,validName:p}=Ge(),h=(0,a.useRef)(null);return(0,a.useEffect)((()=>{h.current&&n&&window.requestAnimationFrame((()=>{h.current&&(h.current.focus(),h.current.setSelectionRange(0,h.current.value.lastIndexOf(".")))}))}),[n]),(0,E.jsxs)(Ye.A,{controlId:"new-doc-name",className:r.formGroup,children:[(0,E.jsx)(We.A,{children:t||l("file_name")}),(0,E.jsx)(Je.A,{type:"text",placeholder:s||l("file_name"),required:!0,value:c,onChange:e=>d(e.target.value),ref:h,disabled:o}),u&&!p&&(0,E.jsx)(Ce.A,{type:"error",className:"row-spaced-small",content:l("files_cannot_include_invalid_characters")}),i&&(0,E.jsx)(Qe,{error:i})]})}function Qe(e){let{error:t}=e;const{t:n}=(0,j.Bd)();switch(t.constructor){case Ee.Lc:return(0,E.jsx)(Ce.A,{type:"error",className:"row-spaced-small",content:n("file_already_exists")});case Ee.di:return(0,E.jsx)(Ce.A,{type:"error",className:"row-spaced-small",content:n("files_cannot_include_invalid_characters")});case Ee.yG:return(0,E.jsx)(Ce.A,{type:"error",className:"row-spaced-small",content:n("blocked_filename")});default:return null}}var Xe=n(47475),et=n(3518),tt=n(4607),nt=n(39067),rt=n.n(nt),st=n(85868);function it(e){let{provider:t,data:n,selectedGroupId:r,setSelectedGroupId:s}=e;const{t:i}=(0,j.Bd)();return(0,E.jsxs)(Ye.A,{controlId:"group-select",children:[(0,E.jsx)(We.A,{children:i("mendeley"===t?"select_a_group_optional":"library")}),(0,E.jsxs)(Je.A,{as:st.A,value:r||"",onChange:e=>s(e.target.value),children:[(0,E.jsx)("option",{value:"",children:i("my_library")}),(0,E.jsx)("option",{disabled:!0,value:"_",children:i("mendeley"===t?"groups":"group_libraries")}),n.map((e=>(0,E.jsx)("option",{value:e.id,children:e.name},e.id)))]})]})}it.propTypes={provider:rt().string.isRequired,data:rt().arrayOf(rt().object).isRequired,selectedGroupId:rt().string,setSelectedGroupId:rt().func.isRequired};const ot=n.p+"images/stack-of-books-rotated-9dc2167881c1d6492232.svg";var at=n(13653),lt=n(94012),ct=n(82151),dt=n(79953),ut=n(32403);function pt(e){let{provider:t,providerName:n,supportsGroups:r=!1,supportsFormat:s=!1,separatePersonalLibrary:i=!0}=e;const{t:o}=(0,j.Bd)(),{name:c,validName:d}=Ge(),{setValid:u}=$e(),{features:p}=(0,l.ur)(),{refProviders:h,setStartedFreeTrial:x,setRefProviderEnabled:_}=(0,m.e)(),{error:g,finishCreatingLinkedFile:v,inFlight:b}=(0,f.m)(),{indexAllReferences:y}=(0,lt.B4)(),[w,k]=(0,a.useState)(""),[C,A]=(0,a.useState)("bibtex");(0,at.Q)((0,a.useCallback)((e=>{e.refProviders&&t in e.refProviders&&(_(t,!1),window.setTimeout((()=>{_(t,e.refProviders[t])})))}),[t,_]));const N=p?.references||p?.[t]||!1,F=N&&h[t],S=(0,a.useCallback)((()=>{de._("link-integration-click",{integration:t,location:"Editor"}),window.open(`/${t}/oauth`,"reference-auth","width=700,height=500")}),[t]),R=(0,Ke.J)(t,r&&F),T=i||""!==w;(0,a.useEffect)((()=>{u(d&&F&&!R.error&&T)}),[u,d,F,R.error,T]);const L=(0,a.useCallback)((e=>{e.preventDefault();const n={};w&&(n.group_id=w),s&&(n.format=C),v({name:c,provider:t,data:n}).then((()=>{y(!0)})),de._("new-file-created",{method:t,extension:c.split(".").length>1?c.split(".").pop():""})}),[c,w,t,v,C,y,s]);return N?(0,E.jsxs)("div",{className:"referencesImportModal",children:[F?(0,E.jsxs)("div",{children:[R.loading?(0,E.jsx)("div",{children:(0,E.jsx)("h2",{className:"text-center mt-4",children:(0,E.jsxs)("small",{children:[(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",role:"status",className:"align-bottom"})," ",o("loading"),"…"]})})}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:o("import_a_bibtex_file_from_your_provider_account",{provider:n})}),R.data&&(0,E.jsx)(ut.a,{providerName:n}),(0,E.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:L,children:[R.error&&(0,E.jsx)(mt,{provider:t,error:R.error,linkAccount:S}),R.data&&R.data.length>0&&(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsx)(it,{provider:t,data:R.data,selectedGroupId:w,setSelectedGroupId:k})}),(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsx)(Ze,{label:o("file_name_in_this_project"),focusName:!0,error:g,inFlight:b})}),s&&(0,E.jsx)("div",{className:"row-spaced-small",children:(0,E.jsxs)(Ye.A,{controlId:"format",children:[(0,E.jsx)(We.A,{children:o("format")}),(0,E.jsxs)(st.A,{value:C,onChange:e=>A(e.target.value),children:[(0,E.jsx)("option",{value:"bibtex",children:"BibTeX"}),(0,E.jsx)("option",{value:"biblatex",children:"BibLaTeX"})]})]})})]})]}),b&&(0,E.jsx)("h3",{className:"text-center mt-4",children:(0,E.jsxs)("small",{children:[(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",role:"status",className:"align-bottom"})," ",o("importing"),"…"]})})]}):(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:ht[t].dynamic_sync_description(o)}),(0,E.jsx)("p",{children:(0,E.jsx)(ke.A,{type:"button",onClick:S,children:ht[t].link_to(o)})})]}),g&&(0,E.jsx)(E.Fragment,{children:"string"==typeof g?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)("div",{className:"text-center",children:[(0,E.jsx)("hr",{}),(0,E.jsx)(mt,{error:g,provider:t,linkAccount:S})]}),(0,E.jsx)(xt,{error:g,provider:t,linkAccount:S})]}):g.data?.relink?(0,E.jsx)(ft,{provider:t,linkAccount:S}):(0,E.jsx)(Xe.A,{error:g})})]}):(0,E.jsx)("div",{children:(0,E.jsx)(dt.A,{type:"info",customIcon:(0,E.jsx)("img",{src:ot,alt:"","aria-hidden":"true"}),title:ht[t].upgrade_prompt_title(o),content:(0,E.jsx)("p",{children:ht[t].upgrade_prompt_content(o)}),isActionBelowContent:!0,action:(0,E.jsx)(tt.A,{buttonProps:{variant:"premium"},source:t,handleClick:()=>x(!0),children:o("try_it_for_free")})})})}const ht={mendeley:{default:e=>e("mendeley_reference_loading_error"),expired:e=>e("mendeley_reference_loading_error_expired"),forbidden:e=>e("mendeley_reference_loading_error_forbidden"),"refresh-failed":e=>e("mendeley_reference_loading_error_expired"),sync_description:e=>e("mendeley_sync_description"),dynamic_sync_description:e=>e("mendeley_dynamic_sync_description"),link_to:e=>e("link_to_mendeley"),is_premium:e=>e("mendeley_is_premium"),loading_groups:e=>e("mendeley_groups_loading_error"),relink:e=>e("mendeley_groups_relink"),upgrade_prompt_title:e=>e("mendeley_upgrade_prompt_title"),upgrade_prompt_content:e=>e("mendeley_upgrade_prompt_content")},papers:{default:e=>e("papers_reference_loading_error"),expired:e=>e("papers_reference_loading_error_expired"),forbidden:e=>e("papers_reference_loading_error_forbidden"),"refresh-failed":e=>e("papers_reference_loading_error_expired"),sync_description:e=>e("papers_sync_description"),dynamic_sync_description:e=>e("papers_dynamic_sync_description"),link_to:e=>e("link_to_papers"),is_premium:e=>e("papers_is_premium"),loading_groups:e=>e("papers_groups_loading_error"),relink:e=>e("papers_groups_relink"),upgrade_prompt_title:e=>e("papers_upgrade_prompt_title"),upgrade_prompt_content:e=>e("papers_upgrade_prompt_content")},zotero:{default:e=>e("zotero_reference_loading_error"),expired:e=>e("zotero_reference_loading_error_expired"),forbidden:e=>e("zotero_reference_loading_error_forbidden"),"refresh-failed":e=>e("zotero_reference_loading_error_expired"),sync_description:e=>e("zotero_sync_description"),dynamic_sync_description:e=>e("zotero_dynamic_sync_description"),link_to:e=>e("link_to_zotero"),is_premium:e=>e("zotero_is_premium"),loading_groups:e=>e("zotero_groups_loading_error"),relink:e=>e("zotero_groups_relink"),upgrade_prompt_title:e=>e("zotero_upgrade_prompt_title"),upgrade_prompt_content:e=>e("zotero_upgrade_prompt_content")}};function mt(e){let{provider:t,error:n,linkAccount:r}=e;const{t:s}=(0,j.Bd)();return"relink"===n?(0,E.jsx)(ft,{provider:t,linkAccount:r}):n in ht[t]?(0,E.jsx)(et.A,{children:ht[t][n](s)}):(0,E.jsx)(Xe.A,{error:n})}function ft(e){let{provider:t,linkAccount:n}=e;const{t:r}=(0,j.Bd)();return(0,E.jsxs)(et.A,{children:[(0,E.jsx)("div",{children:ht[t].relink(r)}),(0,E.jsx)("div",{style:{display:"flex",justifyContent:"center",marginTop:10},children:(0,E.jsx)(ke.A,{variant:"danger",type:"button",onClick:n,children:r("relink_your_account")})})]})}function xt(e){let{error:t,provider:n,linkAccount:r}=e;const{t:s}=(0,j.Bd)();switch(t){case"refresh-failed":return(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:ht[n].dynamic_sync_description(s)}),(0,E.jsx)("p",{children:(0,E.jsx)(ke.A,{type:"button",onClick:r,children:ht[n].link_to(s)})})]});case"default":case"expired":case"forbidden":return(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{children:[s("reference_error_relink_hint"),"  "]}),(0,E.jsx)("div",{children:(0,E.jsx)("a",{href:"/user/settings",target:"_blank",rel:"noopener",style:{fontWeight:"bold"},children:s("account_settings")})})]});default:return null}}function jt(){const{t:e}=(0,j.Bd)();return(0,E.jsx)(Ue,{mode:"papers",icon:"menu_book",label:e("from_provider",{provider:"Papers"})})}function _t(){const{newFileCreateMode:e}=(0,f.m)();return"papers"!==e?null:(0,E.jsx)(qe,{initialName:"references.bib",children:(0,E.jsx)(pt,{provider:"papers",providerName:"Papers",supportsGroups:!0})})}function gt(){const{t:e}=(0,j.Bd)();return(0,E.jsx)(Ue,{mode:"zotero",icon:"menu_book",label:e("from_provider",{provider:"Zotero"})})}function vt(){const{newFileCreateMode:e}=(0,f.m)();return"zotero"!==e?null:(0,E.jsx)(qe,{initialName:"references.bib",children:(0,E.jsx)(pt,{provider:"zotero",providerName:"Zotero",supportsGroups:!0,supportsFormat:!0})})}function bt(){const{t:e}=(0,j.Bd)();return(0,E.jsx)(Ue,{mode:"mendeley",icon:"menu_book",label:e("from_provider",{provider:"Mendeley"})})}function yt(){const{newFileCreateMode:e}=(0,f.m)();return"mendeley"!==e?null:(0,E.jsx)(qe,{initialName:"references.bib",children:(0,E.jsx)(pt,{provider:"mendeley",providerName:"Mendeley",supportsGroups:!0})})}function wt(){const{name:e,validName:t}=Ge(),{setValid:n}=$e(),{error:r,finishCreatingDoc:s,inFlight:i}=(0,f.m)();(0,a.useEffect)((()=>{n(t)}),[n,t]);const o=(0,a.useCallback)((t=>{t.preventDefault(),s({name:e}),de._("new-file-created",{method:"doc",extension:e.split(".").length>1?e.split(".").pop():""})}),[s,e]);return(0,E.jsxs)("form",{noValidate:!0,id:"create-file",onSubmit:o,children:[(0,E.jsx)(Ze,{focusName:!0,error:r,inFlight:i}),r&&(0,E.jsx)(Xe.A,{error:r})]})}function kt(){const{t:e}=(0,j.Bd)(),{name:t,setName:n,validName:r}=Ge(),{setValid:s}=$e(),{finishCreatingLinkedFile:i,error:o,inFlight:l}=(0,f.m)(),[c,d]=(0,a.useState)(""),u=(0,a.useCallback)((e=>{d(e.target.value)}),[]);(0,a.useEffect)((()=>{if(c){const e=c.match(/^\s*https?:\/\/.+\/([^/]+\.(\w+))\s*$/);n(e?e[1]:"")}}),[n,c]),(0,a.useEffect)((()=>{s(r&&!!c)}),[s,r,c]);return(0,E.jsxs)("form",{className:"form-controls",id:"create-file",noValidate:!0,onSubmit:e=>{e.preventDefault(),de._("new-file-created",{method:"url",extension:t.split(".").length>1?t.split(".").pop():""}),i({name:t,provider:"url",data:{url:c.trim()}})},children:[(0,E.jsxs)(Ye.A,{controlId:"import-from-url",children:[(0,E.jsx)(We.A,{children:e("url_to_fetch_the_file_from")}),(0,E.jsx)(Je.A,{type:"url",placeholder:"https://example.com/my-file.png",required:!0,value:c,onChange:u})]}),(0,E.jsx)(Ze,{label:e("file_name_in_this_project"),placeholder:"my_file",error:o,inFlight:l}),o&&(0,E.jsx)(Xe.A,{error:o})]})}n(99819);var Ct=n(45524),At=n(4941),Et=n(87833),Nt=n(64932),Ft=n(1705);function St(){const{t:e}=(0,j.Bd)(),{hasLinkedProjectFileFeature:t,hasLinkedProjectOutputFileFeature:n}=(0,Nt.A)("ol-ExposedSettings"),r=t&&n,{name:s,setName:i,validName:o}=Ge(),{setValid:l}=$e(),{error:c,finishCreatingLinkedFile:d,inFlight:u}=(0,f.m)(),[p,h]=(0,a.useState)(),[m,x]=(0,a.useState)(),[_,g]=(0,a.useState)(),[v,b]=(0,a.useState)(!t),y=(0,a.useCallback)((e=>{const t=e.split("/").pop();t&&i(t)}),[i]);(0,a.useEffect)((()=>{_&&("output.pdf"===_.path&&p.name?i(`${p.name}.pdf`):y(_.path))}),[p,_,i,y]),(0,a.useEffect)((()=>{m&&y(m.path)}),[m,y]),(0,a.useEffect)((()=>{const e=Boolean(v?_:m);l(o&&e)}),[l,o,v,m,_]);return(0,E.jsxs)(Ft.A,{id:"create-file",onSubmit:e=>{e.preventDefault(),de._("new-file-created",{method:"project",extension:s.split(".").length>1?s.split(".").pop():""}),d(v?{name:s,provider:"project_output_file",data:{source_project_id:p._id,source_output_file_path:_.path,build_id:_.build,clsiServerId:_.clsiServerId}}:{name:s,provider:"project_file",data:{source_project_id:p._id,source_entity_path:m.path}})},children:[(0,E.jsx)(Rt,{selectedProject:p,setSelectedProject:h}),v?(0,E.jsx)(Tt,{selectedProjectId:p?._id,selectedProjectOutputFile:_,setSelectedProjectOutputFile:g}):(0,E.jsx)(Lt,{selectedProjectId:p?._id,selectedProjectEntity:m,setSelectedProjectEntity:x}),r&&(0,E.jsxs)("div",{className:"toggle-file-type-button",children:["or ",(0,E.jsx)(ke.A,{variant:"link",type:"button",onClick:()=>b((e=>!e)),children:(0,E.jsx)("span",{children:e(v?"select_from_source_files":"select_from_output_files")})})]}),(0,E.jsx)(Ze,{label:e("file_name_in_this_project"),classes:{formGroup:"form-controls row-spaced-small"},placeholder:"example.tex",error:c,inFlight:u}),c&&(0,E.jsx)(Xe.A,{error:c})]})}function Rt(e){let{selectedProject:t,setSelectedProject:n}=e;const{t:r}=(0,j.Bd)(),{projectId:s}=(0,p.Om)(),{data:i,error:o,loading:l}=(0,Ct.r)(),c=(0,a.useMemo)((()=>i?i.filter((e=>e._id!==s)):null),[i,s]);return o?(0,E.jsx)(Xe.A,{error:o}):(0,E.jsxs)(Ye.A,{controlId:"project-select",children:[(0,E.jsx)(We.A,{children:r("select_a_project")}),l&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})]}),(0,E.jsxs)(st.A,{disabled:!i,value:t?t._id:"",onChange:e=>{const t=e.target.value,r=i.find((e=>e._id===t));n(r)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",r("please_select_a_project")]}),c&&c.map((e=>(0,E.jsx)("option",{value:e._id,children:e.name},e._id)))]}),c&&!c.length&&(0,E.jsx)("small",{children:r("no_other_projects_found")})]})}function Tt(e){let{selectedProjectId:t,selectedProjectOutputFile:n,setSelectedProjectOutputFile:r}=e;const{t:s}=(0,j.Bd)(),{data:i,error:o,loading:a}=(0,Et.z)(t);return o?(0,E.jsx)(Xe.A,{error:o}):(0,E.jsxs)(Ye.A,{className:"row-spaced-small",controlId:"project-output-file-select",children:[(0,E.jsx)(We.A,{children:s("select_an_output_file")}),a&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})]}),(0,E.jsxs)(st.A,{disabled:!i,value:n?.path||"",onChange:e=>{const t=e.target.value,n=i?.find((e=>e.path===t));r(n)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",s("please_select_an_output_file")]}),i&&i.map((e=>(0,E.jsx)("option",{value:e.path,children:e.path},e.path)))]})]})}function Lt(e){let{selectedProjectId:t,selectedProjectEntity:n,setSelectedProjectEntity:r}=e;const{t:s}=(0,j.Bd)(),{data:i,error:o,loading:a}=(0,At.i)(t);return o?(0,E.jsx)(Xe.A,{error:o}):(0,E.jsxs)(Ye.A,{className:"row-spaced-small",controlId:"project-entity-select",children:[(0,E.jsx)(We.A,{children:s("select_a_file")}),a&&(0,E.jsxs)("span",{children:[" ",(0,E.jsx)(ct.A,{animation:"border","aria-hidden":"true",size:"sm",role:"status"})]}),(0,E.jsxs)(st.A,{disabled:!i,value:n?.path||"",onChange:e=>{const t=e.target.value,n=i.find((e=>e.path===t));r(n)},children:[(0,E.jsxs)("option",{disabled:!0,value:"",children:["- ",s("please_select_a_file")]}),i&&i.map((e=>(0,E.jsx)("option",{value:e.path,children:e.path.slice(1)},e.path)))]})]})}var It=n(90214);const Dt=[{import:s,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-papers"},{import:i,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-zotero"},{import:o,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/create-file-mode-mendeley"}],Pt=(0,a.lazy)((()=>Promise.all([n.e(1865),n.e(5758),n.e(5380)]).then(n.bind(n,22159))));function Ot(){const{t:e}=(0,j.Bd)(),{newFileCreateMode:t}=(0,f.m)(),{fileCount:n}=(0,h.Q)(),{hasLinkedProjectFileFeature:r,hasLinkedProjectOutputFileFeature:s,hasLinkUrlFeature:i}=(0,Nt.A)("ol-ExposedSettings");return n&&"error"!==n.status?(0,E.jsx)("table",{children:(0,E.jsx)("tbody",{children:(0,E.jsxs)("tr",{children:[(0,E.jsx)("td",{className:"modal-new-file-list",children:(0,E.jsxs)("ul",{className:"list-unstyled",children:[(0,E.jsx)(Ue,{mode:"doc",icon:"description",label:e("new_file")}),(0,E.jsx)(Ue,{mode:"upload",icon:"upload",label:e("upload")}),(r||s)&&(0,E.jsx)(Ue,{mode:"project",icon:"folder_open",label:e("from_another_project")}),i&&(0,E.jsx)(Ue,{mode:"url",icon:"globe",label:e("from_external_url")}),Dt.map((e=>{let{import:{CreateFileMode:t},path:n}=e;return(0,E.jsx)(t,{},n)}))]})}),(0,E.jsxs)("td",{className:`modal-new-file-body modal-new-file-body-${t}`,children:["doc"===t&&(0,E.jsx)(qe,{initialName:"name.tex",children:(0,E.jsx)(wt,{})}),"url"===t&&(0,E.jsx)(qe,{children:(0,E.jsx)(kt,{})}),"project"===t&&(0,E.jsx)(qe,{children:(0,E.jsx)(St,{})}),"upload"===t&&(0,E.jsx)(a.Suspense,{fallback:(0,E.jsx)(It.e,{delay:500}),children:(0,E.jsx)(Pt,{})}),Dt.map((e=>{let{import:{CreateFilePane:t},path:n}=e;return(0,E.jsx)(t,{},n)}))]})]})})}):null}function Mt(){const{valid:e}=$e(),{newFileCreateMode:t,inFlight:n,cancel:r}=(0,f.m)(),{fileCount:s}=(0,h.Q)();return(0,E.jsx)(Bt,{valid:e,cancel:r,newFileCreateMode:t,inFlight:n,fileCount:s})}function Bt(e){let{valid:t,fileCount:n,inFlight:r,cancel:s,newFileCreateMode:i}=e;const{t:o}=(0,j.Bd)();return(0,E.jsxs)(E.Fragment,{children:["number"!=typeof n&&"warning"===n.status&&(0,E.jsxs)("div",{className:"modal-footer-left approaching-file-limit",children:[o("project_approaching_file_limit")," (",n.value,"/",n.limit,")"]}),"number"!=typeof n&&"error"===n.status&&(0,E.jsx)(Ce.A,{type:"error",className:"at-file-limit",content:o("project_has_too_many_files")}),(0,E.jsx)(ke.A,{variant:"secondary",type:"button",disabled:r,onClick:s,children:o("cancel")}),"upload"!==i&&(0,E.jsx)(ke.A,{variant:"primary",type:"submit",form:"create-file",disabled:r||!t,isLoading:r,children:o("create")})]})}function zt(){const{t:e}=(0,j.Bd)(),{isCreatingFile:t,cancel:n}=(0,f.m)();return t?(0,E.jsx)(Ve,{children:(0,E.jsxs)(we.Ay,{size:"lg",onHide:n,show:!0,children:[(0,E.jsx)(we.IK,{closeButton:!0,children:(0,E.jsx)(we.rA,{children:e("add_files")})}),(0,E.jsx)(we.$8,{className:"modal-new-file",children:(0,E.jsx)(Ot,{})}),(0,E.jsx)(we.E9,{children:(0,E.jsx)(Mt,{})})]})}):null}const $t=e=>{let{children:t}=e;const{setIsRootFolderSelected:n,selectedEntityIds:r,select:s}=(0,x.G1)(),i=(0,a.useCallback)((()=>{n(!0),r.size>1&&s([])}),[s,r.size,n]);return(0,E.jsx)("div",{className:"file-tree-inner",onClick:i,"data-testid":"file-tree-inner",children:t})};var Vt=n(15043),Ut=n(35287);const Ht=a.memo((function(e){let{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:s,onInit:i,onDelete:o,isConnected:l}=e;const[c,d]=(0,a.useState)(null),{projectId:u}=(0,p.Om)(),{fileTreeData:m}=(0,h.Q)(),f=Boolean(u&&m),x=(0,V.G)();return(0,a.useEffect)((()=>{if(c){const e=e=>{if(e.dataTransfer){const{dataset:t}=e.target;if(t.fileId&&t.fileType&&"folder"!==t.fileType){e.dataTransfer.setData("application/x-overleaf-file-id",t.fileId);const n=(0,Ut.$X)(m,t.fileId);n&&e.dataTransfer.setData("application/x-overleaf-file-path",n)}}};return c.addEventListener("dragstart",e),()=>{c.removeEventListener("dragstart",e)}}}),[c,m]),(0,a.useEffect)((()=>{f&&i()}),[f,i]),f?(0,E.jsx)("div",{className:"file-tree","data-testid":"file-tree",ref:d,children:c&&(0,E.jsxs)(I,{refProviders:t,setRefProviderEnabled:n,setStartedFreeTrial:r,onSelect:s,fileTreeContainer:c,children:[l?null:(0,E.jsx)("div",{className:"disconnected-overlay"}),x?(0,E.jsx)(ye,{}):(0,E.jsx)(fe,{}),(0,E.jsx)(De,{}),(0,E.jsx)($t,{children:(0,E.jsx)(Gt,{onDelete:o})}),(0,E.jsx)(Ae,{}),(0,E.jsx)(zt,{}),(0,E.jsx)(Se,{}),(0,E.jsx)(Re,{})]})}):null}));function Gt(e){let{onDelete:t}=e;!function(e){const t=(0,l.ur)(),{dispatchRename:n,dispatchDelete:r,dispatchMove:s,dispatchCreateFolder:i,dispatchCreateDoc:o,dispatchCreateFile:c,fileTreeData:d}=(0,h.Q)(),{selectedEntityIds:u,selectedEntityParentIds:p,select:m,unselect:f}=(0,x.G1)(),{socket:j}=(0,Me.nK)(),{fileTreeFromHistory:_}=(0,Be.P4)(),g=(0,a.useCallback)(((e,n,r)=>{r&&t?.id===r&&window.expectingLinkedFileRefreshedSocketFor===n&&(m(e),window.expectingLinkedFileRefreshedSocketFor=null)}),[t,m]);(0,a.useEffect)((()=>{if(!_)return j&&j.on("reciveEntityRename",e),()=>{j&&j.removeListener("reciveEntityRename",e)};function e(e,t){n(e,t)}}),[j,n,_]),(0,a.useEffect)((()=>{if(!_)return j&&j.on("removeEntity",t),()=>{j&&j.removeListener("removeEntity",t)};function t(t){const n=(0,C.lE)(d,t);if(f(t),p.has(t))for(const e of u)(0,C.k3)(d,e).path.includes(t)&&f(e);r(t),e&&e(n)}}),[j,f,r,d,u,p,e,_]),(0,a.useEffect)((()=>{if(!_)return j&&j.on("reciveEntityMove",e),()=>{j&&j.removeListener("reciveEntityMove",e)};function e(e,t){s(e,t)}}),[j,s,_]),(0,a.useEffect)((()=>{if(!_)return j&&j.on("reciveNewFolder",e),()=>{j&&j.removeListener("reciveNewFolder",e)};function e(e,t){i(e,t)}}),[j,i,_]),(0,a.useEffect)((()=>{if(!_)return j&&j.on("reciveNewDoc",e),()=>{j&&j.removeListener("reciveNewDoc",e)};function e(e,t,n){o(e,t)}}),[j,o,_]),(0,a.useEffect)((()=>{if(!_)return j&&j.on("reciveNewFile",e),()=>{j&&j.removeListener("reciveNewFile",e)};function e(e,t,n,r,s){c(e,t),r&&g(t._id,t.name,s)}}),[j,c,g,_])}(t);const{fileTreeData:n}=(0,h.Q)(),{isOver:r,dropRef:s}=R(n._id),i=(0,Vt.V)((e=>({isDragging:e.isDragging(),item:e.getItem(),clientOffset:e.getClientOffset()})));return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(B,{isOver:r,...i}),(0,E.jsx)(se,{folders:n.folders,docs:n.docs,files:n.fileRefs,classes:{root:P()("file-tree-list",{"file-tree-dragging":i.isDragging})},dropRef:s,dataTestId:"file-tree-list-root"})]})}const qt=(0,u.A)(Ht,Oe);var Kt=n(11326);const Yt=(0,a.memo)((function(){const e=(0,l.ur)(),{setStartedFreeTrial:t}=(0,c.yn)(),{isConnected:n,connectionState:r}=(0,d.FX)(),{handleFileTreeInit:s,handleFileTreeSelect:i,handleFileTreeDelete:o}=(0,Kt.r)(),[u,p]=(0,a.useState)((()=>e.refProviders||{})),h=(0,a.useCallback)((function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];p((n=>({...n,[e]:t})))}),[]);return(0,E.jsx)(qt,{refProviders:u,setRefProviderEnabled:h,setStartedFreeTrial:t,isConnected:n||null!==r.reconnectAt,onInit:s,onSelect:i,onDelete:o})}))},43137:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(97434),s=n(96713),i=n(71627),o=n(31085);const a=function(e){let{onClick:t}=e;const{t:n}=(0,r.Bd)();return(0,o.jsxs)(i.A,{variant:"secondary",size:"sm",onClick:t,className:"back-to-editor-btn",children:[(0,o.jsx)(s.A,{type:"arrow_back",className:"toolbar-btn-secondary-icon"}),(0,o.jsx)("span",{className:"toolbar-label",children:n("back_to_editor")})]})}},43480:(e,t,n)=>{n.d(t,{V:()=>r});const r=(0,n(6468).Y)(new Date(2024,7,26),"MMMM Do")},45117:(e,t,n)=>{n.r(t),n.d(t,{default:()=>l});var r=n(14041),s=n(56447),i=n(97536),o=n(31085);const a=(0,r.lazy)((()=>n.e(7985).then(n.bind(n,27985)))),l=()=>{const{projectSearchIsOpen:e}=(0,s.LV)(),t=(0,i.G)();return e||t?(0,o.jsx)(r.Suspense,{fallback:null,children:(0,o.jsx)(a,{})}):null}},45524:(e,t,n)=>{n.d(t,{r:()=>l});var r=n(14041),s=n(37858),i=n(45857),o=n(52155);const a=(e,t)=>i.h.compare(e.name,t.name);function l(){const[e,t]=(0,r.useState)(!0),[n,i]=(0,r.useState)(null),[l,c]=(0,r.useState)(!1),{signal:d}=(0,o.A)();return(0,r.useEffect)((()=>{(0,s.hm)("/user/projects",{signal:d}).then((e=>{i(e.projects.sort(a))})).catch((e=>c(e))).finally((()=>t(!1)))}),[d]),{loading:e,data:n,error:l}}},45857:(e,t,n)=>{n.d(t,{h:()=>r});const r=new Intl.Collator("en",{numeric:!0,sensitivity:"variant",caseFirst:"upper"})},47475:(e,t,n)=>{n.d(t,{A:()=>p});var r=n(97434),s=n(37858),i=n(14041),o=n(86316),a=n(89753);function l(){const{t:e}=(0,r.Bd)(),{projectId:t}=(0,o.Om)(),[n,s]=(0,i.useState)(10),l=(0,a.z)();return(0,i.useEffect)((()=>{s(10);const e=window.setInterval((()=>{s((n=>0===n?(window.clearInterval(e),l.assign(`/login?redir=/project/${t}`),0):n-1))}),1e3);return()=>{window.clearInterval(e)}}),[t,l]),e("session_expired_redirecting_to_login",{seconds:n})}var c=n(27916),d=n(3518),u=n(31085);function p(e){let{error:t}=e;const{t:n}=(0,r.Bd)();if("string"==typeof t)switch(t){case"name-exists":return(0,u.jsx)(d.A,{children:n("file_already_exists")});case"too-many-files":return(0,u.jsx)(d.A,{children:n("project_has_too_many_files")});case"remote-service-error":return(0,u.jsx)(d.A,{children:n("remote_service_error")});case"folder_not_found":return(0,u.jsx)(d.A,{children:n("the_target_folder_could_not_be_found")});case"invalid_filename":return(0,u.jsx)(d.A,{children:n("invalid_filename",{nameLimit:150})});case"duplicate_file_name":return(0,u.jsx)(d.A,{children:n("file_or_folder_name_already_exists")});case"rate-limit-hit":return(0,u.jsx)(d.A,{children:n("too_many_files_uploaded_throttled_short_period")});case"not-logged-in":return(0,u.jsx)(d.A,{children:(0,u.jsx)(l,{})});case"linked-project-compile-error":return(0,u.jsx)(d.A,{children:n("generic_linked_file_compile_error")});default:return(0,u.jsx)(d.A,{children:n("generic_something_went_wrong")})}switch(t.constructor){case s.fk:{const e=t.data?.message;if(e)return(0,u.jsx)(d.A,{children:e.text||e});switch(t.response?.status){case 400:return(0,u.jsx)(d.A,{children:n("invalid_request")});case 403:return(0,u.jsx)(d.A,{children:n("session_error")});case 429:return(0,u.jsx)(d.A,{children:n("too_many_attempts")});default:return(0,u.jsx)(d.A,{children:n("something_went_wrong_server")})}}case c.Lc:case c.di:case c.yG:return null;default:return(0,u.jsx)(d.A,{children:n("generic_something_went_wrong")})}}},55904:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),s=n(79184),i=n(56447);const o=()=>{const{view:e,pdfLayout:t,changeLayout:n,detachRole:o,reattach:a}=(0,i.LV)(),l=(0,r.useRef)(null),c="sideBySide"===t||"pdf"===e;(0,s.A)(c,l);const d=(0,r.useCallback)((()=>{c?n("flat","editor"):n("sideBySide")}),[n,c]),u=(0,r.useCallback)((e=>{e?("detacher"===o&&a(),n("sideBySide")):n("flat","editor")}),[n,o,a]);return{togglePdfPane:d,handlePdfPaneExpand:(0,r.useCallback)((()=>{"flat"===t&&"editor"===e&&n("sideBySide","editor")}),[n,t,e]),handlePdfPaneCollapse:(0,r.useCallback)((()=>{"sideBySide"===t&&n("flat","editor")}),[n,t]),setPdfIsOpen:u,pdfIsOpen:c,pdfPanelRef:l}}},57533:(e,t,n)=>{n.d(t,{S:()=>w});var r=n(14041),s=n(53373),i=n.n(s),o=n(97434),a=(n(82438),n(50020),n(14935)),l=n(96713),c=n(31085);const d=(0,r.memo)((e=>{let{expanded:t,setExpanded:n}=e;const{t:r}=(0,o.Bd)();return(0,c.jsx)("button",{className:"outline-item-expand-collapse-btn",onClick:()=>n((e=>!e)),"aria-label":r(t?"collapse":"expand"),children:(0,c.jsx)(l.A,{type:t?"keyboard_arrow_down":"keyboard_arrow_right",className:"outline-caret-icon"})})}));d.displayName="OutlineItemToggleButton";const u=(0,r.memo)((function(e){let{outlineItem:t,jumpToLine:n,highlightedLine:s,matchesHighlightedLine:o,containsHighlightedLine:l}=e;const[u,p]=(0,r.useState)(!0),m=(0,r.useRef)(null),f=(0,r.useRef)(!1),x=i()("outline-item",{"outline-item-no-children":!t.children}),j=o||!u&&l,_=i()("outline-item-link",{"outline-item-link-highlight":j});(0,r.useEffect)((()=>{const e=f.current;f.current=!!j,!e&&j&&m.current&&(0,a.A)(m.current,{scrollMode:"if-needed",block:"center"})}),[j,m,f]);const g=t.children?u:void 0;return(0,c.jsxs)("li",{className:x,"aria-expanded":g,role:"treeitem","aria-current":j,"aria-label":t.title,translate:"no",children:[(0,c.jsxs)("div",{className:"outline-item-row",children:[!!t.children&&(0,c.jsx)(d,{expanded:u,setExpanded:p}),(0,c.jsx)("button",{className:_,onClick:function(e){const r=2===e.detail;n(t.line,r)},ref:m,children:t.title})]}),u&&t.children?(0,c.jsx)(h,{outline:t.children,jumpToLine:n,isRoot:!1,highlightedLine:l?s:null,containsHighlightedLine:l}):null]})}));var p=n(35545);const h=(0,r.memo)((function(e){let{outline:t,jumpToLine:n,isRoot:r,highlightedLine:s,containsHighlightedLine:o}=e;const a=i()("outline-item-list",{"outline-item-list-root":r});return(0,c.jsx)("ul",{className:a,role:r?"tree":"group",children:t.map(((e,t)=>{const r=o&&s===e.line,i=null!=s&&o&&(0,p.A)(e.children).includes(s);return(0,c.jsx)(u,{outlineItem:e,jumpToLine:n,highlightedLine:r||i?s:null,matchesHighlightedLine:r,containsHighlightedLine:i},`${e.level}-${t}`)}))})}));const m=function(e){let{outline:t,jumpToLine:n,highlightedLine:r}=e;const{t:s}=(0,o.Bd)();return(0,c.jsx)("div",{children:t.length?(0,c.jsx)(h,{outline:t,jumpToLine:n,isRoot:!0,highlightedLine:r,containsHighlightedLine:!0}):(0,c.jsxs)("div",{className:"outline-body-no-elements",children:[s("we_cant_find_any_sections_or_subsections_in_this_file"),"."," ",(0,c.jsx)("a",{href:"/learn/how-to/Using_the_File_Outline_feature",className:"outline-body-link",target:"_blank",rel:"noopener noreferrer",children:s("find_out_more_about_the_file_outline")})]})})};var f=n(67984),x=n(59162);const j=(0,r.memo)((e=>{let{isTexFile:t,toggleExpanded:n,expanded:r,isOpen:s,isPartial:i}=e;const{t:a}=(0,o.Bd)();return(0,c.jsxs)("button",{className:"outline-header-expand-collapse-btn",disabled:!t,onClick:n,"aria-label":a(r?"hide_outline":"show_outline"),children:[(0,c.jsx)(l.A,{type:s?"keyboard_arrow_down":"keyboard_arrow_right",className:"outline-caret-icon"}),(0,c.jsx)("h4",{className:"outline-header-name",children:a("file_outline")}),i&&(0,c.jsx)(x.A,{id:"partial-outline",description:a("partial_outline_warning"),overlayProps:{placement:"top"},children:(0,c.jsx)("span",{role:"status",style:{display:"flex"},children:(0,c.jsx)(l.A,{type:"warning",accessibilityLabel:a("partial_outline_warning")})})})]})}));j.displayName="OutlineToggleButton";const _=r.memo((function(e){let{isTexFile:t,outline:n,jumpToLine:s,onToggle:o,highlightedLine:a,isPartial:l=!1,expanded:d,toggleExpanded:u}=e;const p=Boolean(t&&d);(0,r.useEffect)((()=>{o(p)}),[p,o]);const h=i()("outline-pane",{"outline-pane-disabled":!t});return(0,c.jsxs)("div",{className:h,children:[(0,c.jsx)("header",{className:"outline-header",children:(0,c.jsx)(j,{toggleExpanded:u,expanded:d,isOpen:p,isPartial:l,isTexFile:t})}),p&&(0,c.jsx)("div",{className:"outline-body",children:(0,c.jsx)(m,{outline:n,jumpToLine:s,highlightedLine:a})})]})})),g=(0,f.A)(_);var v=n(54830),b=n(37766),y=n(98843);const w=(0,r.memo)((()=>{const{highlightedLine:e,canShowOutline:t,jumpToLine:n,outlineExpanded:r,toggleOutlineExpanded:s}=(0,v.X)(),i=(0,b.A)("outline-toggled"),o=(0,y.A)();return(0,c.jsx)("div",{className:"outline-container",children:(0,c.jsx)(g,{outline:o.items,onToggle:i,isTexFile:t,jumpToLine:n,highlightedLine:e,isPartial:o.partial,expanded:r,toggleExpanded:s})})}));w.displayName="OutlineContainer"},60166:(e,t,n)=>{n.d(t,{_:()=>r});const r=async(e,t)=>{const n=[];for(const r of e)n.push(await t(r));return n}},61564:(e,t,n)=>{n.d(t,{C:()=>o});var r=n(54830),s=n(79184),i=n(14041);const o=()=>{const{canShowOutline:e,outlineExpanded:t}=(0,r.X)(),n=(0,i.useRef)(null),o=e&&t;return(0,s.A)(o,n),{outlineEnabled:o,outlinePanelRef:n}}},64430:(e,t,n)=>{n.d(t,{N:()=>s});n(14041);var r=n(31085);function s(){return(0,r.jsx)("aside",{id:"history-file-tree",className:"ide-react-editor-sidebar history-file-tree"})}},64840:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(44585),s=n(49234),i=n(31085);const o=function(e){const{inputRef:t,label:n,id:o,...a}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.A,{type:"switch",ref:t,id:o,...a}),(0,i.jsx)(s.A,{htmlFor:o,visuallyHidden:!0,children:n})]})}},68059:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(97434),s=n(31085);function i(e){let{selectedEntityCount:t}=e;const{t:n}=(0,r.Bd)();return(0,s.jsx)("div",{className:"multi-selection-ongoing",children:(0,s.jsx)("div",{className:"multi-selection-message",children:(0,s.jsx)("h4",{children:`${t} ${n("files_selected")}`})})})}},68723:(e,t,n)=>{n.d(t,{Dl:()=>i,Mb:()=>s,r_:()=>o,xy:()=>a});var r=n(37858);function s(e,t,n,s){return(0,r.TB)(`/project/${e}/${l(t)}/${n}/rename`,{body:{name:s}})}function i(e,t,n){return(0,r.Un)(`/project/${e}/${l(t)}/${n}`)}function o(e,t,n,s){return(0,r.TB)(`/project/${e}/${l(t)}/${n}/move`,{body:{folder_id:s}})}function a(e,t,n){const{endpoint:s,...i}=n;return(0,r.TB)(`/project/${e}/${s}`,{body:{parent_folder_id:t,...i}})}function l(e){return"fileRef"===e?"file":e}},69242:(e,t,n)=>{n.d(t,{D:()=>o});var r=n(97536),s=n(69954),i=n(14041);const o=()=>{const e=(0,r.G)(),t=(0,i.useCallback)((function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e?{...t,"editor-redesign":"enabled"}:t}),[e]);return{sendEvent:(0,i.useCallback)(((e,n)=>{(0,s._)(e,t(n))}),[t]),sendEventOnce:(0,i.useCallback)(((e,n)=>{(0,s.JY)(e,t(n))}),[t]),sendEventSampled:(0,i.useCallback)(((e,n,r)=>{(0,s.MY)(e,t(n),r)}),[t])}}},71735:(e,t,n)=>{n.d(t,{MS:()=>s,Ro:()=>i,tL:()=>o});n(82438),n(99819);var r=n(6896);function s(e,t,n){return!(i(e,t,n)||o(e,t,n))}function i(e,t,n){return e._id!==t&&(e=(0,r.k3)(e,t).entity),e.docs.find((e=>e.name===n))||e.fileRefs.find((e=>e.name===n))}function o(e,t,n){return e._id!==t&&(e=(0,r.k3)(e,t).entity),e.folders.find((e=>e.name===n))}},73743:(e,t,n)=>{n.d(t,{$:()=>a});var r=n(53373),s=n.n(r),i=n(59162),o=n(31085);function a(e){let{id:t,isOpen:n,setIsOpen:r,togglerType:a,tooltipWhenOpen:l,tooltipWhenClosed:c}=e;const d=n?l:c;return(0,o.jsx)(i.A,{id:t,description:d,overlayProps:{placement:"east"===a?"left":"right"},children:(0,o.jsx)("button",{className:s()("custom-toggler",`custom-toggler-${a}`,{"custom-toggler-open":n,"custom-toggler-closed":!n}),"aria-label":d,title:"",onClick:()=>r(!n)})})}},77934:(e,t,n)=>{n.d(t,{j:()=>c});var r=n(73613),s=n(14041),i=n(97434),o=n(53373),a=n.n(o),l=n(31085);const c=e=>{let{children:t,resizable:n=!0,onDoubleClick:o,...c}=e;const{t:d}=(0,i.Bd)(),[u,p]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{if(u){const e=()=>{c.onDragging?.(!0)};return document.addEventListener("pointermove",e),()=>{document.removeEventListener("pointermove",e)}}c.onDragging?.(!1)}),[u,c]),(0,l.jsx)(r.TW,{disabled:!n&&!u,...c,onDragging:function(e){(u||n)&&p(e)},children:(0,l.jsx)("div",{className:a()("horizontal-resize-handle",{"horizontal-resize-handle-enabled":n}),title:d("resize"),onDoubleClick:()=>o?.(),children:t})})}},79184:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(14041);function s(e,t){(0,r.useEffect)((()=>{const n=t.current;n&&(e?n.expand():n.collapse())}),[e,t])}},79563:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(97434),s=n(31085);const i=function(e){let{resetUnreadMessages:t,sendMessage:n}=e;const{t:i}=(0,r.Bd)();return(0,s.jsxs)("form",{className:"new-message",children:[(0,s.jsx)("label",{htmlFor:"chat-input",className:"visually-hidden",children:i("your_message_to_collaborators")}),(0,s.jsx)("textarea",{id:"chat-input",placeholder:`${i("your_message_to_collaborators")}…`,onKeyDown:function(e){const t=e.nativeEvent.isComposing;if("Enter"===e.key&&!t){e.preventDefault();const t=e.target;n(t.value),window.setTimeout((()=>{t.blur(),t.closest("form")?.reset(),t.focus()}),0)}},onClick:t})]})}},80997:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(31085);function s(e){let{loadProgress:t,label:n,hasError:s=!1}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"loading-screen-brand-container",children:(0,r.jsx)("div",{className:"loading-screen-brand",style:{height:`${t}%`}})}),!s&&(0,r.jsxs)("div",{className:"h3 loading-screen-label","aria-live":"polite",children:[n,(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."}),(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."}),(0,r.jsx)("span",{className:"loading-screen-ellip","aria-hidden":"true",children:"."})]})]})}},84826:(e,t,n)=>{n.d(t,{Z:()=>o});var r=n(37858),s=n(66020),i=n(14041);const o=()=>{const[e,t]=(0,i.useState)(!1),[n,o]=(0,i.useState)(""),{setUserSettings:a}=(0,s.dk)();return{loading:e,error:n,setEditorRedesignStatus:(0,i.useCallback)((e=>(t(!0),o(""),new Promise(((n,s)=>{(0,r.TB)("/user/settings",{body:{enableNewEditor:e}}).then((()=>{a((t=>({...t,enableNewEditor:e}))),n()})).catch((e=>{o("Failed to update settings"),s(e)})).finally((()=>{t(!1)}))})))),[a])}}},85868:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(14041),s=n(32859),i=n(31085);const o=(0,r.forwardRef)(((e,t)=>(0,i.jsx)(s.A.Select,{ref:t,...e})));o.displayName="OLFormSelect";const a=o},85886:(e,t,n)=>{n.d(t,{A:()=>s});var r=n(31085);function s(e){let{children:t}=e;return(0,r.jsx)("li",{role:"none",children:t})}},87833:(e,t,n)=>{n.d(t,{z:()=>l});n(82438),n(12266),n(57327);var r=n(14041),s=n(37858),i=n(45857),o=n(52155);const a=(e,t)=>i.h.compare(e.path,t.path);function l(e){const[t,n]=(0,r.useState)(!1),[i,l]=(0,r.useState)(null),[c,d]=(0,r.useState)(!1),{signal:u}=(0,o.A)();return(0,r.useEffect)((()=>{e&&(n(!0),d(!1),l(null),(0,s.TB)(`/project/${e}/compile`,{body:{check:"silent",draft:!1,incrementalCompilesEnabled:!1},signal:u}).then((e=>{if("success"===e.status){const t=e.outputFiles.filter((e=>e.path.match(/.*\.(pdf|png|jpeg|jpg|gif)/)));e.outputFiles.forEach((t=>{t.clsiServerId=e.clsiServerId,t.compileGroup=e.compileGroup})),l(t.sort(a))}else d("linked-project-compile-error")})).catch((e=>d(e))).finally((()=>n(!1))))}),[e,u]),{loading:t,data:i,error:c}}},88342:(e,t,n)=>{n.d(t,{A:()=>o});var r=n(14041),s=n(31085);const i=function(e){let{as:t,...n}=e;const r=t||"div";return(0,s.jsx)(r,{...n})};const o=function(e){let{onClick:t,onMouseDown:n,offset:o=50,...a}=e;const l=(0,r.useRef)(!1),c=(0,r.useRef)(),d=a;return(0,r.useEffect)((()=>{const e=e=>{if(l.current){if(l.current=!1,!c.current)return;const n=c.current.width/2,r=c.current.height/2,s=c.current.x+n,i=c.current.y+r,a=Math.abs(e.clientX-s),d=Math.abs(e.clientY-i);a<n+o&&d<r+o&&t()}};return document.addEventListener("mouseup",e),()=>{document.removeEventListener("mouseup",e)}}),[t,o]),(0,s.jsx)(i,{onMouseDown:e=>{l.current=!0,c.current=e.target.getBoundingClientRect(),n?.(e)},...d})}},88588:(e,t,n)=>{n.d(t,{G1:()=>C,hj:()=>k,k2:()=>w});n(97107),n(82438),n(12266),n(57327),n(50020),n(69033),n(68903),n(21018),n(1415),n(4448),n(58871),n(56539);var r=n(14041),s=n(53373),i=n.n(s),o=n(45250),a=n.n(o),l=n(6896),c=n(60440),d=n(86316),u=n(56447),p=n(42093),h=n(28699),m=n(11787),f=n(45857),x=n(94857),j=n(89139),_=n(31085);const g=(0,r.createContext)(void 0);var v=function(e){return e.SELECT="SELECT",e.MULTI_SELECT="MULTI_SELECT",e.UNSELECT="UNSELECT",e}(v||{});function b(e,t){switch(t.type){case v.SELECT:return new Set(Array.isArray(t.id)?t.id:[t.id]);case v.MULTI_SELECT:{const n=new Set(e);return n.has(t.id)?n.size>1&&n.delete(t.id):n.add(t.id),n}case v.UNSELECT:{const n=new Set(e);return n.delete(t.id),n}default:throw new Error(`Unknown selectable action type: ${t.type}`)}}function y(e,t){switch(t.type){case v.SELECT:return new Set([t.id]);case v.MULTI_SELECT:case v.UNSELECT:return e;default:throw new Error(`Unknown selectable action type: ${t.type}`)}}const w=e=>{let{onSelect:t,children:n}=e;const{projectId:s,project:i}=(0,d.Om)(),o=i?.rootDocId,[u]=(0,p.A)(`doc.open_id.${s}`,o),{fileTreeData:m,setSelectedEntities:f,fileTreeReadOnly:x}=(0,c.Q)(),[w,k]=(0,r.useState)(!1),[C,A]=(0,r.useReducer)(x?y:b,null,(()=>u&&(0,l.lE)(m,u)?new Set([u]):new Set)),[E,N]=(0,r.useState)(new Set);(0,r.useEffect)((()=>{const e=new Set;C.forEach((t=>{const n=(0,l.lE)(m,t);n&&n.path.forEach((t=>e.add(t)))})),N(e)}),[m,C]);const F=(0,h.A)(C);(0,r.useEffect)((()=>{if(a().isEqual(C,F))return;const e=Array.from(C).map((e=>(0,l.lE)(m,e))).filter((e=>null!==e));t(e),f(e)}),[m,C,F,t,f]),(0,j.A)("entity:opened",(0,r.useCallback)((e=>{const t=(0,l.lE)(m,e.detail);t&&A({type:v.SELECT,id:t.entity._id})}),[m]));const S=(0,r.useCallback)((e=>{A({type:v.SELECT,id:e})}),[]),R=(0,r.useCallback)((e=>{A({type:v.UNSELECT,id:e})}),[]),T=(0,r.useCallback)(((e,t)=>{const n=t?v.MULTI_SELECT:v.SELECT;A({type:n,id:e})}),[]),L={selectedEntityIds:C,selectedEntityParentIds:E,select:S,unselect:R,selectOrMultiSelectEntity:T,isRootFolderSelected:w,setIsRootFolderSelected:k};return(0,_.jsx)(g.Provider,{value:L,children:n})};function k(e,t){const{view:n,setView:s}=(0,u.LV)(),{setContextMenuCoords:o}=(0,m.e)(),{fileTreeData:a}=(0,c.Q)(),{selectedEntityIds:d,selectOrMultiSelectEntity:p,isRootFolderSelected:h,setIsRootFolderSelected:f}=C(),j=d.has(e),_=(0,r.useCallback)((e=>{const t=[];let n=!1;for(const r of E(a))if(r===e){if(t.push(r),n)break;n=!0}else if(d.has(r)){if(t.push(r),n)break;n=!0}else n&&t.push(r);return t}),[a,d]),g=(0,r.useCallback)((()=>{for(const e of d){const t=(0,l.k3)(a,e);if("doc"===t.type)return"editor";if("fileRef"===t.type)return"file";if("folder"===t.type)return n}return null}),[a,d,n]),v=(0,r.useCallback)((n=>{n.stopPropagation();const r=!h&&(x.c?n.metaKey:n.ctrlKey);f(!1),n.shiftKey?p(_(e)):p(e,r),"file"===t?s("file"):"doc"===t?s("editor"):"folder"===t&&s(g())}),[e,h,f,p,s,t,_,g]),b=(0,r.useCallback)((e=>{v(e),e.ctrlKey||e.metaKey||o(null)}),[v,o]),y=(0,r.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||v(e)}),[v]),w=(0,r.useCallback)((t=>{d.has(e)||v(t)}),[e,v,d]),k=!h&&j&&"pdf"!==n;return{isSelected:j,props:(0,r.useMemo)((()=>({className:i()({selected:k}),"aria-selected":k,onClick:b,onContextMenu:w,onKeyPress:y})),[b,w,y,k])}}function C(){const e=(0,r.useContext)(g);if(!e)throw new Error("useFileTreeSelectable is only available inside FileTreeSelectableProvider");return e}const A=(e,t)=>f.h.compare(e.name,t.name);function*E(e){yield e._id;const t=[...e.folders].sort(A);for(const e of t)for(const t of E(e))yield t;const n=[...e.docs,...e.fileRefs].sort(A);for(const e of n)yield e._id}},88929:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(97434),s=n(22046),i=n(71627),o=n(31085);const a=function ChatFallbackError(e){let{reconnect:t}=e;const{t:n}=(0,r.Bd)();return(0,o.jsx)("aside",{className:"chat",children:(0,o.jsxs)("div",{className:"chat-error",children:[(0,o.jsx)(s.A,{type:"error",content:n("chat_error")}),t&&(0,o.jsx)("p",{className:"text-center",children:(0,o.jsx)(i.A,{variant:"secondary",onClick:t,children:n("reconnect")})})]})})}},89027:(e,t,n)=>{n.d(t,{A:()=>ie});var r={};n.r(r),n.d(r,{TPRFileViewNotOriginalImporter:()=>f});var s={};n.r(s),n.d(s,{TPRFileViewInfo:()=>b});var i={};n.r(i),n.d(i,{TPRFileViewRefreshButton:()=>F});var o={};n.r(o),n.d(o,{TPRFileViewRefreshError:()=>TPRFileViewRefreshError});var a=n(14041),l=n(39067),c=n.n(l),d=n(97434),u=n(45250),p=n(85960);const h=(e,t)=>e.linkedFileData?.provider===t;var m=n(31085);function f(e){let{file:t}=e;const{t:n}=(0,d.Bd)(),{id:r}=(0,p.ur)();if(!(h(t,"mendeley")||h(t,"zotero")||h(t,"papers")))return null;return t.linkedFileData.importer_id===r?null:(0,m.jsx)("div",{className:"row",children:(0,m.jsx)("div",{className:"p-3 mb-4",children:n("only_importer_can_refresh",{provider:(0,u.capitalize)(t.linkedFileData.provider)})})})}var x=n(11283),j=n(96713);const _=e=>(0,m.jsx)(j.A,{type:"open_in_new",modifier:"rotate-180",className:"align-middle linked-file-icon",...e});var g=n(32403);function v(e,t){switch(e){case"mendeley":return"Mendeley";case"papers":return"Papers";case"zotero":return"Zotero";default:return t("reference_manager_lowercase")}}function b(e){let{file:t}=e;const{t:n}=(0,d.Bd)();if("mendeley"!==t.linkedFileData.provider&&"papers"!==t.linkedFileData.provider&&"zotero"!==t.linkedFileData.provider)return null;const r={formattedDate:(0,x.fU)(t.created),relativeDate:(0,x.Pp)(t.created)};return(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(g.e,{providerName:v(t.linkedFileData.provider,n),className:"mb-2"}),(0,m.jsxs)("p",{children:[(0,m.jsx)(_,{})," ","mendeley"===t.linkedFileData.provider?n("imported_from_mendeley_at_date",r):"zotero"===t.linkedFileData.provider?n("imported_from_zotero_at_date",r):n("imported_from_papers_at_date",r)]})]})}b.propTypes={file:c().shape({created:c().string,linkedFileData:c().shape({provider:c().string})})};var y=n(93852),w=n(60440),k=n(86316);const C=(e,t)=>e.linkedFileData?.provider===t;var A=n(53373),E=n.n(A),N=n(71627);function F(e){let{file:t,refreshing:n,refreshFile:r}=e;const{t:s}=(0,d.Bd)(),{id:i}=(0,p.ur)(),o=h(t,"mendeley")||h(t,"zotero")||h(t,"papers");let a;o&&(a=t.linkedFileData.importer_id===i);const l=!o||a;return(0,m.jsx)(N.A,{className:E()("btn",{"btn-primary":l,"btn-secondary":!l}),onClick:()=>r(o),disabled:n||!l,isLoading:n,loadingLabel:s("refreshing"),children:s("refresh")})}var S=n(37858),R=n(69954),T=n(69475);const L=[{import:i,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-button"}];function I(e){let{setRefreshError:t,file:n}=e;const{projectId:r}=(0,k.Om)(),[s,i]=(0,a.useState)(!1),o=(0,T.A)(),l=(0,a.useCallback)((e=>{i(!0),window.expectingLinkedFileRefreshedSocketFor=n.name;const s={shouldReindexReferences:e||/\.bib$/.test(n.name)};(0,S.TB)(`/project/${r}/linked_file/${n.id}/refresh`,{body:s}).then((()=>{o.current&&i(!1),(0,R._)("refresh-linked-file",{provider:n.linkedFileData?.provider})})).catch((e=>{o.current&&(i(!1),t(e.data?.message||e.message))}))}),[n,r,t,o]);return L.length>0?L.map((e=>{let{import:{TPRFileViewRefreshButton:t},path:r}=e;return(0,m.jsx)(t,{file:n,refreshFile:l,refreshing:s},r)}))[0]:(0,m.jsx)(D,{refreshFile:l,refreshing:s})}function D(e){let{refreshFile:t,refreshing:n}=e;const{t:r}=(0,d.Bd)();return(0,m.jsx)(N.A,{variant:"primary",onClick:()=>t(null),disabled:n,isLoading:n,loadingLabel:r("refreshing"),children:r("refresh")})}var P=n(22046);function TPRFileViewRefreshError(e){let{file:t,refreshError:n}=e;const r=h(t,"mendeley")||h(t,"zotero")||h(t,"papers");return(0,m.jsx)("div",{className:"file-view-error",children:r?(0,m.jsx)(FileViewThirdPartyReferenceRefreshError,{file:t}):(0,m.jsx)(FileViewDefaultRefreshError,{refreshError:n})})}function FileViewThirdPartyReferenceRefreshError(e){let{file:t}=e;const{t:n}=(0,d.Bd)();return(0,m.jsx)(P.A,{type:"error",content:(0,m.jsxs)(m.Fragment,{children:[(0,m.jsxs)("div",{children:[n("something_not_right"),"! ",(0,m.jsx)("span",{children:t.linkedFileData&&n("try_relinking_provider",{provider:(0,u.capitalize)(t.linkedFileData.provider)})})]}),(0,m.jsx)(N.A,{variant:"secondary",size:"sm",className:"mt-2",href:"/user/settings",target:"_blank",children:n("go_to_settings")})]})})}function FileViewDefaultRefreshError(e){let{refreshError:t}=e;const{t:n}=(0,d.Bd)();return(0,m.jsx)(P.A,{type:"error",content:`${n("access_denied")}: ${t}`})}const O=[{import:o,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-refresh-error"}];function FileViewRefreshError(e){let{file:t,refreshError:n}=e;const{t:r}=(0,d.Bd)();return O.length>0?O.map((e=>{let{import:{TPRFileViewRefreshError:r},path:s}=e;return(0,m.jsx)(r,{file:t,refreshError:n},s)}))[0]:(0,m.jsx)("div",{className:"file-view-error",children:(0,m.jsx)(P.A,{type:"error",content:(0,m.jsxs)("span",{children:[r("access_denied"),": ",n]})})})}const M=[{import:s,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-info"}],B=[{import:r,path:"/overleaf/services/web/modules/tpr-webmodule/frontend/js/components/file-view/tpr-file-view-not-original-importer"}],z=60,$=35,V="...",U=z-$-V.length;function H(e){if(e){if(e.length>z){const t=e.slice(0,$),n=e.slice(e.length-U);return t+V+n}return e}}function G(e){let{file:t}=e;const{projectId:n}=(0,k.Om)(),{fileTreeReadOnly:r}=(0,w.Q)(),{t:s}=(0,d.Bd)(),[i,o]=(0,a.useState)(null);let l;return t.linkedFileData&&(C(t,"url")?l=(0,m.jsx)(q,{file:t}):C(t,"project_file")?l=(0,m.jsx)(K,{file:t}):C(t,"project_output_file")&&(l=(0,m.jsx)(Y,{file:t}))),(0,m.jsxs)(m.Fragment,{children:[t.linkedFileData&&l,t.linkedFileData&&M.map((e=>{let{import:{TPRFileViewInfo:n},path:r}=e;return(0,m.jsx)(n,{file:t},r)})),(0,m.jsxs)("div",{className:"file-view-buttons",children:[t.linkedFileData&&!r&&(0,m.jsx)(I,{file:t,setRefreshError:o}),(0,m.jsxs)(N.A,{variant:"secondary",download:t.name,href:(0,y.i)(n,t.id,t.hash),children:[(0,m.jsx)(j.A,{type:"download",className:"align-middle"})," ",(0,m.jsx)("span",{children:s("download")})]})]}),t.linkedFileData&&B.map((e=>{let{import:{TPRFileViewNotOriginalImporter:n},path:r}=e;return(0,m.jsx)(n,{file:t},r)}))[0],i&&(0,m.jsx)(FileViewRefreshError,{file:t,refreshError:i}),(0,m.jsx)("textarea",{autoFocus:!0,"aria-label":"Invisible element to manage focus and prevent unintended behavior",tabIndex:-1,style:{position:"absolute",left:"-9999px"}})]})}function q(e){let{file:t}=e;return(0,m.jsxs)("p",{children:[(0,m.jsx)(_,{})," ",(0,m.jsx)(d.x6,{i18nKey:"imported_from_external_provider_at_date",components:[(0,m.jsx)("a",{href:t.linkedFileData.url})],values:{shortenedUrl:H(t.linkedFileData.url),formattedDate:(0,x.fU)(t.created),relativeDate:(0,x.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function K(e){let{file:t}=e;return(0,m.jsxs)("p",{children:[(0,m.jsx)(_,{})," ",(0,m.jsx)(d.x6,{i18nKey:"imported_from_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,m.jsx)("span",{})]:[(0,m.jsx)("a",{href:`/project/${t.linkedFileData.source_project_id}`,target:"_blank",rel:"noopener"})],values:{sourceEntityPath:t.linkedFileData.source_entity_path.slice(1),formattedDate:(0,x.fU)(t.created),relativeDate:(0,x.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function Y(e){let{file:t}=e;return(0,m.jsxs)("p",{children:[(0,m.jsx)(_,{})," ",(0,m.jsx)(d.x6,{i18nKey:"imported_from_the_output_of_another_project_at_date",components:t.linkedFileData.v1_source_doc_id?[(0,m.jsx)("span",{})]:[(0,m.jsx)("a",{href:`/project/${t.linkedFileData.source_project_id}`,target:"_blank",rel:"noopener"})],values:{sourceOutputFilePath:t.linkedFileData.source_output_file_path,formattedDate:(0,x.fU)(t.created),relativeDate:(0,x.Pp)(t.created)},shouldUnescape:!0,tOptions:{interpolation:{escapeValue:!0}}})]})}function W(e){let{file:t,onLoad:n,onError:r}=e;const{projectId:s}=(0,k.Om)();return(0,m.jsx)("img",{src:(0,y.i)(s,t.id,t.hash),onLoad:n,onError:r,alt:t.name})}var J=n(89997);const Z=e=>{let{fileId:t,onLoad:r,onError:s}=e;const i=(0,T.A)(),{previewByPath:o,pathInFolder:l}=(0,J.m8)(),c=(0,a.useCallback)((async e=>{if(e){const{loadPdfDocumentFromUrl:a}=await Promise.all([n.e(1865),n.e(6597),n.e(2404)]).then(n.bind(n,62404));if(!i.current)return;const c=l(t),d=c?o(c):null;if(!d)return void s();const u=await a(d.url).promise;if(!i.current)return;e.textContent="";const p=window.devicePixelRatio||1;for(let t=1;t<=u.numPages;t++){const n=await u.getPage(t);if(!i.current)return;const r=n.getViewport({scale:p}),s=document.createElement("canvas");s.classList.add("pdf-page"),s.width=r.width,s.height=r.height,s.style.width=r.width/p+"px",s.style.height=r.height/p+"px",e.append(s),n.render({canvasContext:s.getContext("2d"),viewport:r})}r()}}),[i,l,t,o,r,s]);return(0,m.jsx)("div",{className:"file-view-pdf",ref:c})};n(97107);var Q=n(60961),X=n(52155);const ee=2097152;function te(e){let{file:t,onLoad:n,onError:r}=e;const{projectId:s}=(0,k.Om)(),[i,o]=(0,a.useState)(""),[l,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1),p=(0,X.A)(),h=(0,X.A)();return(0,a.useEffect)((()=>{if(d)return;const e=(0,y.i)(s,t.id,t.hash),i=setTimeout((()=>p.abort()),1e4);let a;fetch(e,{method:"HEAD",signal:p.signal}).then((e=>{if(!e.ok)throw new Error("HTTP Error Code: "+e.status);return e.headers.get("Content-Length")})).then((t=>{let r=!1;const s=new Headers;t&&Number(t)>ee&&(r=!0,s.set("Range",`bytes=0-${ee}`)),a=window.setTimeout((()=>h.abort()),6e4);const i=h.signal;return fetch(e,{signal:i,headers:s}).then((e=>e.text().then((e=>{r&&(e=e.replace(/\n.*$/,"")),o(e),n(),c(r)}))))})).catch((e=>{Q.$.error("Error fetching file contents",e),r()})).finally((()=>{u(!1),clearTimeout(i),clearTimeout(a)}))}),[s,t.id,t.hash,r,n,d,p,h]),Boolean(i)&&(0,m.jsx)("div",{className:"text-preview",children:(0,m.jsxs)("div",{className:"scroll-container",children:[(0,m.jsx)("p",{children:i}),l&&(0,m.jsx)("p",{children:"..."})]})})}var ne=n(90214),re=n(64932);const se=["png","jpg","jpeg","gif"];function ie(e){let{file:t}=e;const[n,r]=(0,a.useState)(!0),[s,i]=(0,a.useState)(!1),{t:o}=(0,d.Bd)(),{textExtensions:l,editableFilenames:c}=(0,re.A)("ol-ExposedSettings"),u=t.name.split(".").pop().toLowerCase(),p=l.includes(u)||c.includes(t.name.toLowerCase()),h=se.includes(u),f="pdf"===u,x=!p&&!h&&!f,j=(0,a.useCallback)((()=>{r(!1)}),[]),_=(0,a.useCallback)((()=>{s||(r(!1),i(!0))}),[s]),g=(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(G,{file:t}),h&&(0,m.jsx)(W,{file:t,onLoad:j,onError:_}),p&&(0,m.jsx)(te,{file:t,onLoad:j,onError:_}),f&&(0,m.jsx)(Z,{fileId:t.id,onLoad:j,onError:_})]});return(0,m.jsxs)("div",{className:"file-view full-size",children:[!s&&g,!x&&n&&(0,m.jsx)(oe,{}),(x||s)&&(0,m.jsx)("p",{className:"no-preview",children:o("no_preview_available")})]})}function oe(){return(0,m.jsx)("div",{className:"loading-panel loading-panel-file-view","data-testid":"loading-panel-file-view",children:(0,m.jsx)(ne.A,{})})}ie.propTypes={file:c().shape({id:c().string,name:c().string,hash:c().string}).isRequired}},89761:(e,t,n)=>{n.d(t,{kW:()=>l,tL:()=>a});const r=new RegExp("[\\/\\\\\\*\\u0000-\\u001F\\u007F\\u0080-\\u009F\\uD800-\\uDFFF]","g"),s=new RegExp("(^\\.$)|(^\\.\\.$)|(^\\s+)|(\\s+$)","g"),i=new RegExp("^(prototype|constructor|toString|toLocaleString|valueOf|hasOwnProperty|isPrototypeOf|propertyIsEnumerable|__defineGetter__|__lookupGetter__|__defineSetter__|__lookupSetter__|__proto__)$"),o=1024;function a(e){return(t=e).length>0&&t.length<=o&&!e.match(r)&&!e.match(s);var t}function l(e){return i.test(e)}},90274:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(14041),s=n(69475);const i=function(e){const t=(0,s.A)();return r.useCallback((n=>{t.current&&e(n)}),[e,t])}},90598:(e,t,n)=>{e.exports=n.p+"images/overleaf-green-c9aabd0b98bdbcc32972.svg"},92902:(e,t,n)=>{n.d(t,{g:()=>y,m:()=>w});n(97107),n(82438),n(12266),n(99819),n(57327),n(50020);var r=n(14041),s=n(60166),i=n(68723),o=n(6896),a=n(71735),l=n(89761),c=n(86316),d=n(60440),u=n(88588),p=n(27916),h=n(94012),m=n(58516),f=n(93852),x=n(31085);const j=(0,r.createContext)(void 0);var _=function(e){return e.START_RENAME="START_RENAME",e.START_DELETE="START_DELETE",e.DELETING="DELETING",e.START_CREATE_FILE="START_CREATE_FILE",e.START_CREATE_FOLDER="START_CREATE_FOLDER",e.CREATING_FILE="CREATING_FILE",e.CREATING_FOLDER="CREATING_FOLDER",e.MOVING="MOVING",e.CANCEL="CANCEL",e.CLEAR="CLEAR",e.ERROR="ERROR",e}(_||{});const g={isDeleting:!1,isRenaming:!1,isCreatingFile:!1,isCreatingFolder:!1,isMoving:!1,inFlight:!1,actionedEntities:null,newFileCreateMode:null,error:null};function v(e){return e}function b(e,t){switch(t.type){case _.START_RENAME:return{...g,isRenaming:!0};case _.START_DELETE:return{...g,isDeleting:!0,actionedEntities:t.actionedEntities};case _.START_CREATE_FILE:return{...g,isCreatingFile:!0,newFileCreateMode:t.newFileCreateMode};case _.START_CREATE_FOLDER:return{...g,isCreatingFolder:!0};case _.CREATING_FILE:return{...g,isCreatingFile:!0,newFileCreateMode:e.newFileCreateMode,inFlight:!0};case _.CREATING_FOLDER:return{...g,isCreatingFolder:!0,inFlight:!0};case _.DELETING:return{...g,isDeleting:!0,inFlight:!0,actionedEntities:e.actionedEntities};case _.MOVING:return{...g,isMoving:!0,inFlight:!0};case _.CLEAR:return{...g};case _.CANCEL:return e.inFlight?e:{...g};case _.ERROR:return{...e,inFlight:!1,error:t.error};default:throw new Error(`Unknown user action type: ${t.type}`)}}const y=e=>{let{children:t}=e;const{projectId:n}=(0,c.Om)(),{fileTreeReadOnly:y}=(0,d.Q)(),{indexAllReferences:w}=(0,h.B4)(),{write:k}=(0,m.Tg)(),[C,A]=(0,r.useReducer)(y?v:b,g),{fileTreeData:E,dispatchRename:N,dispatchMove:F}=(0,d.Q)(),{selectedEntityIds:S,isRootFolderSelected:R}=(0,u.G1)(),[T,L]=(0,r.useState)(null),I=(0,r.useCallback)((()=>{A({type:_.START_RENAME})}),[]),D=(0,r.useCallback)((e=>{const t=Array.from(S)[0],r=(0,o.k3)(E,t),s=r.entity.name;if(e===s)return A({type:_.CLEAR});const c=function(e,t,n){if(!(0,l.tL)(n))return new p.di;if(!(0,a.MS)(e,t.parentFolderId,n))return new p.Lc;const r=1===t.path.length,s="folder"===t.type;if(r&&!s&&(0,l.kW)(n))return new p.yG}(E,r,e);return c?A({type:_.ERROR,error:c}):(A({type:_.CLEAR}),N(t,e),(0,i.Mb)(n,r.type,r.entity._id,e).catch((e=>{N(t,s),A({type:_.ERROR,error:e})})))}),[N,E,n,S]),P=(0,r.useCallback)(((e,t)=>!(0,a.MS)(E,e,t)),[E]),O=(0,r.useCallback)((()=>{const e=Array.from(S).map((e=>(0,o.k3)(E,e).entity));A({type:_.START_DELETE,actionedEntities:e})}),[E,S]),M=(0,r.useCallback)((()=>{A({type:_.DELETING});let e=!1;return(0,s._)(Array.from(S),(t=>{const r=(0,o.k3)(E,t);return e=e||/\.bib$/.test(r.entity.name),(0,i.Dl)(n,r.type,r.entity._id).catch((e=>{if(404!==e.info.statusCode)throw e}))})).then((()=>{e&&w(!0),A({type:_.CLEAR})})).catch((e=>{A({type:_.ERROR,error:e})}))}),[E,n,S,w]),B=(0,r.useCallback)(((e,t)=>{A({type:_.MOVING});const r=Array.from(t).map((e=>(0,o.k3)(E,e))).filter((n=>n.parentFolderId!==e&&!t.has(n.parentFolderId))),c=e===E._id,d=r.map((t=>function(e,t,n,r){if(!(0,a.MS)(e,t,n.entity.name)){const e=new p.ui;return e.entityName=n.entity.name,e}const s="folder"===n.type;if(r&&!s&&(0,l.kW)(n.entity.name))return new p.yG}(E,e,t,c))).find((e=>e));if(d)return A({type:_.ERROR,error:d});const u={};let h=!1;return r.forEach((t=>{u[t.entity._id]=t.parentFolderId,F(t.entity._id,e)})),(0,s._)(r,(async t=>{try{await(0,i.r_)(n,t.type,t.entity._id,e)}catch(e){h=!0,F(t.entity._id,u[t.entity._id]),A({type:_.ERROR,error:e})}})).then((()=>{h||A({type:_.CLEAR})}))}),[F,E,n]),z=(0,r.useCallback)((()=>{A({type:_.START_CREATE_FOLDER})}),[]),$=(0,r.useMemo)((()=>function(e,t,n){if(n)return e._id;const r=Array.from(t)[0];if(!r)return e._id;const s=(0,o.lE)(e,r);if(!s)return e._id;return"folder"===s.type?s.entity._id:s.parentFolderId}(E,S,R)),[E,S,R]),V=(0,r.useMemo)((()=>{if(1===S.size){const[e]=S,t=(0,o.lE)(E,e);return t?.entity?.name}return null}),[E,S]),U=(0,r.useCallback)((e=>{const t=function(e,t,n){if(!(0,l.tL)(n.name))return new p.di;if(!(0,a.MS)(e,t,n.name))return new p.Lc;const r=t===e._id,s="folder"===n.endpoint;if(r&&!s&&(0,l.kW)(n.name))return new p.yG}(E,$,e);return t?Promise.reject(t):(0,i.xy)(n,$,e)}),[E,$,n]),H=(0,r.useCallback)((e=>(A({type:_.CREATING_FOLDER}),U({endpoint:"folder",name:e}).then((()=>{A({type:_.CLEAR})})).catch((e=>{A({type:_.ERROR,error:e})})))),[U]),G=(0,r.useCallback)((e=>{A({type:_.START_CREATE_FILE,newFileCreateMode:e})}),[]),q=(0,r.useCallback)((()=>{G("doc")}),[G]),K=(0,r.useCallback)((()=>{G("upload")}),[G]),Y=(0,r.useCallback)((e=>(A({type:_.CREATING_FILE}),U(e).then((()=>{A({type:_.CLEAR})})).catch((e=>{A({type:_.ERROR,error:e})})))),[U]),W=(0,r.useCallback)((e=>(e.endpoint="doc",Y(e))),[Y]),J=(0,r.useCallback)((e=>(e.endpoint="linked_file",Y(e))),[Y]),Z=(0,r.useCallback)((()=>{A({type:_.CANCEL})}),[]);(0,r.useEffect)((()=>{function e(e){A({type:_.START_CREATE_FILE,newFileCreateMode:e.detail.mode})}return window.addEventListener("file-tree.start-creating",e),()=>{window.removeEventListener("file-tree.start-creating",e)}}),[]);const Q=(0,r.useMemo)((()=>{if(1===S.size){const[e]=S,t=(0,o.lE)(E,e);if("fileRef"===t?.type)return(0,f.i)(n,e,t.entity.hash);if("doc"===t?.type)return`/project/${n}/doc/${e}/download`}}),[E,n,S]),X=(0,r.useMemo)((()=>({canDelete:k&&S.size>0&&!R,canBulkDelete:k&&S.size>1&&!R,canRename:k&&1===S.size&&!R,canCreate:k&&S.size<2,...C,parentFolderId:$,selectedFileName:V,isDuplicate:P,startRenaming:I,finishRenaming:D,startDeleting:O,finishDeleting:M,finishMoving:B,startCreatingFile:G,startCreatingFolder:z,finishCreatingFolder:H,startCreatingDocOrFile:q,startUploadingDocOrFile:K,finishCreatingDoc:W,finishCreatingLinkedFile:J,cancel:Z,droppedFiles:T,setDroppedFiles:L,downloadPath:Q})),[Z,Q,T,W,H,J,M,B,D,P,R,$,V,S.size,q,G,z,O,I,K,C,k]);return(0,x.jsx)(j.Provider,{value:X,children:t})};function w(){const e=(0,r.useContext)(j);if(!e)throw new Error("useFileTreeActionable is only available inside FileTreeActionableProvider");return e}},93045:(e,t,n)=>{n.d(t,{U:()=>s});var r=n(14041);function s(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),s=(0,r.useCallback)((()=>n(!1)),[]);return(0,r.useEffect)((()=>{if(t)return;let r=null;return e.current&&(r=window.requestAnimationFrame((()=>{e.current&&(e.current.focus(),n(!0),r=null)}))),()=>{null!==r&&window.cancelAnimationFrame(r)}})),{autoFocusedRef:e,resetAutoFocus:s}}},97684:(e,t,n)=>{n.r(t),n.d(t,{NewPublishDropdownButton:()=>R,NewPublishToolbarButton:()=>T,default:()=>L});var r=n(14041),s=n(39067),i=n.n(s),o=n(53373),a=n.n(o),l=n(97434),c=n(96713),d=(n(97107),n(10646)),u=n(85960),p=n(8164),h=n(69475),m=n(86316),f=n(60440),x=n(37858),j=n(68543),_=n(31085);const g=(0,r.createContext)(void 0),v=e=>{let{children:t}=e;const{first_name:n,last_name:s}=(0,u.ur)(),{projectId:i,name:o,project:a}=(0,m.Om)(),l=a?.rootDocId,{hasFolders:c}=(0,f.Q)(),{getCurrentDocumentId:v,getCurrentDocValue:b}=(0,j.TS)(),{cobranding:y}=(0,d.mi)(),{pdfDownloadUrl:w,pdfUrl:k,logEntries:C}=(0,p.Rf)(),{uncompiled:A}=(0,p.Rf)();let E,N,F;y&&(y.publishGuideHtml||y.partner)?y.brandedMenu?(N=`/journals/${y.brandId}`,E="branded"):y.partner?(N=`/journals/${y.brandId}`,E="export",F=y.brandVariationId):(N=`/journals/${y.brandId}`,E="guide",F=y.brandVariationId):(N="/journals",E="basic");const[S,R]=(0,r.useState)(null),[T,L]=(0,r.useState)(null),I=(0,h.A)(),D=(0,r.useCallback)((()=>{const e=`/latest_template/${i}`;return Promise.all([(0,x.hm)(e),(0,x.hm)(N)]).then((e=>{let[t,n]=e;if(I.current){const e=t.title?{title:t.title}:{};e.description=t.description,e.author=t.author,e.license=t.license,L(t),R(n)}}))}),[I,N,i]),P=(0,r.useCallback)((()=>{const e=l;if(v()===e)return!1;const t=b();if(null==t)return!1;for(const e of t.split("\n"))if(/^[^%]*\\documentclass/.test(e))return!0;return!1}),[v,b,l]),O={entries:S,initialShown:E,brandVariationId:F,fetchData:D,initParams:{projectId:i,pdfUrl:k?w:void 0,logs:C,uncompiled:A,hasFolders:c,rootDocOverridden:P(),firstName:n,lastName:s,title:o,...T}};return(0,_.jsx)(g.Provider,{value:O,children:t})};class DestinationsError extends r.Component{render(){return(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)("p",{children:["Sorry, we had trouble retrieving our list of submission destinations. If you give us a minute, retry, and still find this error, please notify support at"," ",(0,_.jsx)("a",{href:"mailto:support@overleaf.com?subject=Unable to submit",children:"support@overleaf.com"})]})})}}var b=n(28812),y=n(71627),w=n(90214);const k=(0,r.lazy)((()=>Promise.all([n.e(4651),n.e(5196)]).then(n.bind(n,85196))));function C(e){let{handleHide:t}=e;const{t:s}=(0,l.Bd)(),{entries:i,initialShown:o,initParams:a,fetchData:c,brandVariationId:d}=function(){const e=(0,r.useContext)(g);if(!e)throw new Error("usePublishContext is only available inside PublishProvider");return e}(),[u,p]=(0,r.useState)(!0),[m,f]=(0,r.useState)(!1),[x,j]=(0,r.useState)(!1),v=(0,h.A)();let C;function A(){t(),p(!1)}return(0,r.useEffect)((()=>{Promise.all([n.e(4651),n.e(5196)]).then(n.bind(n,85196)).catch((()=>j(!0))),m||(c().catch((()=>{v.current&&j(!0)})),f(!0))}),[v,m,c]),C=i&&a?.logs?(0,_.jsx)(r.Suspense,{fallback:(0,_.jsx)(w.A,{}),children:(0,_.jsx)(k,{entries:i,initialShown:o,initParams:a,brandVariationId:d})}):x?(0,_.jsx)(DestinationsError,{}):(0,_.jsx)(w.A,{}),(0,_.jsxs)(b.Ay,{size:"lg",show:u,onHide:A,children:[(0,_.jsx)(b.IK,{closeButton:!0,children:(0,_.jsx)(b.rA,{children:s("submit_title")})}),(0,_.jsx)(b.$8,{children:(0,_.jsx)("div",{className:"modal-body-publish",children:C})}),(0,_.jsx)(b.E9,{children:(0,_.jsx)(y.A,{variant:"secondary",onClick:A,children:s("close")})})]})}var A=n(67984),E=n(69954),N=n(31352);const F=e=>{let{cobranding:t}=e;const{t:n}=(0,l.Bd)(),[s,i]=(0,r.useState)(!1);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{className:"ide-redesign-toolbar-button-container",children:(0,_.jsx)(y.A,{size:"sm",variant:"secondary",leadingIcon:(0,_.jsx)(c.A,{type:"public"}),onClick:function(){E._("navigation-clicked-submit"),i(!0)},children:t?.submitBtnHtmlNoBreaks?(0,_.jsx)("span",{dangerouslySetInnerHTML:{__html:t.submitBtnHtmlNoBreaks}}):(0,_.jsx)("span",{children:n("submit_title")})})}),s&&(0,_.jsx)(v,{children:(0,_.jsx)(C,{handleHide:function(){i(!1)}})})]})};function S(e){let{cobranding:t}=e;const{t:n}=(0,l.Bd)(),[s,i]=(0,r.useState)(!1);const o=a()("btn","btn-full-height");return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("div",{className:"toolbar-item",children:(0,_.jsxs)("button",{type:"button",id:"publishButton",className:o,onClick:function(){E._("navigation-clicked-submit"),i(!0)},children:[(0,_.jsx)(c.A,{type:"public",className:"align-middle"}),t?.submitBtnHtml?(0,_.jsx)("p",{className:"toolbar-label toolbar-label-multiline",dangerouslySetInnerHTML:{__html:t.submitBtnHtml}}):(0,_.jsx)("p",{className:"toolbar-label",children:n("submit_title")})]})}),s&&(0,_.jsx)(v,{children:(0,_.jsx)(C,{handleHide:function(){i(!1)}})})]})}S.propTypes={cobranding:i().shape({submitBtnHtml:i().string})};const R=(0,A.A)((function(){const{t:e}=(0,l.Bd)(),[t,n]=(0,r.useState)(!1);return(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)(N.A,{onClick:function(){E._("navigation-clicked-submit"),n(!0)},children:e("submit_title")}),t&&(0,_.jsx)(v,{children:(0,_.jsx)(C,{handleHide:function(){n(!1)}})})]})})),T=(0,A.A)(F),L=(0,A.A)(S)},98843:(e,t,n)=>{n.d(t,{A:()=>l});var r=n(14041),s=n(54830),i=n(60347),o=n(60961);const a=(e,t)=>{if(!e)return!0;if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++){const r=e[n],s=t[n];if(r.level!==s.level||r.line!==s.line||r.title!==s.title)return!0}return!1};function l(){const{flatOutline:e}=(0,s.X)(),[t,n]=(0,r.useState)((()=>({items:[],partial:!1}))),l=(0,r.useRef)(void 0);return(0,r.useEffect)((()=>{const t=l.current;l.current=e,e?a(t?.items,e.items)&&(o.$.log("Rebuilding changed outline"),n({items:(0,i.z_)(e.items),partial:e.partial})):n({items:[],partial:!1})}),[e]),t}}},e=>(e.O(0,[7582,277,9831,7695,9612,8732,5250,6215,7304,4271,9938,2510,6782,4568,5088,0,9002,7618,5296,4716,638],(()=>{return t=27101,e(e.s=t);var t})),e.O())])));